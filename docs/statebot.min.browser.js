/*
 * Statebot
 * v2.8.1
 * https://shuckster.github.io/statebot/
 * License: MIT
 */
var statebot=(function(n){"use strict";function t(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.push.apply(r,e)}return r}function r(n){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?t(Object(e),!0).forEach((function(t){o(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):t(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e(n)}function o(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function a(n,t){return(function(n){if(Array.isArray(n))return n})(n)||(function(n,t){var r=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null==r)return;var e,o,a=[],i=!0,c=!1;try{for(r=r.call(n);!(i=(e=r.next()).done)&&(a.push(e.value),!t||a.length!==t);i=!0);}catch(n){c=!0,o=n}finally{try{i||null==r.return||r.return()}finally{if(c)throw o}}return a})(n,t)||c(n,t)||(function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function i(n){return(function(n){if(Array.isArray(n))return u(n)})(n)||(function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)})(n)||c(n)||(function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function c(n,t){if(n){if("string"==typeof n)return u(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(n,t):void 0}}function u(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function f(n){return{all:n=n||new Map,on:function(t,r){var e=n.get(t);e?e.push(r):n.set(t,[r])},off:function(t,r){var e=n.get(t);e&&(r?e.splice(e.indexOf(r)>>>0,1):n.set(t,[]))},emit:function(t,r){var e=n.get(t);e&&e.slice().map((function(n){n(r)})),(e=n.get("*"))&&e.slice().map((function(n){n(t,r)}))}}}function s(n){return g(n)&&v(n.emit)&&(v(n.addListener)||v(n.on))&&(v(n.removeListener)||v(n.off))}function l(n){return Array.isArray(n)}function p(n){return"[object Arguments]"===Object.prototype.toString.call(n)}function v(n){return"function"==typeof n}function y(n){return"string"==typeof n}function d(n){return l(n)&&n.every(y)}function h(n){return void 0===n}function m(n){return null===n}function g(n){return"object"===e(n)&&!m(n)}function w(n){return!(m(n)||!g(n)||p(n))&&Object.getPrototypeOf(n)===Object.prototype}function b(n){return!!y(n)||!!l(n)&&n.every(y)}s.displayName="isEventEmitter",l.displayName="isUnset",l.displayName="isArray",p.displayName="isArguments",v.displayName="isFunction",y.displayName="isString",d.displayName="isAllStrings",h.displayName="isUndefined",m.displayName="isNull",g.displayName="isObject",w.displayName="isPojo",b.displayName="isTemplateLiteral";var E=function(n){return function(t,r){if(!(r>=n.length)){var o=n[r],a=o.argName,i=o.argType;if(h(t))return'Argument undefined: "'.concat(a,'"');var c=Array.isArray(i)?i:[i],u=c.map((function(n){return v(n)?(function(n,t,r){return t(r)?void 0:(t.displayName||t.name)+"(".concat(n,") did not return true")})(a,n,t):(function(n,t,r){return e(r)===t?void 0:'Argument "'.concat(n,'" should be a ').concat(t)})(a,n,t)})).filter(y);return(c.length>1?u.length>1:u.length)?u.join("\n| ")+"\n> typeof ".concat(a," === ").concat(e(t),"(").concat(JSON.stringify(t),")"):void 0}}};function A(n){return function(t){var r=Object.entries(t).map((function(n){var t=a(n,2);return{argName:t[0],argType:t[1]}}));return function(e){return function(){for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];var c=Array.from(a,(function(n){return p(n)?Array.from(n):n})).flat(1),u=c.map(E(r)).filter(y);if(u.length){var f=Object.keys(t).join(", ");return"\n".concat(n||"").concat(e,"(").concat(f,"):\n")+"".concat(u.map((function(n){return"| ".concat(n)})).join("\n"))}}}}}function T(n){var t=n.addListener?function(){return n.addListener.apply(n,arguments)}:function(){return n.on.apply(n,arguments)},r=n.removeListener?function(){return n.removeListener.apply(n,arguments)}:function(){return n.off.apply(n,arguments)},e=new Map;return{emit:function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];return n.emit(t,e)},on:function(n,r){var o=e.get(r);o||(o={handleEvent:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.apply(void 0,i([n].flat()))},refCount:0},e.set(r,o)),o.refCount+=1,t(n,o.handleEvent)},off:function(n,t){var o=e.get(t);o&&(r(n,o.handleEvent),o.refCount-=1,0===o.refCount&&e.delete(t))}}}function S(n){return n.reduce((function(n,t){return-1===n.indexOf(t)?(n.push(t),n):n}),[])}function O(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];var o=setTimeout.apply(void 0,[n,0].concat(r));return function(){clearTimeout(o)}}function j(n){var t,r=N(n),e=r.revoke,o=r.fn;return function(){return t=o.apply(void 0,arguments),e(),t}}function N(n){var t,r=!1;return{fn:function(){return r||(t=n.apply(void 0,arguments)),t},revoke:function(){r=!0}}}function I(n,t,e){for(var i=arguments.length,c=new Array(i>3?i-3:0),u=3;u<i;u++)c[u-3]=arguments[u];var f=[].concat(c).flat().reduce((function(n,t){return r(r({},n),{},o({},t,0))}),{});function s(n){return f[n]=p(n)+1,function(){l(n)}}function l(n){var t=p(n)-1;f[n]=Math.max(t,0)}function p(n){return f[n]||0}function v(){return r({},f)}function y(){return Object.keys(f).sort().map((function(n){return[n,f[n]]})).map((function(n){var r,e=a(n,2),i=e[0],c=e[1];return o(r={},t,i),o(r,"refs",c||"None"),r}))}function d(){return{description:"Statebot[".concat(n,"]: ").concat(e,":"),table:y()}}return{increase:s,decrease:l,countOf:p,toValue:d,refs:v}}function P(n,t){function r(){return n>=1}function e(){return n>=2}function o(){return n>=3}y(n)&&(n={info:3,log:2,warn:1,none:0}[n]||3);var a=t||console,i=a.info,c=a.table,u=a.log,f=a.warn,s=a.error;return{canWarn:r,canLog:e,canInfo:o,info:function(){o()&&i.apply(void 0,arguments)},table:function(){e()&&c.apply(void 0,arguments)},log:function(){e()&&u.apply(void 0,arguments)},warn:function(){r()&&f.apply(void 0,arguments)},error:function(){s.apply(void 0,arguments)}}}var L,x=/[\r\n]/,k="|",C="->",D=[k,C].map((function(n){return n.replace("|","\\|")})).join("|"),M=new RegExp("(".concat(D,")$")),R=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,_=/(\/\/[^\n\r]*)/,F=A("statebot.");function U(n){var t=F({templateLiteral:b})("decomposeRoute")(n);if(t)throw TypeError(t);return $(Y(n)).flat(2)}function W(n){var t=F({chart:b})("decomposeChart")(n);if(t)throw TypeError(t);var r=$(Y(n)),e=r.flatMap(B).flatMap(G),o=!1,a=S(e.map((function(n){return n.includes("")&&(o=!0),n.join(C)}))),i=S(r.flat(3));return{transitions:a.map((function(n){return n.split(C)})),routes:a,states:o?i:i.filter(Boolean)}}function Y(n){var t=(function(n){return[n].flat().reduce((function(n,t){return[].concat(i(n),i(t.split(x)))}),[])})(n),r=[],e=!1,o=t.reduce((function(n,t){var o=t.replace(_,"").replace(R,"");return o?(e=M.test(o))?n+o:(r.push(n+o),""):n}),"");return e||o?[].concat(r,[o]):[].concat(r)}function $(n){return n.map((function(n){return n.split(C).map((function(n){return n.split(k)}))}))}function B(n){var t=[];return n.reduce((function(n,r){return!1===n||t.push([n,i(r)]),i(r)}),!1),t}function G(n){var t=a(n,2),r=t[0],e=t[1];return r.reduce((function(n,t){return n.push.apply(n,i(e.map((function(n){return[t,n]})))),n}),[])}var H="onExiting",V="onEntering",z="onExited",J="onEntered",K="onSwitching",q="onSwitched",Q=(o(L={},K,"(ANY)state:changing"),o(L,q,"(ANY)state:changed"),L);function X(n,t){var r=[],e=[];return{configs:n.reduce((function(n,o){var c=o.routeChart,u=o.action,f=W(c),s=f.states,l=f.routes,p=f.transitions;return t()&&(r.push.apply(r,i(s)),e.push.apply(e,i(l))),[].concat(i(n),i(p.map((function(n){var t=a(n,2);return{fromState:t[0],toState:t[1],action:u}}))))}),[]),states:r,routes:e}}function Z(n){return w(n)&&"number"==typeof n.__STATEBOT__}var nn=A("statebot.");var tn=0;function rn(){var n=Date.now();function t(n,t){return n.toFixed(t).replace(/\.0+$/,"")}return function(){var r=Date.now()-n;return r<500?"".concat(t(r)," ms"):r<5e3?"".concat(t(r/1e3,2)," s "):r<6e4?"".concat(t(r/1e3,1)," s "):"".concat(t(r/1e3/60,1)," m ")}}return n.Statebot=function(n,t){if(!y(n))throw new TypeError("\nStatebot: Please specify a name for this machine");var e="Statebot[".concat(n,"]");if(!w(t))throw new TypeError("\n".concat(e,": Please specify options for this machine"));var c=t||{},u=c.chart,p=void 0===u?void 0:u,m=c.logLevel,g=void 0===m?3:m,b=c.historyLimit,E=void 0===b?2:b,S=h(t.events)?T(f()):s(t.events)&&T(t.events);if(!S)throw new TypeError("\n".concat(e,": Invalid event-emitter specified in options"));var O=p?W(p):t,N=O.states,L=void 0===N?[]:N,x=O.routes,k=void 0===x?[]:x,D=t.startIn,M=void 0===D?L[0]:D;if(!L.includes(M))throw new Error("".concat(e,': Starting-state not in chart: "').concat(M,'"'));var R=A("".concat(e,"#")),_=P(g,console),F=_.canWarn,U=[M],Y=Math.max(E,2),$=0,B=(function(n,t){t=t||function(){};var r=!!n;return{Pausable:function(n){return function(){return r?(t(),!1):n.apply(void 0,arguments)}},paused:function(){return r},pause:function(){r=!0},resume:function(){r=!1}}})(!1,(function(){return _.warn("".concat(e,": Ignoring callback, paused"))})),G=B.pause,Z=B.resume,nn=B.paused,tn=B.Pausable,rn=(function(){var n={};function t(t,r){n[t]=(n[t]||[]).filter((function(n){return n!==r})),0===n[t].length&&delete n[t]}return{define:function(r,e){return n[r]=n[r]||[],n[r].push(e),function(){return t(r,e)}},undefine:t,definitionsOf:function(t){return n[t]||[]}}})(),en=T(f()),on=tn(en.emit);function an(n,t){return en.on(n,t),function(){return en.off(n,t)}}var cn=I(n,"states","Listening for the following state-changes",i(L)),un=I(n,"transitions","Listening for the following transitions",i(k)),fn=I(n,"events","Listening for the following events");function sn(t,e){var c=v(t)?t({enter:bn,emit:wn,Enter:On,Emit:Sn}):w(t)?t:null;if(!w(c))throw new TypeError("Statebot[".concat(n,"]#").concat(e,"(): Expected an object, or a function that returns an object"));var u=[],f=[],s=(function(n){var t={},r=[];return Object.entries(n).map((function(n){var e=a(n,2),o=e[0],i=e[1];if(v(i))r.push({routeChart:o,action:i});else if(w(i)){var c=i.on,u=i.then;if(y(c)||l(c))[c].flat().map((function(n){t[n]=t[n]||[],t[n].push({routeChart:o,action:u})}));else v(u)&&r.push({routeChart:o,action:i})}})),{transitionsForEvents:t,transitionsOnly:r}})(c),p=s.transitionsForEvents,d=s.transitionsOnly,h=Object.entries(p).reduce((function(n,t){var e=a(t,2),c=e[0],s=X(e[1],F),l=s.states,p=s.routes,v=s.configs;F()&&(u.push.apply(u,i(l)),f.push.apply(f,i(p)));return r(r({},n),{},o({},c,v))}),{}),m=X(d,F),g=Object.entries(h).map((function(n){var t=a(n,2),e=t[0],o=t[1];return[fn.increase(e),En(e,(function(){for(var n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];var i=o.map((function(n){return r(r({},n),{},{args:t})})).some(A);i||In('Event not handled: "'.concat(e,'"'))}))].concat(o.map((function(n){var t=n.fromState,r=n.toState;return rn.define("".concat(e,":").concat(t),r)})))})).concat(m.configs.map((function(n){var t=n.fromState,r=n.toState,e=n.action,o="".concat(t,"->").concat(r);return[un.increase(o),an(o,(a=r,i=e,function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return T.apply(void 0,[a,i].concat(t))}))];var a,i}))).flat();if(F()){u.push.apply(u,i(m.states)),f.push.apply(f,i(m.routes));var b=u.filter((function(n){return!L.includes(n)})),E=f.filter((function(n){return!k.includes(n)}));b.length&&_.warn("Statebot[".concat(n,"]#").concat(e,"(): Invalid states specified:\n")+b.map((function(n){return'  > "'.concat(n,'"')})).join("\n")),E.length&&_.warn("Statebot[".concat(n,"]#").concat(e,"(): Invalid transitions specified:\n")+E.map((function(n){return'  > "'.concat(n,'"')})).join("\n"))}return function(){return g.map((function(n){return n()}))};function A(n){var t=n.fromState,r=n.toState,e=n.action,o=n.args;return gn(t,(function(){return bn.apply(void 0,[r].concat(i(o))),v(e)&&T.apply(void 0,[r,e].concat(i(o))),!0}))}function T(n,t){for(var r=arguments.length,e=new Array(r>2?r-2:0),o=2;o<r;o++)e[o-2]=arguments[o];var a=t.apply(void 0,e);if(v(a)){var i=j(Tn[H](n,(function(n){i(),a(n)})));g.push(i)}}}function ln(n,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=R({eventName:y})("peek")(n);if(o)throw new TypeError(o);var a=n+":"+vn(),i=rn.definitionsOf(a);if(i.length>1){var c="".concat(e,': Event "').concat(n,'" causes multiple transitions.\n')+'  > From state: "'.concat(vn(),'"\n')+'  > To states: "'.concat(i.join(", "),'"\n\n')+"Check your performTransitions() config.";throw new RangeError(c)}r||0!==i.length||(0===fn.countOf(n)?_.warn("".concat(e,': Event not handled: "').concat(n,'"')):_.warn("".concat(e,': Will not transition after emitting: "').concat(n,'"')));var u=i[0];if(h(t))return null!=u?u:vn();var f=R({stateObject:w})("peek")(t);if(f)throw new TypeError(f);if(Object.prototype.hasOwnProperty.call(t,u)){var s=t[u];return v(s)?s():s}return null}function pn(){return U[U.length-2]}function vn(){return U[U.length-1]}function yn(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var e=R({states:d})("canTransitionTo")([t]);if(e)throw new TypeError(e);if(!t.length)return!1;var o=dn();return t.every((function(n){return o.includes(n)}))}function dn(n){var t=h(n)?vn():n,r=R({state:y})("statesAvailableFromHere")(t);if(r)throw new TypeError(r);return k.reduce((function(n,r){var e=r.split(C).map((function(n){return n.trim()})),o=a(e,2),c=o[0],u=o[1];return c===t?[].concat(i(n),[u]):n}),[])}function hn(n,t){var r=vn()===n;if(h(t))return r;if(!r)return null;if(v(t)){for(var e=arguments.length,o=new Array(e>2?e-2:0),a=2;a<e;a++)o[a-2]=arguments[a];return t.apply(void 0,o)}return t}function mn(n){for(var t=Object.entries(n).find((function(n){return hn(a(n,1)[0])})),r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];return t?hn.apply(void 0,i(t.concat(e))):null}function gn(){var n=R({state:[y,w]})("inState")(arguments.length<=0?void 0:arguments[0]);if(n)throw new TypeError(n);return w(arguments.length<=0?void 0:arguments[0])?mn.apply(void 0,arguments):hn.apply(void 0,arguments)}var wn=tn((function(n){var t=R({eventName:y})("emit")(n);if(t)throw new TypeError(t);ln(n);for(var r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];return S.emit.apply(S,[n].concat(e))})),bn=tn((function(n){var t=R({state:y})("enter")(n);if(t)throw new TypeError(t);var r=vn(),o=n;if(o===r)return In('Already in state: "'.concat(o,'"')),!1;if(!L.includes(o))return In('Invalid state "'.concat(o,'", not switching')),!1;var a="".concat(r,"->").concat(o);if(!k.includes(a))return In('Invalid transition "'.concat(a,'", not switching')),!1;_.info("".concat(e,": tId<").concat(++$,">: ").concat(a)),U.push(o),U.length>Y&&U.shift();for(var i=arguments.length,c=new Array(i>1?i-1:0),u=1;u<i;u++)c[u-1]=arguments[u];return on.apply(void 0,[Q[K],o,r].concat(c)),on.apply(void 0,[a].concat(c)),on.apply(void 0,[Q[q],o,r].concat(c)),!0}));function En(n,t){var r=R({eventName:y,cb:v})("onEvent")(n,t);if(r)throw new TypeError(r);return S.on(n,t),function(){return S.off(n,t)}}var An=Object.keys(Q).reduce((function(n,t){return r(r({},n),{},o({},t,(function(n){var r=R({cb:v})(t)(n);if(r)throw new TypeError(r);var e=cn.increase(Q[t]),o=an(Q[t],n);return function(){o(),e()}})))}),{}),Tn=[[H,K],[V,K],[z,q],[J,q]].reduce((function(n,t){var e=a(t,2),i=e[0],c=e[1],u=i.slice(2),f=u.toLowerCase();return r(r({},n),{},o({},i,(function(n,t){var r=R({state:y,cb:v})(i)(n,t);if(r)throw new TypeError(r);var e=[cn.increase(n),cn.increase("".concat(n,":").concat(f))],o=An[c]((function(r,e){for(var o=arguments.length,a=new Array(o>2?o-2:0),i=2;i<o;i++)a[i-2]=arguments[i];0===u.indexOf("Exit")?n===e&&t.apply(void 0,[r].concat(a)):n===r&&t.apply(void 0,[e].concat(a))}));return function(){o(),e.map((function(n){return n()}))}})))}),{});function Sn(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];var o=R({eventName:y})("Emit")(n);if(o)throw new TypeError(o);return function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];return wn.apply(void 0,[n].concat([].concat(r,e)))}}function On(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];var o=R({state:y})("Enter")(n);if(o)throw new TypeError(o);return function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];return bn.apply(void 0,[n].concat([].concat(r,e)))}}function jn(n,t){for(var r=arguments.length,e=new Array(r>2?r-2:0),o=2;o<r;o++)e[o-2]=arguments[o];return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return gn.apply(void 0,[n,t].concat([].concat(e,o)))}}function Nn(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];return function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];return gn.apply(void 0,[n].concat([].concat(r,e)))}}function In(n){var t=pn(),r=vn(),o="".concat(h(t)?"[undefined]":t,"->").concat(r),a=dn();a.length?_.info("".concat(e,": ").concat(n,"\n")+'  > Previous transition: "'.concat(o,'"\n')+'  > From "'.concat(r,'", valid states are: [').concat(a.map((function(n){return'"'.concat(n,'"')})).join(", "),"]")):_.info("".concat(e,": ").concat(n,"\n")+'  > Previous transition: "'.concat(o,'"\n')+'  > There are no states available from "'.concat(r,'"'))}function Pn(n){var t=n.toValue(),r=t.description,e=t.table;_.log(r),e.length?_.table(e):_.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var e=t.flat();if(2===e.length&&y(e[0])&&w(e[1])){var o=e[0],a=e[1].afterEmitting,c=R({thisState:y,"{ afterEmitting }":y})("canTransitionTo")(o,a);if(c)throw new TypeError(c);return o!==vn()&&ln(a)===o}return yn.apply(void 0,i(e))},currentState:vn,emit:wn,Emit:Sn,enter:bn,Enter:On,history:function(){return[].concat(U)},info:function(){return _.log("".concat(e,": Information about this state-machine")),Pn(cn),Pn(un),void Pn(fn)},inspect:function(){return{states:cn.refs(),transitions:un.refs(),events:fn.refs()}},inState:gn,InState:function(){var n=R({state:[y,w]})("InState")(arguments.length<=0?void 0:arguments[0]);if(n)throw new TypeError(n);return w(arguments.length<=0?void 0:arguments[0])?Nn.apply(void 0,arguments):jn.apply(void 0,arguments)},name:function(){return n},onEntered:Tn[J],onEntering:Tn[V],onEvent:En,onExited:Tn[z],onExiting:Tn[H],onSwitched:An[q],onSwitching:An[K],onTransitions:function(n){return sn(n,"onTransitions")},pause:G,paused:nn,peek:function(n,t){return ln(n,t,!1)},performTransitions:function(n){return sn(n,"performTransitions")},previousState:pn,reset:function(){_.warn("".concat(e,": State-machine reset!")),U.length=0,U.push(M)},resume:Z,statesAvailableFromHere:dn}},n.assertRoute=function(n,t,e){var a=nn({machine:Z,expectedRoute:b})("assertRoute")(n,t);if(a)throw TypeError(a);tn+=1;var c=e||{},u=c.description,f=void 0===u?"Assertion complete":u,s=c.fromState,l=void 0===s?"":s,p=c.run,v=void 0===p?function(){}:p,y=c.permittedDeviations,d=void 0===y?0:y,h=c.timeoutInMs,m=void 0===h?1e3:h,g=c.logLevel,w=P(void 0===g?3:g),E="Statebot[".concat(n.name(),"]: aId<").concat(tn,">"),A=U(t);w.log("\n".concat(E,": Asserting route: [").concat(A.join(" > "),"]")),w.log("".concat(E,': > Assertion will start from state: "').concat(l,'"'));var T,S,I=(T=v,function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return O.apply(void 0,[T].concat(t))}),L=function(){},x=rn(),k=rn(),C=0,D=!0,M=!1,R=i(A),_=(function(n,t){t=t||[];var e=[],a=(n=n||[]).map((function(n,r){return t[r]||"center"})),c=!1;function u(){c=!0}function f(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];if(!c){var u=n.reduce((function(n,t,e){var i=a[e]||"";return r(r({},n),{},o({},t,i))}),{});e.push(u)}}function s(){return e.reduce((function(t,r){return n.map((function(n,e){return Math.max(r[n].length,t[e])}))}),n.map((function(){return 0})))}function l(){var t=s();function c(n,r){var e=t[r],o=a[r];return"left"===o?n.padEnd(e):"right"===o?n.padStart(e):n}return e.reduce((function(t,e){var a=n.reduce((function(n,t,a){return r(r({},n),{},o({},t,c(e[t],a)))}),{});return[].concat(i(t),[a])}),[])}return{lock:u,addRow:f,content:l}})(["state","expected","info","took"],["center","center","left","right"]),F=j((function(n){return W("","","","TOTAL: "+x()),_.lock(),w.log("\n".concat(E,": ").concat(f,": [").concat(n?"FAILED":"SUCCESS","]")),w.table(_.content()),n})),W=_.addRow;return new Promise((function(t,r){if(0!==R.length){var e=function(t){for(;R.length;){var e=R.shift();W(n.currentState(),"(".concat(e,")"),t),M=!1}!(function(n){clearTimeout(S),L(),c(),r(n)})(F(new Error(t)))};n.inState(l)&&(D=!1,L=I());var o=N((function(n){S=setTimeout((function(){a(),e("TIMEOUT")}),m),(function(n){if(D)W(n,"-","PENDING");else{var t=R[0];t===n?(W(n,t,M?"REALIGNED":"OKAY",k()),M=!1,R.shift()):(W(n,t,"WRONG STATE",k()),M=!0,C+=1),k=rn()}})(n),D&&n===l&&(D=!1,L=I()),C>d&&(a(),e("TOO MANY DEVIATIONS")),R.length<=0&&(a(),(function(){clearTimeout(S),L(),c(),t.apply(void 0,arguments)})(F()))})),a=o.revoke,i=o.fn,c=n.onSwitching(i)}else r(F(new Error("NO ROUTE TO TEST")))}))},n.decomposeChart=W,n.isStatebot=Z,n.routeIsPossible=function(n,t){var r=nn({machine:Z,route:b})("routeIsPossible")(n,t);if(r)throw TypeError(r);var e=U(t);return e.every((function(t,r){if(r===e.length-1)return!0;var o=e[r+1];return n.statesAvailableFromHere(t).includes(o)}))},Object.defineProperty(n,"__esModule",{value:!0}),n})({});
