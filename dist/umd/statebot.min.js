/*
 * Statebot
 * v2.5.1
 * https://shuckster.github.io/statebot/
 * License: MIT
 */
!(function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).statebot={})})(this,(function(t){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function r(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function o(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(n){e(t,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))}))}return t}function i(t,n){return(function(t){if(Array.isArray(t))return t})(t)||(function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return e})(t,n)||c(t,n)||(function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function a(t){return(function(t){if(Array.isArray(t))return u(t)})(t)||(function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)})(t)||c(t)||(function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function c(t,n){if(t){if("string"==typeof t)return u(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,n):void 0}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function s(){}function f(){f.init.call(this)}function l(t){return void 0===t._maxListeners?f.defaultMaxListeners:t._maxListeners}function p(t,n,e){if(n)t.call(e);else for(var r=t.length,o=b(t,r),i=0;i<r;++i)o[i].call(e)}function v(t,n,e,r){if(n)t.call(e,r);else for(var o=t.length,i=b(t,o),a=0;a<o;++a)i[a].call(e,r)}function h(t,n,e,r,o){if(n)t.call(e,r,o);else for(var i=t.length,a=b(t,i),c=0;c<i;++c)a[c].call(e,r,o)}function d(t,n,e,r,o,i){if(n)t.call(e,r,o,i);else for(var a=t.length,c=b(t,a),u=0;u<a;++u)c[u].call(e,r,o,i)}function y(t,n,e,r){if(n)t.apply(e,r);else for(var o=t.length,i=b(t,o),a=0;a<o;++a)i[a].apply(e,r)}function m(t,n,e,r){var o,i,a,c;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if((i=t._events)?(i.newListener&&(t.emit("newListener",n,e.listener?e.listener:e),i=t._events),a=i[n]):(i=t._events=new s,t._eventsCount=0),a){if("function"==typeof a?a=i[n]=r?[e,a]:[a,e]:r?a.unshift(e):a.push(e),!a.warned&&(o=l(t))&&o>0&&a.length>o){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=n,u.count=a.length,c=u,"function"==typeof console.warn?console.warn(c):console.log(c)}}else a=i[n]=e,++t._eventsCount;return t}function g(t,n,e){var r=!1;function o(){t.removeListener(n,o),r||(r=!0,e.apply(t,arguments))}return o.listener=e,o}function w(t){var n=this._events;if(n){var e=n[t];if("function"==typeof e)return 1;if(e)return e.length}return 0}function b(t,n){for(var e=new Array(n);n--;)e[n]=t[n];return e}function E(t){return Array.isArray(t)}function S(t){return"function"==typeof t}function T(t){return"string"==typeof t}function L(t){return"object"===n(t)}function A(t){return!(null===t||!L(t))&&Object.getPrototypeOf(t)===Object.prototype}function O(t){return!!T(t)||!!E(t)&&t.every((function(t){return T(t)}))}function _(t){return t.reduce((function(t,n){return-1===t.indexOf(n)?[].concat(a(t),[n]):t}),[])}function j(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=setTimeout.apply(void 0,[t,0].concat(e));return function(){clearTimeout(o)}}function x(t){var n,e=!1;return{fn:function(){return e||(n=t.apply(void 0,arguments)),n},revoke:function(){e=!0}}}function I(t,n,r){for(var a={},c=arguments.length,u=new Array(c>3?c-3:0),s=3;s<c;s++)u[s-3]=arguments[s];function f(t){return a[t]=p(t)+1,function(){return l(t)}}function l(t){var n=p(t)-1;a[t]=Math.max(n,0)}function p(t){return a[t]||0}function v(){return o({},a)}function h(){return Object.keys(a).sort().map((function(t){return[t,a[t]]})).map((function(t){var r,o=i(t,2),a=o[0],c=o[1];return e(r={},n,a),e(r,"refs",c||"None"),r}))}function d(){return{description:"Statebot[".concat(t,"]: ").concat(r,":"),table:h()}}return[].concat(u).flat().forEach((function(t){a[t]=0})),{increase:f,decrease:l,countOf:p,toValue:d,refs:v}}function C(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(e,r){for(var o=Object.entries(r).map((function(t){var n=i(t,2);return{argName:n[0],argType:n[1]}})),a=Object.keys(r).join(", "),c=arguments.length,u=new Array(c>2?c-2:0),s=2;s<c;s++)u[s-2]=arguments[s];var f=u.map((function(t,e){var r,i,a,c=o[e],u=c.argName,s=c.argType;return void 0===t?'Argument undefined: "'.concat(u,'"'):(S(s)?(a=!0===s(t),i=s.name,r="".concat(i,"(").concat(u,") did not return true")):(a=n(t)===s,i=s,r='Argument "'.concat(u,'" should be a ').concat(i)),a?void 0:"".concat(r,": ").concat(u," === ").concat(n(t),"(").concat(t,")"))})).filter(Boolean);return f.length?"\n".concat(t).concat(e,"(").concat(a,"):\n")+"".concat(f.map((function(t){return"> ".concat(t)})).join("\n")):void 0}}function P(t){var n=t;function e(){return n>=1}function r(){return n>=2}function o(){return n>=3}return T(n)&&(n={info:3,log:2,warn:1,none:0}[n]||3),{canWarn:e,canLog:r,canInfo:o,info:function(){var t;return o()&&(t=console).info.apply(t,arguments)},table:function(){var t;return r()&&(t=console).table.apply(t,arguments)},log:function(){var t;return r()&&(t=console).log.apply(t,arguments)},warn:function(){var t;return e()&&(t=console).warn.apply(t,arguments)},error:function(){var t;return(t=console).error.apply(t,arguments)}}}s.prototype=Object.create(null),f.EventEmitter=f,f.usingDomains=!1,f.prototype.domain=void 0,f.prototype._events=void 0,f.prototype._maxListeners=void 0,f.defaultMaxListeners=10,f.init=function(){this.domain=null,f.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new s,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},f.prototype.getMaxListeners=function(){return l(this)},f.prototype.emit=function(t){var n,e,r,o,i,a,c,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(c=this.domain,u){if(n=arguments[1],!c){if(n instanceof Error)throw n;var s=new Error('Uncaught, unspecified "error" event. ('+n+")");throw s.context=n,s}return n||(n=new Error('Uncaught, unspecified "error" event')),n.domainEmitter=this,n.domain=c,n.domainThrown=!1,c.emit("error",n),!1}if(!(e=a[t]))return!1;var f="function"==typeof e;switch(r=arguments.length){case 1:p(e,f,this);break;case 2:v(e,f,this,arguments[1]);break;case 3:h(e,f,this,arguments[1],arguments[2]);break;case 4:d(e,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(r-1),i=1;i<r;i++)o[i-1]=arguments[i];y(e,f,this,o)}return!0},f.prototype.addListener=function(t,n){return m(this,t,n,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(t,n){return m(this,t,n,!0)},f.prototype.once=function(t,n){if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return this.on(t,g(this,t,n)),this},f.prototype.prependOnceListener=function(t,n){if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,g(this,t,n)),this},f.prototype.removeListener=function(t,n){var e,r,o,i,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(e=r[t]))return this;if(e===n||e.listener&&e.listener===n)0==--this._eventsCount?this._events=new s:(delete r[t],r.removeListener&&this.emit("removeListener",t,e.listener||n));else if("function"!=typeof e){for(o=-1,i=e.length;i-- >0;)if(e[i]===n||e[i].listener&&e[i].listener===n){a=e[i].listener,o=i;break}if(o<0)return this;if(1===e.length){if(e[0]=void 0,0==--this._eventsCount)return this._events=new s,this;delete r[t]}else!(function(t,n){for(var e=n,r=e+1,o=t.length;r<o;e+=1,r+=1)t[e]=t[r];t.pop()})(e,o);r.removeListener&&this.emit("removeListener",t,a||n)}return this},f.prototype.removeAllListeners=function(t){var n,e;if(!(e=this._events))return this;if(!e.removeListener)return 0===arguments.length?(this._events=new s,this._eventsCount=0):e[t]&&(0==--this._eventsCount?this._events=new s:delete e[t]),this;if(0===arguments.length){for(var r,o=Object.keys(e),i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new s,this._eventsCount=0,this}if("function"==typeof(n=e[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},f.prototype.listeners=function(t){var n,e=this._events;return e&&(n=e[t])?"function"==typeof n?[n.listener||n]:(function(t){for(var n=new Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];return n})(n):[]},f.listenerCount=function(t,n){return"function"==typeof t.listenerCount?t.listenerCount(n):w.call(t,n)},f.prototype.listenerCount=w,f.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var N=/[\r\n]/,k="|",D="->",M=[k,D].map((function(t){return t.replace("|","\\|")})).join("|"),R=new RegExp("(".concat(M,")$")),U=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,F=/(\/\/[^\n\r]*)/,B=C("statebot.");function W(t){var n=B("decomposeRoute",{templateLiteral:O},t);if(n)throw TypeError(n);return G($(t)).flat(2)}function Y(t){var n=B("decomposeChart",{chart:O},t);if(n)throw TypeError(n);var e=G($(t)),r=e.map(H).flat(1).map(V).flat(1),o=!1,i=_(r.map((function(t){return t.includes("")&&(o=!0),t.join(D)}))),a=_(e.flat(3));return{transitions:i.map((function(t){return t.split(D)})),routes:i,states:o?a:a.filter(Boolean)}}function $(t){var n=(function(t){return[t].flat().reduce((function(t,n){return[].concat(a(t),[n.split(N)])}),[]).flat()})(t),e=[],r=!1,o=n.reduce((function(t,n){var o=n.replace(F,"").replace(U,"");return o?(r=R.test(o))?t+o:(e.push(t+o),""):t}),"");return r||o?[].concat(e,[o]):[].concat(e)}function G(t){return t.map((function(t){return t.split(D).map((function(t){return t.split(k)}))}))}function H(t){var n=[];return t.reduce((function(t,e){return!1===t||n.push([t,a(e)]),a(e)}),!1),n}function V(t){var n=i(t,2),e=n[0],r=n[1];return e.reduce((function(t,n){return[].concat(a(t),a(r.map((function(t){return[n,t]}))))}),[])}function K(t,n){var e=[],r=[];return{configs:t.reduce((function(t,o){var c=o.routeChart,u=o.action,s=Y(c),f=s.states,l=s.routes,p=s.transitions;return n()&&(e.push.apply(e,a(f)),r.push.apply(r,a(l))),[].concat(a(t),a(p.map((function(t){var n=i(t,2);return{fromState:n[0],toState:n[1],action:u}}))))}),[]),states:e,routes:r}}function z(t){return A(t)&&"number"==typeof t.__STATEBOT__}var q=C("statebot.");var J=0;function Q(){var t=Date.now();function n(t,n){return t.toFixed(n).replace(/\.0+$/,"")}return function(){var e=Date.now()-t;return e<500?"".concat(n(e)," ms"):e<5e3?"".concat(n(e/1e3,2)," s "):e<6e4?"".concat(n(e/1e3,1)," s "):"".concat(n(e/1e3/60,1)," m ")}}t.Statebot=function(t,n){if(!T(t))throw TypeError("\nStatebot: Please specify a name for this machine");var r="Statebot[".concat(t,"]");if(!A(n))throw TypeError("\n".concat(r,": Please specify options for this machine"));var c,u=n||{},s=u.chart,l=void 0===s?void 0:s,p=u.logLevel,v=void 0===p?3:p,h=u.historyLimit,d=void 0===h?2:h,y=void 0===n.events?new f:L(c=n.events)&&S(c.emit)&&(S(c.addListener)||S(c.on))&&(S(c.removeListener)||S(c.off))&&(function(t){var n=function(){return t.emit.apply(t,arguments)},e=t.addListener?function(){return t.addListener.apply(t,arguments)}:function(){return t.on.apply(t,arguments)},r=t.removeListener?function(){return t.removeListener.apply(t,arguments)}:function(){return t.off.apply(t,arguments)};return{emit:n,addListener:e,removeListener:r}})(n.events);if(!y)throw TypeError("\n".concat(r,": Invalid event-emitter specified in options"));var m=l?Y(l):n,g=m.states,w=void 0===g?[]:g,b=m.routes,O=void 0===b?[]:b,_=n.startIn,j=void 0===_?w[0]:_;if(!w.includes(j))throw Error("".concat(r,': Starting-state not in chart: "').concat(j,'"'));var x=C("".concat(r,"#")),N=P(v),k=N.canWarn,M=[j],R=Math.max(d,2),U=new f,F={onSwitching:"(ANY)state:changing",onSwitched:"(ANY)state:changed"},B=0,W=(function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=!!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]);function e(e){return function(){return n?(t(),!1):e.apply(void 0,arguments)}}return{Pausable:e,paused:function(){return n},pause:function(){n=!0},resume:function(){n=!1}}})(!1,(function(){return N.warn("".concat(r,": Ignoring callback, paused"))})),$=W.pause,G=W.resume,H=W.paused,V=W.Pausable,z=V((function(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return U.emit.apply(U,[t].concat(e))}));function q(t,n){return U.addListener(t,n),function(){return U.removeListener(t,n)}}var J=I(t,"states","Listening for the following state-changes",a(w)),Q=I(t,"transitions","Listening for the following transitions",a(O)),X=I(t,"events","Listening for the following events");function Z(n,r){var c=S(n)?n({enter:it,emit:ot,Enter:ft,Emit:st}):A(n)?n:null;if(!A(c))throw TypeError("Statebot[".concat(t,"]#").concat(r,"(): Expected an object, or a function that returns an object"));var u={},s=[];Object.entries(c).forEach((function(t){var n=i(t,2),e=n[0],r=n[1];if(S(r))s.push({routeChart:e,action:r});else if(!A(r))return;var o=r.on,a=r.then;T(o)||E(o)?[o].flat().forEach((function(t){u[t]=u[t]||[],u[t].push({routeChart:e,action:a})})):S(a)&&s.push({routeChart:e,action:r})}));var f=[],l=[],p=[],v=Object.entries(u).reduce((function(t,n){var r=i(n,2),c=r[0],u=K(r[1],k),s=u.states,p=u.routes,v=u.configs;return k()&&(f.push.apply(f,a(s)),l.push.apply(l,a(p))),o(o({},t),{},e({},c,v))}),{}),h=function(t){var n=t.fromState,e=t.toState,r=t.action,o=t.args;return rt(n,(function(){return it.apply(void 0,[e].concat(a(o))),S(r)&&r.apply(void 0,a(o)),!0}))};p.push.apply(p,a(Object.entries(v).map((function(t){var n=i(t,2),e=n[0],r=n[1];return[X.increase(e),at(e,(function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=r.map((function(t){return o(o({},t),{},{args:n})})).some(h);a||lt('Event not handled: "'.concat(e,'"'))}))]})).flat()));var d=K(s,k);if(k()&&(f.push.apply(f,a(d.states)),l.push.apply(l,a(d.routes))),p.push.apply(p,a(d.configs.map((function(t){var n=t.fromState,e=t.toState,r=t.action,o="".concat(n,"->").concat(e);return[Q.increase(o),q(o,r)]})).flat())),k()){var y=f.filter((function(t){return!w.includes(t)})),m=l.filter((function(t){return!O.includes(t)}));y.length&&N.warn("Statebot[".concat(t,"]#").concat(r,"(): Invalid states specified:\n")+y.map((function(t){return'  > "'.concat(t,'"')})).join("\n")),m.length&&N.warn("Statebot[".concat(t,"]#").concat(r,"(): Invalid transitions specified:\n")+m.map((function(t){return'  > "'.concat(t,'"')})).join("\n"))}return function(){return p.forEach((function(t){return t()}))}}function tt(){return M[M.length-2]}function nt(){return M[M.length-1]}function et(t){var n=void 0!==t?t:nt(),e=x("statesAvailableFromHere",{state:T},n);if(e)throw TypeError(e);return O.reduce((function(t,e){var r=i(e.split(D).map((function(t){return t.trim()})),2),o=r[0],c=r[1];return o===n?[].concat(a(t),[c]):t}),[])}function rt(t,n){var e=x("inState",{state:T},t);if(e)throw TypeError(e);var r=nt()===t;if(void 0===n)return r;if(!r)return null;if(S(n)){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];return n.apply(void 0,i)}return n}var ot=V((function(t){var n=x("emit",{eventName:T},t);if(n)throw TypeError(n);for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return y.emit.apply(y,[t].concat(r))})),it=V((function(t){var n=x("enter",{state:T},t);if(n)throw TypeError(n);var e=nt(),o=t;if(o===e)return lt('Already in state: "'.concat(o,'"')),!1;if(!w.includes(o))return lt('Invalid state "'.concat(o,'", not switching')),!1;var i="".concat(e,"->").concat(o);if(!O.includes(i))return lt('Invalid transition "'.concat(i,'", not switching')),!1;N.info("".concat(r,": tId<").concat(++B,">: ").concat(i)),M.push(o),M.length>R&&M.shift();for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return z.apply(void 0,[F.onSwitching,o,e].concat(c)),z.apply(void 0,[i].concat(c)),z.apply(void 0,[F.onSwitched,o,e].concat(c)),!0}));function at(t,n){var e=x("onEvent",{eventName:T,cb:S},t,n);if(e)throw TypeError(e);return y.addListener(t,n),function(){return y.removeListener(t,n)}}var ct=Object.keys(F).reduce((function(t,n){return o(o({},t),{},e({},n,(function(t){var e=x(n,{cb:S},t);if(e)throw TypeError(e);var r=J.increase(F[n]),o=q(F[n],t);return function(){o(),r()}})))}),{}),ut=[["Exiting","onSwitching"],["Entering","onSwitching"],["Exited","onSwitched"],["Entered","onSwitched"]].reduce((function(t,n){var r=i(n,2),a=r[0],c=r[1],u="on".concat(a),s=a.toLowerCase();return o(o({},t),{},e({},u,(function(t,n){var e=x(u,{state:T,cb:S},t,n);if(e)throw TypeError(e);var r=[J.increase(t),J.increase("".concat(t,":").concat(s))],o=ct[c]((function(e,r){for(var o=arguments.length,i=new Array(o>2?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];0===a.indexOf("Exit")?t===r&&n.apply(void 0,[e].concat(i)):t===e&&n.apply(void 0,[r].concat(i))}));return function(){o(),r.map((function(t){return t()}))}})))}),{});function st(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=x("Emit",{eventName:T},t);if(o)throw TypeError(o);return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return ot.apply(void 0,[t].concat([].concat(e,r)))}}function ft(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=x("Enter",{state:T},t);if(o)throw TypeError(o);return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return it.apply(void 0,[t].concat([].concat(e,r)))}}function lt(t){var n=tt(),e=nt(),o="".concat(void 0===n?"[undefined]":n,"->").concat(e),i=et();i.length?N.info("".concat(r,": ").concat(t,"\n")+'  > Previous transition: "'.concat(o,'"\n')+'  > From "'.concat(e,'", valid states are: [').concat(i.map((function(t){return'"'.concat(t,'"')})).join(", "),"]")):N.info("".concat(r,": ").concat(t,"\n")+'  > Previous transition: "'.concat(o,'"\n')+'  > There are no states available from "'.concat(e,'"'))}function pt(t){var n=t.toValue(),e=n.description,r=n.table;N.log(e),r.length?N.table(r):N.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=n.flat(),o=x("canTransitionTo",{state:T},r[0]);if(o)throw TypeError(o);if(!r.length)return!1;var i=et();return r.every((function(t){return i.includes(t)}))},currentState:nt,emit:ot,Emit:st,enter:it,Enter:ft,history:function(){return[].concat(M)},info:function(){return N.log("".concat(r,": Information about this state-machine")),pt(J),pt(Q),void pt(X)},inspect:function(){return{states:J.refs(),transitions:Q.refs(),events:X.refs()}},inState:rt,InState:function(t,n){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];var i=x("InState",{state:T},t);if(i)throw TypeError(i);return function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];return rt.apply(void 0,[t,n].concat([].concat(r,o)))}},name:function(){return t},onEntered:ut.onEntered,onEntering:ut.onEntering,onEvent:at,onExited:ut.onExited,onExiting:ut.onExiting,onSwitched:ct.onSwitched,onSwitching:ct.onSwitching,onTransitions:function(t){return Z(t,"onTransitions")},pause:$,paused:H,performTransitions:function(t){return Z(t,"performTransitions")},previousState:tt,reset:function(){N.warn("".concat(r,": State-machine reset!")),M.length=0,M.push(j)},resume:G,statesAvailableFromHere:et}},t.assertRoute=function(t,n,r){var i=q("assertRoute",{machine:z,expectedRoute:O},t,n);if(i)throw TypeError(i);J+=1;var c=r||{},u=c.description,s=void 0===u?"Assertion complete":u,f=c.fromState,l=void 0===f?"":f,p=c.run,v=void 0===p?function(){}:p,h=c.permittedDeviations,d=void 0===h?0:h,y=c.timeoutInMs,m=void 0===y?1e3:y,g=c.logLevel,w=P(void 0===g?3:g),b="Statebot[".concat(t.name(),"]: aId<").concat(J,">"),E=W(n);w.log("\n".concat(b,": Asserting route: [").concat(E.join(" > "),"]")),w.log("".concat(b,': > Assertion will start from state: "').concat(l,'"'));var S,T,L=(S=v,function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return j.apply(void 0,[S].concat(n))}),A=function(){},_=Q(),I=Q(),C=0,N=!0,k=!1,D=a(E),M=(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[],i=t.map((function(t,e){return n[e]||"center"})),c=!1;function u(){c=!0}function s(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];if(!c){var u=t.reduce((function(t,n,r){var a=i[r]||"";return o(o({},t),{},e({},n,a))}),{});r.push(u)}}function f(){return r.reduce((function(n,e){return t.map((function(t,r){return Math.max(e[t].length,n[r])}))}),t.map((function(){return 0})))}function l(t,n){return t+" ".repeat(n-t.length)}function p(t,n){return" ".repeat(n-t.length)+t}function v(){var n=f();function c(t,e){var r=n[e],o=i[e];return"left"===o?l(t,r):"right"===o?p(t,r):t}return r.reduce((function(n,r){var i=t.reduce((function(t,n,i){return o(o({},t),{},e({},n,c(r[n],i)))}),{});return[].concat(a(n),[i])}),[])}return{lock:u,addRow:s,content:v}})(["state","expected","info","took"],["center","center","left","right"]),R=(function(t){var n,e=x(t),r=e.revoke,o=e.fn;return function(){return n=o.apply(void 0,arguments),r(),n}})((function(t){return U("","","","TOTAL: "+_()),M.lock(),w.log("\n".concat(b,": ").concat(s,": [").concat(t?"FAILED":"SUCCESS","]")),w.table(M.content()),t})),U=M.addRow;return new Promise((function(n,e){if(0!==D.length){var r=function(n){for(;D.length;){var r=D.shift();U(t.currentState(),"(".concat(r,")"),n),k=!1}!(function(t){clearTimeout(T),A(),c(),e(t)})(R(new Error(n)))};t.inState(l)&&(N=!1,A=L());var o=x((function(t){T=setTimeout((function(){i(),r("TIMEOUT")}),m),(function(t){if(N)U(t,"-","PENDING");else{var n=D[0];n===t?(U(t,n,k?"REALIGNED":"OKAY",I()),k=!1,D.shift()):(U(t,n,"WRONG STATE",I()),k=!0,C+=1),I=Q()}})(t),N&&t===l&&(N=!1,A=L()),C>d&&(i(),r("TOO MANY DEVIATIONS")),D.length<=0&&(i(),(function(){clearTimeout(T),A(),c(),n.apply(void 0,arguments)})(R()))})),i=o.revoke,a=o.fn,c=t.onSwitching(a)}else e(R(new Error("NO ROUTE TO TEST")))}))},t.decomposeChart=Y,t.isStatebot=z,t.routeIsPossible=function(t,n){var e=q("routeIsPossible",{machine:z,route:O},t,n);if(e)throw TypeError(e);var r=W(n);return r.every((function(n,e){if(e===r.length-1)return!0;var o=r[e+1];return t.statesAvailableFromHere(n).includes(o)}))},Object.defineProperty(t,"__esModule",{value:!0})}));
