/*
 * Statebot
 * v2.3.5
 * https://shuckster.github.io/statebot/
 * License: ISC
 */
function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}function n(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function e(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))}))}return t}function o(t,n){return(function(t){if(Array.isArray(t))return t})(t)||(function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return e})(t,n)||a(t,n)||(function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function i(t){return(function(t){if(Array.isArray(t))return c(t)})(t)||(function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)})(t)||a(t)||(function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function a(t,n){if(t){if("string"==typeof t)return c(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,n):void 0}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function u(){}function s(){s.init.call(this)}function f(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function l(t,n,e){if(n)t.call(e);else for(var r=t.length,o=w(t,r),i=0;i<r;++i)o[i].call(e)}function p(t,n,e,r){if(n)t.call(e,r);else for(var o=t.length,i=w(t,o),a=0;a<o;++a)i[a].call(e,r)}function v(t,n,e,r,o){if(n)t.call(e,r,o);else for(var i=t.length,a=w(t,i),c=0;c<i;++c)a[c].call(e,r,o)}function h(t,n,e,r,o,i){if(n)t.call(e,r,o,i);else for(var a=t.length,c=w(t,a),u=0;u<a;++u)c[u].call(e,r,o,i)}function y(t,n,e,r){if(n)t.apply(e,r);else for(var o=t.length,i=w(t,o),a=0;a<o;++a)i[a].apply(e,r)}function d(t,n,e,r){var o,i,a,c;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if((i=t._events)?(i.newListener&&(t.emit("newListener",n,e.listener?e.listener:e),i=t._events),a=i[n]):(i=t._events=new u,t._eventsCount=0),a){if("function"==typeof a?a=i[n]=r?[e,a]:[a,e]:r?a.unshift(e):a.push(e),!a.warned&&(o=f(t))&&o>0&&a.length>o){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=n,s.count=a.length,c=s,"function"==typeof console.warn?console.warn(c):console.log(c)}}else a=i[n]=e,++t._eventsCount;return t}function m(t,n,e){var r=!1;function o(){t.removeListener(n,o),r||(r=!0,e.apply(t,arguments))}return o.listener=e,o}function g(t){var n=this._events;if(n){var e=n[t];if("function"==typeof e)return 1;if(e)return e.length}return 0}function w(t,n){for(var e=new Array(n);n--;)e[n]=t[n];return e}u.prototype=Object.create(null),s.EventEmitter=s,s.usingDomains=!1,s.prototype.domain=void 0,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.init=function(){this.domain=null,s.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new u,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return f(this)},s.prototype.emit=function(t){var n,e,r,o,i,a,c,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(c=this.domain,u){if(n=arguments[1],!c){if(n instanceof Error)throw n;var s=new Error('Uncaught, unspecified "error" event. ('+n+")");throw s.context=n,s}return n||(n=new Error('Uncaught, unspecified "error" event')),n.domainEmitter=this,n.domain=c,n.domainThrown=!1,c.emit("error",n),!1}if(!(e=a[t]))return!1;var f="function"==typeof e;switch(r=arguments.length){case 1:l(e,f,this);break;case 2:p(e,f,this,arguments[1]);break;case 3:v(e,f,this,arguments[1],arguments[2]);break;case 4:h(e,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(r-1),i=1;i<r;i++)o[i-1]=arguments[i];y(e,f,this,o)}return!0},s.prototype.addListener=function(t,n){return d(this,t,n,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,n){return d(this,t,n,!0)},s.prototype.once=function(t,n){if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return this.on(t,m(this,t,n)),this},s.prototype.prependOnceListener=function(t,n){if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,m(this,t,n)),this},s.prototype.removeListener=function(t,n){var e,r,o,i,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(e=r[t]))return this;if(e===n||e.listener&&e.listener===n)0==--this._eventsCount?this._events=new u:(delete r[t],r.removeListener&&this.emit("removeListener",t,e.listener||n));else if("function"!=typeof e){for(o=-1,i=e.length;i-- >0;)if(e[i]===n||e[i].listener&&e[i].listener===n){a=e[i].listener,o=i;break}if(o<0)return this;if(1===e.length){if(e[0]=void 0,0==--this._eventsCount)return this._events=new u,this;delete r[t]}else!(function(t,n){for(var e=n,r=e+1,o=t.length;r<o;e+=1,r+=1)t[e]=t[r];t.pop()})(e,o);r.removeListener&&this.emit("removeListener",t,a||n)}return this},s.prototype.removeAllListeners=function(t){var n,e;if(!(e=this._events))return this;if(!e.removeListener)return 0===arguments.length?(this._events=new u,this._eventsCount=0):e[t]&&(0==--this._eventsCount?this._events=new u:delete e[t]),this;if(0===arguments.length){for(var r,o=Object.keys(e),i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new u,this._eventsCount=0,this}if("function"==typeof(n=e[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},s.prototype.listeners=function(t){var n,e=this._events;return e&&(n=e[t])?"function"==typeof n?[n.listener||n]:(function(t){for(var n=new Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];return n})(n):[]},s.listenerCount=function(t,n){return"function"==typeof t.listenerCount?t.listenerCount(n):g.call(t,n)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var b=N,E=function(t){return M(t)&&k(t.emit)&&k(t.addListener)&&k(t.removeListener)},S=k,T=function(t){if(null===t||!M(t))return!1;return Object.getPrototypeOf(t)===Object.prototype},A=D,O=function(t){if(D(t))return!0;if(N(t))return t.every((function(t){return D(t)}));return!1},L=function(t){return t.reduce((function(t,n){return-1===t.indexOf(n)?[].concat(i(t),[n]):t}),[])},_=function(t){return function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return R.apply(void 0,[t].concat(e))}},j=function(t){var n,e=U(t),r=e.revoke,o=e.fn;return function(){return n=o.apply(void 0,arguments),r(),n}},x=U,C=function(t,e,i){for(var a={},c=arguments.length,u=new Array(c>3?c-3:0),s=3;s<c;s++)u[s-3]=arguments[s];function f(t){return a[t]=p(t)+1,function(){return l(t)}}function l(t){var n=p(t)-1;a[t]=Math.max(n,0)}function p(t){return a[t]||0}function v(){return r({},a)}function h(){return Object.keys(a).sort().map((function(t){return[t,a[t]]})).map((function(t){var r,i=o(t,2),a=i[0],c=i[1];return n(r={},e,a),n(r,"refs",c||"None"),r}))}function y(){return{description:"Statebot[".concat(t,"]: ").concat(i,":"),table:h()}}return[].concat(u).flat().forEach((function(t){a[t]=0})),{increase:f,decrease:l,countOf:p,toValue:y,refs:v}},I=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(e,r){for(var i=Object.entries(r).map((function(t){var n=o(t,2);return{argName:n[0],argType:n[1]}})),a=Object.keys(r).join(", "),c=arguments.length,u=new Array(c>2?c-2:0),s=2;s<c;s++)u[s-2]=arguments[s];var f=u.map((function(n,e){var r,o,a,c=i[e],u=c.argName,s=c.argType;return void 0===n?'Argument undefined: "'.concat(u,'"'):(k(s)?(a=!0===s(n),o=s.name,r="".concat(o,"(").concat(u,") did not return true")):(a=t(n)===s,o=s,r='Argument "'.concat(u,'" should be a ').concat(o)),a?void 0:"".concat(r,": ").concat(u," === ").concat(t(n),"(").concat(n,")"))})).filter(Boolean);return f.length?"\n".concat(n).concat(e,"(").concat(a,"):\n")+"".concat(f.map((function(t){return"> ".concat(t)})).join("\n")):void 0}},P=function(t){var n=t;D(n)&&(n={info:3,log:2,warn:1,none:0}[n]||3);function e(){return n>=1}function r(){return n>=2}function o(){return n>=3}return{canWarn:e,canLog:r,canInfo:o,info:function(){var t;return o()&&(t=console).info.apply(t,arguments)},table:function(){var t;return r()&&(t=console).table.apply(t,arguments)},log:function(){var t;return r()&&(t=console).log.apply(t,arguments)},warn:function(){var t;return e()&&(t=console).warn.apply(t,arguments)},error:function(){var t;return(t=console).error.apply(t,arguments)}}};function N(t){return Array.isArray(t)}function k(t){return"function"==typeof t}function D(t){return"string"==typeof t}function M(n){return"object"===t(n)}function R(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=setTimeout.apply(void 0,[t,0].concat(e));return function(){clearTimeout(o)}}function U(t){var n,e=!1;return{fn:function(){return e||(n=t.apply(void 0,arguments)),n},revoke:function(){e=!0}}}var F=/[\r\n]/,W="|",Y="->",$=[W,Y].map((function(t){return t.replace("|","\\|")})).join("|"),B=new RegExp("(".concat($,")$")),G=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,H=/(\/\/[^\n\r]*)/,V={cxPipe:W,cxArrow:Y,rxDisallowedCharacters:G,decomposeChart:function(t){var n=q("decomposeChart",{chart:z},t);if(n)throw TypeError(n);var e=Q(J(t)).map(X).flat(1).map(Z).flat(1),r=[],o=e.map((function(t){return r.push.apply(r,i(t)),t.join(Y)})),a=K(o),c=K(r);return{transitions:a.map((function(t){return t.split(Y)})),routes:a,states:c}},decomposeRoute:function(t){var n=q("decomposeRoute",{templateLiteral:z},t);if(n)throw TypeError(n);return Q(J(t)).flat(2)}},K=L,z=O,q=I("statebot.");function J(t){var n=(function(t){return[t].flat().reduce((function(t,n){return[].concat(i(t),[n.split(F)])}),[]).flat()})(t),e=[];return n.reduce((function(t,n){var r=n.replace(H,"").replace(G,"");return r?B.test(r)?t+r:(e.push(t+r),""):t}),""),e}function Q(t){return t.map((function(t){return t.split(Y).map((function(t){return t.split(W)}))}))}function X(t){var n=[];return t.reduce((function(t,e){return!1===t||n.push([t,i(e)]),i(e)}),!1),n}function Z(t){var n=o(t,2),e=n[0],r=n[1];return e.reduce((function(t,n){return[].concat(i(t),i(r.map((function(t){return[n,t]}))))}),[])}var tt=function(t,e){if(!at(t))throw TypeError("\nStatebot: Please specify a name for this machine");var a="Statebot[".concat(t,"]");if(!it(e))throw TypeError("\n".concat(a,": Please specify options for this machine"));var c=e||{},u=c.chart,f=void 0===u?void 0:u,l=c.logLevel,p=void 0===l?3:l,v=c.historyLimit,h=void 0===v?2:v,y=ct("".concat(a,"#")),d=ut(p),m=d.canWarn,g=f?ft(f):e,w=g.states,b=void 0===w?[]:w,E=g.routes,S=void 0===E?[]:E,T=e.startIn,A=void 0===T?b[0]:T;if(!b.includes(A))throw Error("".concat(a,': Starting-state not in chart: "').concat(A,'"'));var O=0,L=[A],_=Math.max(h,2),j=rt(e.events)?e.events:new s,x=new s,C={onSwitching:"(ANY)state:changing",onSwitched:"(ANY)state:changed"};function I(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return x.emit.apply(x,[t].concat(e))}function P(t,n){return x.addListener(t,n),function(){x.removeListener(t,n)}}var N=st(t,"states","Listening for the following state-changes",i(b)),k=st(t,"transitions","Listening for the following transitions",i(S)),D=st(t,"events","Listening for the following events");function M(e,a){var c=ot(e)?e({enter:$,emit:Y,Enter:K,Emit:V}):it(e)?e:null;if(!it(c))throw TypeError("Statebot[".concat(t,"]#").concat(a,"(): Expected an object, or a function that returns an object"));var u={},s=[];Object.entries(c).forEach((function(t){var n=o(t,2),e=n[0],r=n[1];if(ot(r))s.push({routeChart:e,action:r});else if(!it(r))return;var i=r.on,a=r.then;at(i)||et(i)?[i].flat().forEach((function(t){u[t]=u[t]||[],u[t].push({routeChart:e,action:a})})):ot(a)&&s.push({routeChart:e,action:r})}));var f=[],l=[],p=Object.entries(u).reduce((function(t,e){var a=o(e,2),c=a[0],u=pt(a[1],m),s=u.states,p=u.routes,v=u.configs;return m()&&(f.push.apply(f,i(s)),l.push.apply(l,i(p))),r(r({},t),{},n({},c,v))}),{}),v=[];v.push.apply(v,i(Object.entries(p).map((function(t){var n=o(t,2),e=n[0],r=n[1];return[D.increase(e),B(e,(function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=r.some((function(t){var e=t.fromState,r=t.toState,o=t.action;return!!W(e,(function(){return $.apply(void 0,[r].concat(n)),ot(o)&&o.apply(void 0,n),!0}))}));i||z('Event not handled: "'.concat(e,'"'))}))]})).flat()));var h=pt(s,m);if(m()&&(f.push.apply(f,i(h.states)),l.push.apply(l,i(h.routes))),v.push.apply(v,i(h.configs.map((function(t){var n=t.fromState,e=t.toState,r=t.action,o="".concat(n,"->").concat(e);return[k.increase(o),P(o,r)]})).flat())),m()){var y=f.filter((function(t){return!b.includes(t)})),g=l.filter((function(t){return!S.includes(t)}));y.length&&d.warn("Statebot[".concat(t,"]#").concat(a,"(): Invalid states specified:\n")+y.map((function(t){return'  > "'.concat(t,'"')})).join("\n")),g.length&&d.warn("Statebot[".concat(t,"]#").concat(a,"(): Invalid transitions specified:\n")+g.map((function(t){return'  > "'.concat(t,'"')})).join("\n"))}return function(){return v.forEach((function(t){return t()}))}}function R(){return L[L.length-2]}function U(){return L[L.length-1]}function F(t){var n=void 0!==t?t:U(),e=y("statesAvailableFromHere",{state:at},n);if(e)throw TypeError(e);return S.reduce((function(t,e){var r=o(e.split(lt).map((function(t){return t.trim()})),2),a=r[0],c=r[1];return a===n?[].concat(i(t),[c]):t}),[])}function W(t,n){var e=y("inState",{state:at},t);if(e)throw TypeError(e);var r=U()===t;if(void 0!==n){if(!r)return null;if(ot(n)){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];return n.apply(void 0,i)}return n}return r}function Y(t){var n=y("emit",{eventName:at},t);if(n)throw TypeError(n);for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return j.emit.apply(j,[t].concat(r))}function $(t){var n=y("enter",{state:at},t);if(n)throw TypeError(n);var e=U(),r=t;if(r===e)return z('Already in state: "'.concat(r,'"')),!1;if(!b.includes(r))return z('Invalid state "'.concat(r,'", not switching')),!1;var o="".concat(e,"->").concat(r);if(!S.includes(o))return z('Invalid transition "'.concat(o,'", not switching')),!1;d.info("".concat(a,": tId<").concat(++O,">: ").concat(o)),L.push(r),L.length>_&&L.shift();for(var i=arguments.length,c=new Array(i>1?i-1:0),u=1;u<i;u++)c[u-1]=arguments[u];return I.apply(void 0,[C.onSwitching,r,e].concat(c)),I.apply(void 0,[o].concat(c)),I.apply(void 0,[C.onSwitched,r,e].concat(c)),!0}function B(t,n){var e=y("onEvent",{eventName:at,cb:ot},t,n);if(e)throw TypeError(e);return j.addListener(t,n),function(){return j.removeListener(t,n)}}var G=Object.keys(C).reduce((function(t,e){return r(r({},t),{},n({},e,(function(t){var n=y(e,{cb:ot},t);if(n)throw TypeError(n);var r=N.increase(C[e]),o=P(C[e],(function(n,e){for(var r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];t.apply(void 0,[n,e].concat(o))}));return function(){o(),r()}})))}),{}),H=[["Exiting","onSwitching"],["Entering","onSwitching"],["Exited","onSwitched"],["Entered","onSwitched"]].reduce((function(t,e){var i=o(e,2),a=i[0],c=i[1],u="on".concat(a),s=a.toLowerCase();return r(r({},t),{},n({},u,(function(t,n){var e=y(u,{state:at,cb:ot},t,n);if(e)throw TypeError(e);var r=[N.increase(t),N.increase("".concat(t,":").concat(s))],o=G[c]((function(e,r){for(var o=arguments.length,i=new Array(o>2?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];0===a.indexOf("Exit")?t===r&&n.apply(void 0,[e].concat(i)):t===e&&n.apply(void 0,[r].concat(i))}));return function(){o(),r.map((function(t){return t()}))}})))}),{});function V(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=y("Emit",{eventName:at},t);if(o)throw TypeError(o);return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return Y.apply(void 0,[t].concat([].concat(e,r)))}}function K(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=y("Enter",{state:at},t);if(o)throw TypeError(o);return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return $.apply(void 0,[t].concat([].concat(e,r)))}}function z(t){var n=R(),e=U(),r="".concat(void 0===n?"[undefined]":n,"->").concat(e),o=F();o.length?d.info("".concat(a,": ").concat(t,"\n")+'  > Previous transition: "'.concat(r,'"\n')+'  > From "'.concat(e,'", valid states are: [').concat(o.map((function(t){return'"'.concat(t,'"')})).join(", "),"]")):d.info("".concat(a,": ").concat(t,"\n")+'  > Previous transition: "'.concat(r,'"\n')+'  > There are no states available from "'.concat(e,'"'))}function q(t){var n=t.toValue(),e=n.description,r=n.table;d.log(e),r.length?d.table(r):d.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=n.flat(),o=y("canTransitionTo",{state:at},r[0]);if(o)throw TypeError(o);if(!r.length)return!1;var i=F();return r.every((function(t){return i.includes(t)}))},currentState:U,emit:Y,Emit:V,enter:$,Enter:K,history:function(){return[].concat(L)},info:function(){return d.log("".concat(a,": Information about this state-machine")),q(N),q(k),void q(D)},inspect:function(){return{states:N.refs(),transitions:k.refs(),events:D.refs()}},inState:W,InState:function(t,n){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];var i=y("InState",{state:at},t);if(i)throw TypeError(i);return function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];return W.apply(void 0,[t,n].concat([].concat(r,o)))}},name:function(){return t},onEntered:H.onEntered,onEntering:H.onEntering,onEvent:B,onExited:H.onExited,onExiting:H.onExiting,onSwitched:G.onSwitched,onSwitching:G.onSwitching,onTransitions:function(t){return M(t,"onTransitions")},performTransitions:function(t){return M(t,"performTransitions")},previousState:R,reset:function(){d.warn("".concat(a,": State-machine reset!")),L.length=0,L.push(A)},statesAvailableFromHere:F}},nt=function(t){return it(t)&&"number"==typeof t.__STATEBOT__},et=b,rt=E,ot=S,it=T,at=A,ct=I,ut=P,st=C,ft=V.decomposeChart,lt=V.cxArrow;function pt(t,n){var e=[],r=[];return{configs:t.reduce((function(t,a){var c=a.routeChart,u=a.action,s=ft(c),f=s.states,l=s.routes,p=s.transitions;return n()&&(e.push.apply(e,i(f)),r.push.apply(r,i(l))),[].concat(i(t),i(p.map((function(t){var n=o(t,2);return{fromState:n[0],toState:n[1],action:u}}))))}),[]),states:e,routes:r}}var vt=function(t,n){var e=St("routeIsPossible",{machine:yt,route:Et},t,n);if(e)throw TypeError(e);var r=dt(n);return r.every((function(n,e){if(e===r.length-1)return!0;var o=r[e+1];return t.statesAvailableFromHere(n).includes(o)}))},ht=function(t,e,o){var a=St("assertRoute",{machine:yt,expectedRoute:Et},t,e);if(a)throw TypeError(a);Tt+=1;var c=o||{},u=c.description,s=void 0===u?"Assertion complete":u,f=c.fromState,l=void 0===f?"":f,p=c.run,v=void 0===p?function(){}:p,h=c.permittedDeviations,y=void 0===h?0:h,d=c.timeoutInMs,m=void 0===d?1e3:d,g=c.logLevel,w=bt(void 0===g?3:g),b="Statebot[".concat(t.name(),"]: aId<").concat(Tt,">"),E=dt(e);w.log("\n".concat(b,": Asserting route: [").concat(E.join(" > "),"]")),w.log("".concat(b,': > Assertion will start from state: "').concat(l,'"'));var S,T=mt(v),A=function(){},O=At(),L=At(),_=0,j=!0,x=!1,C=i(E),I=(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=[],a=t.map((function(t,n){return e[n]||"center"})),c=!1;function u(){c=!0}function s(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];if(!c){var u=t.reduce((function(t,e,o){var a=i[o]||"";return r(r({},t),{},n({},e,a))}),{});o.push(u)}}function f(){return o.reduce((function(n,e){return t.map((function(t,r){return Math.max(e[t].length,n[r])}))}),t.map((function(){return 0})))}function l(t,n){return t+" ".repeat(n-t.length)}function p(t,n){return" ".repeat(n-t.length)+t}function v(){var e=f();return o.reduce((function(o,c){var u=t.reduce((function(t,o,i){return r(r({},t),{},n({},o,(function(t,n){var r=e[n],o=a[n];return"left"===o?l(t,r):"right"===o?p(t,r):t})(c[o],i)))}),{});return[].concat(i(o),[u])}),[])}return{lock:u,addRow:s,content:v}})(["state","expected","info","took"],["center","center","left","right"]),P=gt((function(t){return N("","","","TOTAL: "+O()),I.lock(),w.log("\n".concat(b,": ").concat(s,": [").concat(t?"FAILED":"SUCCESS","]")),w.table(I.content()),t})),N=I.addRow;return new Promise((function(n,e){if(0!==C.length){var r=function(n){for(;C.length;){var r=C.shift();N(t.currentState(),"(".concat(r,")"),n),x=!1}!(function(t){clearTimeout(S),A(),c(),e(t)})(P(new Error(n)))};t.inState(l)&&(j=!1,A=T());var o=wt((function(t){S=setTimeout((function(){i(),r("TIMEOUT")}),m),(function(t){if(j)N(t,"-","PENDING");else{var n=C[0];n===t?(N(t,n,x?"REALIGNED":"OKAY",L()),x=!1,C.shift()):(N(t,n,"WRONG STATE",L()),x=!0,_+=1),L=At()}})(t),j&&t===l&&(j=!1,A=T()),_>y&&(i(),r("TOO MANY DEVIATIONS")),C.length<=0&&(i(),(function(){clearTimeout(S),A(),c(),n.apply(void 0,arguments)})(P()))})),i=o.revoke,a=o.fn,c=t.onSwitching(a)}else e(P(new Error("NO ROUTE TO TEST")))}))},yt=nt,dt=V.decomposeRoute,mt=_,gt=j,wt=x,bt=P,Et=O,St=I("statebot.");var Tt=0;function At(){var t=Date.now();function n(t,n){return t.toFixed(n).replace(/\.0+$/,"")}return function(){var e=Date.now()-t;return e<500?"".concat(n(e)," ms"):e<5e3?"".concat(n(e/1e3,2)," s "):e<6e4?"".concat(n(e/1e3,1)," s "):"".concat(n(e/1e3/60,1)," m ")}}var Ot={Statebot:tt,isStatebot:nt,routeIsPossible:vt,assertRoute:ht,decomposeChart:V.decomposeChart};export default Ot;
