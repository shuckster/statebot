!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("events")):"function"==typeof define&&define.amd?define(["events"],n):"object"==typeof exports?exports.statebot=n(require("events")):t.statebot=n(t.events)}(window,(function(t){return function(t){var n={};function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)r.d(e,o,function(n){return t[n]}.bind(null,o));return e},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=3)}([function(t,n){function r(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],e=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(e=(a=c.next()).done)&&(r.push(a.value),!n||r.length!==n);e=!0);}catch(t){o=!0,i=t}finally{try{e||null==c.return||c.return()}finally{if(o)throw i}}return r}(t,n)||c(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function o(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(n){i(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}function i(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function a(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,n){if(t){if("string"==typeof t)return u(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,n):void 0}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];var o=setTimeout.apply(void 0,[t,0].concat(r));return function(){clearTimeout(o)}}function l(t){var n,r=!1;return{fn:function(){return r||(n=t.apply(void 0,arguments)),n},revoke:function(){r=!0}}}t.exports={isEventEmitter:function(t){return"object"===f(t)&&"function"==typeof t.emit&&"function"==typeof t.addListener&&"function"==typeof t.removeListener},isPojo:function(t){if(null===t||"object"!==f(t))return!1;return Object.getPrototypeOf(t)===Object.prototype},isTemplateLiteral:function(t){if("string"==typeof t)return!0;if(Array.isArray(t))return t.every((function(t){return"string"==typeof t}));return!1},uniq:function(t){return t.reduce((function(t,n){return-1===t.indexOf(n)?[].concat(a(t),[n]):t}),[])},Defer:function(t){return function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];return s.apply(void 0,[t].concat(r))}},Once:function(t){var n,r=l(t),e=r.revoke,o=r.fn;return function(){return n=o.apply(void 0,arguments),e(),n}},Revokable:l,ReferenceCounter:function(t,n,e){for(var a={},c=arguments.length,u=new Array(c>3?c-3:0),f=3;f<c;f++)u[f-3]=arguments[f];function s(t){return a[t]=p(t)+1,function(){return l(t)}}function l(t){var n=p(t)-1;a[t]=Math.max(n,0)}function p(t){return a[t]||0}function y(){return o({},a)}function v(){return Object.keys(a).sort().map((function(t){return[t,a[t]]})).map((function(t){var e,o=r(t,2),a=o[0],c=o[1];return i(e={},n,a),i(e,"refs",c||"None"),e}))}function d(){return{description:"Statebot[".concat(t,"]: ").concat(e,":"),table:v()}}return[].concat(u).flat().forEach((function(t){a[t]=0})),{increase:s,decrease:l,countOf:p,toValue:d,refs:y}},ArgTypeError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(n,e){for(var o=Object.entries(e).map((function(t){var n=r(t,2);return{argName:n[0],argType:n[1]}})),i=Object.keys(e).join(", "),a=arguments.length,c=new Array(a>2?a-2:0),u=2;u<a;u++)c[u-2]=arguments[u];var s=c.map((function(t,n){var r,e,i,a=o[n],c=a.argName,u=a.argType;return void 0===t?'Argument undefined: "'.concat(c,'"'):("function"==typeof u?(i=!0===u(t),e=u.name,r="".concat(e,"(").concat(c,") did not return true")):(i=f(t)===u,e=u,r='Argument "'.concat(c,'" should be a ').concat(e)),i?void 0:"".concat(r,": ").concat(c," === ").concat(f(t),"(").concat(t,")"))})).filter(Boolean);return s.length?"\n".concat(t).concat(n,"(").concat(i,"):\n")+"".concat(s.map((function(t){return"> ".concat(t)})).join("\n")):void 0}},Logger:function(t){var n=t;"string"==typeof n&&(n={info:3,log:2,warn:1,none:0}[n]||3);function r(){return n>=1}function e(){return n>=2}function o(){return n>=3}return{canWarn:r,canLog:e,canInfo:o,info:function(){var t;return o()&&(t=console).info.apply(t,arguments)},table:function(){var t;return e()&&(t=console).table.apply(t,arguments)},log:function(){var t;return e()&&(t=console).log.apply(t,arguments)},warn:function(){var t;return r()&&(t=console).warn.apply(t,arguments)},error:function(){var t;return(t=console).error.apply(t,arguments)}}}}},function(t,n,r){function e(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],e=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(e=(a=c.next()).done)&&(r.push(a.value),!n||r.length!==n);e=!0);}catch(t){o=!0,i=t}finally{try{e||null==c.return||c.return()}finally{if(o)throw i}}return r}(t,n)||i(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,n){if(t){if("string"==typeof t)return a(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,n):void 0}}function a(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var c="|",u="->",f=/[^a-z0-9!@#$%^&*:_+=<>|~.\x2D]/gi,s=/[\r\n]/,l=/(\/\/[^\n\r]*)/,p=[c,u].map((function(t){return t.replace("|","\\|")})).join("|"),y=new RegExp("(".concat(p,")$"));t.exports={cxPipe:c,cxArrow:u,rxDisallowedCharacters:f,decomposeChart:function(t){var n=h("decomposeChart",{templateLiteral:b},t);if(n)throw TypeError(n);var r=S(w(g([t].flat()))).map(O).flat(1).map(A).flat(1),e=[],i=r.map((function(t){return e.push.apply(e,o(t)),t.join(u)})),a=d(i),c=d(e);return{transitions:a.map((function(t){return t.split(u)})),routes:a,states:c}},decomposeRoute:function(t){var n=h("decomposeRoute",{templateLiteral:b},t);if(n)throw TypeError(n);return S(w(g([t].flat()))).flat(2)}};var v=r(0),d=v.uniq,m=v.ArgTypeError,b=v.isTemplateLiteral,h=m("statebot.");function g(t){return t.reduce((function(t,n){return"string"!=typeof n?t:[].concat(o(t),o(n.split(s).map((function(t){return t.replace(l,"")}))))}),[]).filter(Boolean)}function w(t){return t.reduce((function(t,n){return y.test(n.trim())?{lines:t.lines,currentLine:t.currentLine+n}:{lines:[].concat(o(t.lines),[t.currentLine+n]),currentLine:""}}),{lines:[],currentLine:""}).lines}function S(t){return t.map((function(t){return t.split(u).map((function(t){return t.replace(f,"").split(c).map((function(t){return t.trim()}))}))}))}function O(t){return t.reduce((function(t,n){return!1===t?{previousStates:o(n),pairs:[]}:{previousStates:o(n),pairs:[].concat(o(t.pairs),[[o(t.previousStates),o(n)]])}}),!1).pairs}function A(t){var n=e(t,2),r=n[0],i=n[1];return r.reduce((function(t,n){return[].concat(o(t),o(i.map((function(t){return[n,t]}))))}),[])}},function(t,n,r){function e(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function o(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function i(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],e=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(e=(a=c.next()).done)&&(r.push(a.value),!n||r.length!==n);e=!0);}catch(t){o=!0,i=t}finally{try{e||null==c.return||c.return()}finally{if(o)throw i}}return r}(t,n)||c(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,n){if(t){if("string"==typeof t)return u(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,n):void 0}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}t.exports={Statebot:function(t,n){if("string"!=typeof t)throw TypeError("\nStatebot: Please specify a name for this machine");var r="Statebot[".concat(t,"]");if(!l(n))throw TypeError("\n".concat(r,": Please specify options for this machine"));var c=n||{},u=c.chart,s=void 0===u?void 0:u,m=c.logLevel,g=void 0===m?3:m,w=c.historyLimit,S=void 0===w?2:w,O=p("".concat(r,"#")),A=y(g),E=A.canWarn,j=s?b(s):n,T=j.states,I=void 0===T?[]:T,P=j.routes,x=void 0===P?[]:P,N=n.startIn;void 0===N&&(N=I[0]);if(!I.includes(N))throw Error("".concat(r,': Starting-state not in chart: "').concat(N,'"'));var L=0,D=[N],C=Math.max(S,2),_=v(n.events)?n.events:new f,R=new f,G={STATE_CHANGING:"(ANY)state:changing",STATE_CHANGED:"(ANY)state:changed"};function M(t){var n=O("emitInternalEvent",{eventName:"string"},t);if(n)throw TypeError(n);for(var r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];return R.emit.apply(R,[t].concat(e))}function k(t,n){var r=O("onInternalEvent",{eventName:"string",fn:"function"},t,n);if(r)throw TypeError(r);return R.addListener(t,n),function(){R.removeListener(t,n)}}var H=d(t,"states","Listening for the following state-changes",a(I)),U=d(t,"transitions","Listening for the following transitions",a(x)),$=d(t,"events","Listening for the following events");function F(n,r){var c="function"==typeof n?n({enter:Q,emit:K,Enter:J,Emit:z}):l(n)?n:null;if(!l(c))throw TypeError("Statebot[".concat(t,"]#").concat(r,"(): Expected an object, or a function that returns an object"));var u={},f=[];Object.entries(c).forEach((function(t){var n=i(t,2),r=n[0],e=n[1];if("function"==typeof e)f.push({routeChart:r,action:e});else if(!l(e))return;var o=e.on,a=e.then;"string"==typeof o||Array.isArray(o)?[o].flat().forEach((function(t){u[t]=u[t]||[],u[t].push({routeChart:r,action:a})})):"function"==typeof a&&f.push({routeChart:r,action:e})}));var s=[],p=[],y=Object.entries(u).reduce((function(t,n){var r=i(n,2),c=r[0],u=q(r[1]),f=u.states,l=u.routes,y=u.configs;return E()&&(s.push.apply(s,a(f)),p.push.apply(p,a(l))),function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(n){o(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}({},t,o({},c,y))}),{}),v=[];v.push.apply(v,a(Object.entries(y).map((function(t){var n=i(t,2),r=n[0],e=n[1];return[$.increase(r),X(r,(function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=e.some((function(t){var r=t.fromState,e=t.toState,o=t.action;return!!V(r,(function(){return Q.apply(void 0,[e].concat(n)),"function"==typeof o&&o.apply(void 0,n),!0}))}));i||nt('Event not handled: "'.concat(r,'"'))}))]})).flat()));var d=q(f);if(E()&&(s.push.apply(s,a(d.states)),p.push.apply(p,a(d.routes))),v.push.apply(v,a(d.configs.map((function(t){var n=t.fromState,r=t.toState,e=t.action,o="".concat(n,"->").concat(r);return[U.increase(o),k(o,e)]})).flat())),E()){var m=s.filter((function(t){return!I.includes(t)})),b=p.filter((function(t){return!x.includes(t)}));m.length&&A.warn("Statebot[".concat(t,"]#").concat(r,"(): Invalid states specified:\n")+m.map((function(t){return'  > "'.concat(t,'"')})).join("\n")),b.length&&A.warn("Statebot[".concat(t,"]#").concat(r,"(): Invalid transitions specified:\n")+b.map((function(t){return'  > "'.concat(t,'"')})).join("\n"))}return function(){return v.forEach((function(t){return t()}))}}function q(t){var n=[],r=[];return{configs:t.reduce((function(t,e){var o=e.routeChart,c=e.action,u=b(o),f=u.states,s=u.routes,l=u.transitions;return E()&&(n.push.apply(n,a(f)),r.push.apply(r,a(s))),[].concat(a(t),a(l.map((function(t){var n=i(t,2);return{fromState:n[0],toState:n[1],action:c}}))))}),[]),states:n,routes:r}}function B(){return D[D.length-2]}function Y(){return D[D.length-1]}function V(t,n){var r=O("inState",{state:"string"},t);if(r)throw TypeError(r);var e=Y()===t;if(void 0!==n){if(!e)return null;if("function"==typeof n){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];return n.apply(void 0,i)}return n}return e}function W(t){var n=void 0!==t?t:Y(),r=O("statesAvailableFromHere",{state:"string"},n);if(r)throw TypeError(r);return x.reduce((function(t,r){var e=i(r.split(h).map((function(t){return t.trim()})),2),o=e[0],c=e[1];return o===n?[].concat(a(t),[c]):t}),[])}function z(t){var n=O("Emit",{eventName:"string"},t);if(n)throw TypeError(n);return function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];return K.apply(void 0,[t].concat(r))}}function K(t){var n=O("emit",{eventName:"string"},t);if(n)throw TypeError(n);for(var r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];return _.emit.apply(_,[t].concat(e))}function J(t){var n=O("Enter",{state:"string"},t);if(n)throw TypeError(n);return function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];return Q.apply(void 0,[t].concat(r))}}function Q(t){var n=O("enter",{state:"string"},t);if(n)throw TypeError(n);var e=Y(),o=t;if(o===e)return nt('Already in state: "'.concat(o,'"')),!1;if(!I.includes(o))return nt('Invalid state "'.concat(o,'", not switching')),!1;var i="".concat(e,"->").concat(o);if(!x.includes(i))return nt('Invalid transition "'.concat(i,'", not switching')),!1;A.info("".concat(r,": tId<").concat(++L,">: ").concat(i)),D.push(o),D.length>C&&D.shift();for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return M.apply(void 0,[G.STATE_CHANGING,o,e].concat(c)),M.apply(void 0,[i].concat(c)),M.apply(void 0,[G.STATE_CHANGED,o,e].concat(c)),!0}function X(t,n){var r=O("onEvent",{eventName:"string",cb:"function"},t,n);if(r)throw TypeError(r);return _.addListener(t,n),function(){_.removeListener(t,n)}}function Z(t){var n=O("onSwitching",{cb:"function"},t);if(n)throw TypeError(n);var r=H.increase(G.STATE_CHANGING),e=k(G.STATE_CHANGING,(function(n,r){for(var e=arguments.length,o=new Array(e>2?e-2:0),i=2;i<e;i++)o[i-2]=arguments[i];t.apply(void 0,[n,r].concat(o))}));return function(){e(),r()}}function tt(t){var n=O("onSwitched",{cb:"function"},t);if(n)throw TypeError(n);var r=H.increase(G.STATE_CHANGED),e=k(G.STATE_CHANGED,(function(n,r){for(var e=arguments.length,o=new Array(e>2?e-2:0),i=2;i<e;i++)o[i-2]=arguments[i];t.apply(void 0,[n,r].concat(o))}));return function(){e(),r()}}function nt(t){var n=B(),e=Y(),o="".concat(void 0===n?"[undefined]":n,"->").concat(e),i=W();i.length?A.info("".concat(r,": ").concat(t,"\n")+'  > Previous transition: "'.concat(o,'"\n')+'  > From "'.concat(e,'", valid states are: [').concat(i.map((function(t){return'"'.concat(t,'"')})).join(", "),"]")):A.info("".concat(r,": ").concat(t,"\n")+'  > Previous transition: "'.concat(o,'"\n')+'  > There are no states available from "'.concat(e,'"'))}function rt(t){var n=t.toValue(),r=n.description,e=n.table;A.log(r),e.length?A.table(e):A.log("  > No information")}return{__STATEBOT__:1,canTransitionTo:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n.flat(),o=O("canTransitionTo",{state:"string"},e[0]);if(o)throw TypeError(o);if(!e.length)return!1;var i=W();return e.every((function(t){return i.includes(t)}))},currentState:Y,emit:K,Emit:z,enter:Q,Enter:J,history:function(){return[].concat(D)},info:function(){return A.log("".concat(r,": Information about this state-machine")),rt(H),rt(U),void rt($)},inspect:function(){return{states:H.refs(),transitions:U.refs(),events:$.refs()}},inState:V,InState:function(t,n){var r=O("InState",{state:"string"},t);if(r)throw TypeError(r);return function(){for(var r=arguments.length,e=new Array(r),o=0;o<r;o++)e[o]=arguments[o];return V.apply(void 0,[t,n].concat(e))}},name:function(){return t},onEntered:function(t,n){var r=O("onEntered",{state:"string",cb:"function"},t,n);if(r)throw TypeError(r);var e=[H.increase(t),H.increase("".concat(t,":entered"))],o=tt((function(r,e){if(t===r){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];n.apply(void 0,[e].concat(i))}}));return function(){o(),e.map((function(t){return t()}))}},onEntering:function(t,n){var r=O("onEntering",{state:"string",cb:"function"},t,n);if(r)throw TypeError(r);var e=[H.increase(t),H.increase("".concat(t,":entering"))],o=Z((function(r,e){if(t===r){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];n.apply(void 0,[e].concat(i))}}));return function(){o(),e.map((function(t){return t()}))}},onEvent:X,onExited:function(t,n){var r=O("onExited",{state:"string",cb:"function"},t,n);if(r)throw TypeError(r);var e=[H.increase(t),H.increase("".concat(t,":exited"))],o=tt((function(r,e){if(t===e){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];n.apply(void 0,[r].concat(i))}}));return function(){o(),e.map((function(t){return t()}))}},onExiting:function(t,n){var r=O("onExiting",{state:"string",cb:"function"},t,n);if(r)throw TypeError(r);var e=[H.increase(t),H.increase("".concat(t,":exiting"))],o=Z((function(r,e){if(t===e){for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];n.apply(void 0,[r].concat(i))}}));return function(){o(),e.map((function(t){return t()}))}},onSwitched:tt,onSwitching:Z,onTransitions:function(t){return F(t,"onTransitions")},performTransitions:function(t){return F(t,"performTransitions")},previousState:B,reset:function(){A.warn("".concat(r,": State-machine reset!")),D.length=0,D.push(N)},statesAvailableFromHere:W}},isStatebot:function(t){return l(t)&&"number"==typeof t.__STATEBOT__}};var f=r(4),s=r(0),l=s.isPojo,p=s.ArgTypeError,y=s.Logger,v=s.isEventEmitter,d=s.ReferenceCounter,m=r(1),b=m.decomposeChart,h=m.cxArrow},function(t,n,r){var e=r(2),o=e.Statebot,i=e.isStatebot,a=r(5),c=a.assertRoute,u=a.routeIsPossible,f=r(1).decomposeChart;t.exports={Statebot:o,isStatebot:i,routeIsPossible:u,assertRoute:c,decomposeChart:f}},function(n,r){n.exports=t},function(t,n,r){function e(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function o(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(n){i(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}function i(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return c(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}t.exports={routeIsPossible:function(t,n){var r=b("routeIsPossible",{machine:u,expectedRoute:m},t,n);if(r)throw TypeError(r);var e=f(n);return e.every((function(n,r){if(r===e.length-1)return!0;var o=e[r+1];return t.statesAvailableFromHere(n).includes(o)}))},assertRoute:function(t,n,r){var e=b("assertRoute",{machine:u,expectedRoute:m},t,n);if(e)throw TypeError(e);h+=1;var c=r||{},s=c.description,d=void 0===s?"Assertion complete":s,w=c.fromState,S=void 0===w?"":w,O=c.run,A=void 0===O?function(){}:O,E=c.permittedDeviations,j=void 0===E?0:E,T=c.timeoutInMs,I=void 0===T?1e3:T,P=c.logLevel,x=v(void 0===P?3:P),N="Statebot[".concat(t.name(),"]: aId<").concat(h,">"),L=f(n);x.log("\n".concat(N,": Asserting route: [").concat(L.join(" > "),"]")),x.log("".concat(N,': > Assertion will start from state: "').concat(S,'"'));var D,C=l(A),_=function(){},R=g(),G=g(),M=0,k=!0,H=!1,U=a(L),$=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[],e=t.map((function(t,r){return n[r]||"center"})),c=!1;function u(){c=!0}function f(){for(var n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];if(!c){var u=t.reduce((function(t,n,r){return o({},t,i({},n,e[r]||""))}),{});r.push(u)}}function s(){return r.reduce((function(n,r){return t.map((function(t,e){return Math.max(r[t].length,n[e])}))}),t.map((function(){return 0})))}function l(t,n){return t+" ".repeat(n-t.length)}function p(t,n){return" ".repeat(n-t.length)+t}function y(){var n=s();return r.reduce((function(r,c){var u=t.reduce((function(t,r,a){return o({},t,i({},r,function(t,r){var o=n[r],i=e[r];return"left"===i?l(t,o):"right"===i?p(t,o):t}(c[r],a)))}),{});return[].concat(a(r),[u])}),[])}return{lock:u,addRow:f,content:y}}(["state","expected","info","took"],["center","center","left","right"]),F=p((function(t){return q("","","","TOTAL: "+R()),$.lock(),x.log("\n".concat(N,": ").concat(d,": [").concat(t?"FAILED":"SUCCESS","]")),x.table($.content()),t})),q=$.addRow;return new Promise((function(n,r){if(0!==U.length){var e=function(n){for(;U.length;){var e=U.shift();q(t.currentState(),"(".concat(e,")"),n),H=!1}!function(t){clearTimeout(D),_(),c(),r(t)}(F(new Error(n)))};t.inState(S)&&(k=!1,_=C());var o=y((function(t){D=setTimeout((function(){i(),e("TIMEOUT")}),I),function(t){if(k)q(t,"-","PENDING");else{var n=U[0];n===t?(q(t,n,H?"REALIGNED":"OKAY",G()),H=!1,U.shift()):(q(t,n,"WRONG STATE",G()),H=!0,M+=1),G=g()}}(t),k&&t===S&&(k=!1,_=C()),M>j&&(i(),e("TOO MANY DEVIATIONS")),U.length<=0&&(i(),function(){clearTimeout(D),_(),c(),n.apply(void 0,arguments)}(F()))})),i=o.revoke,a=o.fn,c=t.onSwitching(a)}else r(F(new Error("NO ROUTE TO TEST")))}))}};var u=r(2).isStatebot,f=r(1).decomposeRoute,s=r(0),l=s.Defer,p=s.Once,y=s.Revokable,v=s.Logger,d=s.ArgTypeError,m=s.isTemplateLiteral,b=d("statebot.");var h=0;function g(){var t=Date.now();function n(t,n){return t.toFixed(n).replace(/\.0+$/,"")}return function(){var r=Date.now()-t;return r<500?"".concat(n(r)," ms"):r<5e3?"".concat(n(r/1e3,2)," s "):r<6e4?"".concat(n(r/1e3,1)," s "):"".concat(n(r/1e3/60,1)," m ")}}}])}));