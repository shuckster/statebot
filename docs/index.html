<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>statebot</title><meta name="description" content="Documentation for statebot"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">statebot</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2> statebot</h2></div>
<div class="tsd-panel tsd-typography"><h1 align="center">
  statebot 🤖
</h1>

<p align="center">
  <a href="https://github.com/shuckster/statebot/blob/master/LICENSE">
    <img
      alt="MIT license"
      src="https://img.shields.io/npm/l/statebot?style=plastic"
    /></a>
  <a href="https://bundlephobia.com/result?p=statebot">
    <img
      alt="npm bundle size"
      src="https://img.shields.io/bundlephobia/minzip/statebot?style=plastic"
    /></a>
  <a href="https://www.npmjs.com/package/statebot">
    <img
      alt="Version"
      src="https://img.shields.io/npm/v/statebot?style=plastic"
    /></a>
</p>

<p>Describe the states and allowed transitions of a program using a flowchart-like syntax. Switch to states directly, or by wiring-up events. Statebot is an <a href="https://en.wikipedia.org/wiki/Finite-state_machine">FSM</a>.</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Statebot</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;statebot&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">machine</span><span class="hl-1"> = </span><span class="hl-6">Statebot</span><span class="hl-1">(</span><span class="hl-3">&#39;traffic-lights&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">chart:</span><span class="hl-1"> </span><span class="hl-3">`</span><br/><span class="hl-3">    go -&gt;</span><br/><span class="hl-3">      prepare-to-stop -&gt;</span><br/><span class="hl-3">      stop</span><br/><br/><span class="hl-3">    // ...gotta keep that traffic flowing</span><br/><span class="hl-3">    stop -&gt;</span><br/><span class="hl-3">      prepare-to-go -&gt;</span><br/><span class="hl-3">      go</span><br/><span class="hl-3">  `</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">performTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;stop -&gt; prepare-to-go -&gt; go&#39;</span><span class="hl-2">:</span><span class="hl-1">   { </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;timer&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;go -&gt; prepare-to-stop -&gt; stop&#39;</span><span class="hl-2">:</span><span class="hl-1"> { </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;timer&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onEvent</span><span class="hl-1">(</span><span class="hl-3">&#39;timer&#39;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">redrawTrafficLights</span><span class="hl-1">()</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">redrawTrafficLights</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">inState</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">&#39;stop&#39;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Draw red light&#39;</span><span class="hl-1">),</span><br/><br/><span class="hl-1">    </span><span class="hl-3">&#39;prepare-to-go&#39;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Draw red + yellow lights&#39;</span><span class="hl-1">),</span><br/><br/><span class="hl-1">    </span><span class="hl-3">&#39;go&#39;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Draw green light&#39;</span><span class="hl-1">),</span><br/><br/><span class="hl-1">    </span><span class="hl-3">&#39;prepare-to-stop&#39;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Draw yellow light&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">setInterval</span><span class="hl-1">(</span><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">Emit</span><span class="hl-1">(</span><span class="hl-3">&#39;timer&#39;</span><span class="hl-1">), </span><span class="hl-7">2000</span><span class="hl-1">)</span>
</code></pre>
<p><a href="https://codesandbox.io/s/statebot-traffic-lights-kin5y">CodeSandbox</a> of the above example.</p>
<p>It&#39;s less than 6K gzipped, runs in Node and the browser, and is a <a href="https://github.com/shuckster/statebot-sh/">shell-script</a> too.</p>
<ul>
<li><a href="https://shuckster.github.io/statebot/">Full documentation</a></li>
<li><a href="https://github.com/shuckster/statebot">Github Repo</a></li>
</ul>
<p>There are Hooks for these frameworks, too:</p>
<ul>
<li><a href="https://github.com/shuckster/statebot/tree/master/hooks/react">React Hooks</a></li>
<li><a href="https://github.com/shuckster/statebot/tree/master/hooks/mithril">Mithril Hooks</a></li>
</ul>
<p>There is a lot of prior-art out there, most notably <a href="https://github.com/davidkpiano/xstate">XState</a> by David Khourshid, but I hope Statebot can offer a small contribution in the field of writing code that is easier to understand six-months after it has been written.</p>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#quick-start">Quick Start</a><ul>
<li><a href="#react-example">React example</a></li>
<li><a href="#nodejs-example">Node.js example</a></li>
</ul>
</li>
<li><a href="#events">Events</a></li>
<li><a href="#passing-data-around">Passing data around</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#chart-syntax">Chart Syntax</a><ul>
<li><a href="#examples-of-real-charts">Examples of real charts</a></li>
</ul>
</li>
<li><a href="#why">Why?</a></li>
<li><a href="#contributing">Contributing</a><ul>
<li><a href="#credits">Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</li>
</ul>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h1>Installation</h1>
</a>
<pre><code class="language-sh"><span class="hl-1">npm i statebot</span>
</code></pre>
<pre><code class="language-js"><span class="hl-8">&lt;</span><span class="hl-9">script</span><span class="hl-1"> </span><span class="hl-10">src</span><span class="hl-1">=</span><span class="hl-3">&quot;https://unpkg.com/statebot@3.0.2/dist/browser/statebot.min.js&quot;</span><span class="hl-8">&gt;&lt;/</span><span class="hl-9">script</span><span class="hl-8">&gt;</span>
</code></pre>
<p>Or just download a script from the <code>dist/</code> folder and include it in your project. <code>statebot.dev.js</code> files include <code>JSDoc</code> comments, which IDEs like VS Code can pick-up to offer autocompletion.</p>

<a href="#quick-start" id="quick-start" style="color: inherit; text-decoration: none;">
  <h2>Quick Start:</h2>
</a>

<a href="#react-example" id="react-example" style="color: inherit; text-decoration: none;">
  <h3>React example:</h3>
</a>
<p>(You can play around with this in a <a href="https://codesandbox.io/s/statebot-react-ot3xe?file=/src/Loader.js">CodeSandbox</a>.)</p>
<pre><code class="language-jsx"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">React</span><span class="hl-1">, { </span><span class="hl-2">useState</span><span class="hl-1">, </span><span class="hl-2">useEffect</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;react&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Statebot</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;statebot&#39;</span><br/><br/><span class="hl-11">// Statebot is framework agnostic. To use it with React,</span><br/><span class="hl-11">// you might use something like this 3-line Hook:</span><br/><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">useStatebot</span><span class="hl-1">(</span><span class="hl-2">bot</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> [</span><span class="hl-5">state</span><span class="hl-1">, </span><span class="hl-5">setState</span><span class="hl-1">] = </span><span class="hl-6">useState</span><span class="hl-1">(</span><span class="hl-2">bot</span><span class="hl-1">.</span><span class="hl-6">currentState</span><span class="hl-1">())</span><br/><span class="hl-1">  </span><span class="hl-6">useEffect</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">bot</span><span class="hl-1">.</span><span class="hl-6">onSwitched</span><span class="hl-1">(</span><span class="hl-2">setState</span><span class="hl-1">), [</span><span class="hl-2">bot</span><span class="hl-1">])</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">state</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">loader$bot</span><span class="hl-1"> = </span><span class="hl-6">Statebot</span><span class="hl-1">(</span><span class="hl-3">&#39;loader&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">chart:</span><span class="hl-1"> </span><span class="hl-3">`</span><br/><span class="hl-3">    idle -&gt;</span><br/><span class="hl-3">      loading -&gt; (loaded | failed) -&gt;</span><br/><span class="hl-3">      idle</span><br/><span class="hl-3">  `</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">loader$bot</span><span class="hl-1">.</span><span class="hl-6">performTransitions</span><span class="hl-1">(({ </span><span class="hl-2">Emit</span><span class="hl-1"> }) </span><span class="hl-4">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;idle -&gt; loading&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;start-loading&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">then</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">setTimeout</span><span class="hl-1">(</span><span class="hl-6">Emit</span><span class="hl-1">(</span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">), </span><span class="hl-7">1000</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;loading -&gt; loaded&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;success&#39;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;loading -&gt; failed&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;error&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">Enter</span><span class="hl-1">, </span><span class="hl-5">Emit</span><span class="hl-1">, </span><span class="hl-5">inState</span><span class="hl-1"> } = </span><span class="hl-2">loader$bot</span><br/><br/><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">LoadingButton</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">state</span><span class="hl-1"> = </span><span class="hl-6">useStatebot</span><span class="hl-1">(</span><span class="hl-2">loader$bot</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> (</span><br/><span class="hl-1">    </span><span class="hl-8">&lt;</span><span class="hl-9">button</span><br/><span class="hl-1">      </span><span class="hl-10">className</span><span class="hl-1">=</span><span class="hl-4">{</span><span class="hl-2">state</span><span class="hl-4">}</span><br/><span class="hl-1">      </span><span class="hl-10">onClick</span><span class="hl-1">=</span><span class="hl-4">{</span><span class="hl-6">Emit</span><span class="hl-12">(</span><span class="hl-3">&#39;start-loading&#39;</span><span class="hl-12">)</span><span class="hl-4">}</span><br/><span class="hl-1">      </span><span class="hl-10">disabled</span><span class="hl-1">=</span><span class="hl-4">{</span><span class="hl-6">inState</span><span class="hl-12">(</span><span class="hl-3">&#39;loading&#39;</span><span class="hl-12">)</span><span class="hl-4">}</span><br/><span class="hl-1">    </span><span class="hl-8">&gt;</span><br/><span class="hl-1">      </span><span class="hl-4">{</span><span class="hl-6">inState</span><span class="hl-12">({</span><br/><span class="hl-12">        </span><span class="hl-3">&#39;idle&#39;</span><span class="hl-2">:</span><span class="hl-12"> </span><span class="hl-3">&#39;Load&#39;</span><span class="hl-12">,</span><br/><span class="hl-12">        </span><span class="hl-3">&#39;loading&#39;</span><span class="hl-2">:</span><span class="hl-12"> </span><span class="hl-3">&#39;Please wait...&#39;</span><span class="hl-12">,</span><br/><span class="hl-12">        </span><span class="hl-3">&#39;loaded&#39;</span><span class="hl-2">:</span><span class="hl-12"> </span><span class="hl-3">&#39;Done!&#39;</span><span class="hl-12">,</span><br/><span class="hl-12">      })</span><span class="hl-4">}</span><br/><span class="hl-1">      (</span><span class="hl-4">{</span><span class="hl-2">state</span><span class="hl-4">}</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-8">&lt;/</span><span class="hl-9">button</span><span class="hl-8">&gt;</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#nodejs-example" id="nodejs-example" style="color: inherit; text-decoration: none;">
  <h3>Node.js example:</h3>
</a>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">Statebot</span><span class="hl-1"> } = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;statebot&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-11">// Describe states + transitions</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">machine</span><span class="hl-1"> = </span><span class="hl-6">Statebot</span><span class="hl-1">(</span><span class="hl-3">&#39;promise-like&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">chart:</span><span class="hl-1"> </span><span class="hl-3">`</span><br/><br/><span class="hl-3">    idle -&gt;</span><br/><span class="hl-3">      // This one behaves a bit like a Promise</span><br/><span class="hl-3">      pending -&gt;</span><br/><span class="hl-3">        (resolved | rejected) -&gt;</span><br/><span class="hl-3">      done</span><br/><br/><span class="hl-3">  `</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">startIn:</span><span class="hl-1"> </span><span class="hl-3">&#39;pending&#39;</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-11">// Handle events...</span><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">performTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; resolved&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;success&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-11">// ...and/or transitions</span><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; resolved | rejected&#39;</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Sweet!&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onExiting</span><span class="hl-1">(</span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">, </span><span class="hl-2">toState</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Off we go to: </span><span class="hl-4">${</span><span class="hl-2">toState</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">canTransitionTo</span><span class="hl-1">(</span><span class="hl-3">&#39;done&#39;</span><span class="hl-1">)</span><br/><span class="hl-11">// false</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">statesAvailableFromHere</span><span class="hl-1">()</span><br/><span class="hl-11">// [&quot;resolved&quot;, &quot;rejected&quot;]</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-3">&#39;success&#39;</span><span class="hl-1">)</span><br/><span class="hl-11">// &quot;Off we go to: resolved&quot;</span><br/><span class="hl-11">// &quot;Sweet!&quot;</span>
</code></pre>

<a href="#events" id="events" style="color: inherit; text-decoration: none;">
  <h1>Events</h1>
</a>
<p><strong>Statebot</strong> creates state-machines from <code>charts</code>, and we can switch states <code>on</code> events using <code>performTransitions</code>:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">performTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; resolved&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;data-loaded&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-11">// ^ This API is designed to read like this:</span><br/><span class="hl-11">//   machine, perform transition &quot;pending to</span><br/><span class="hl-11">//   resolved&quot; on &quot;data-loaded&quot;.</span>
</code></pre>
<p>Let&#39;s do a little more:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">performTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; rejected&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> [</span><span class="hl-3">&#39;data-error&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;timeout&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">then</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">warn</span><span class="hl-1">(</span><span class="hl-3">&#39;Did something happen?&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-11">// ^ We can run something after a transition</span><br/><span class="hl-11">//   happens with &quot;then&quot;. Notice this will</span><br/><span class="hl-11">//   happen after the &quot;data-error&quot; OR</span><br/><span class="hl-11">//   &quot;timeout&quot; events.</span><br/><br/><span class="hl-1">  </span><span class="hl-3">&#39;resolved | rejected -&gt; done&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> </span><span class="hl-3">&#39;finished&#39;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-11">// ^ We can configure lots of transitions inside</span><br/><span class="hl-11">//   one `performTransitions`. Here&#39;s one that</span><br/><span class="hl-11">//   will switch from &quot;resolved to done&quot; OR</span><br/><span class="hl-11">//   &quot;rejected to done&quot; when the &quot;finished&quot;</span><br/><span class="hl-11">//   event is emitted.</span><br/><br/><span class="hl-1">})</span><br/><br/><span class="hl-11">// In this API, when events are emitted they</span><br/><span class="hl-11">// can pass arguments to the &quot;then&quot; method.</span><br/><br/><span class="hl-11">// See the section below on &quot;Passing data around&quot;.</span>
</code></pre>
<p>We can also do stuff when states switch with <code>onTransitions</code>:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; resolved&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Everything went lovely...&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">enter</span><span class="hl-1">(</span><span class="hl-3">&#39;done&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; rejected&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">warn</span><span class="hl-1">(</span><span class="hl-3">&#39;That did not go so well...&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">enter</span><span class="hl-1">(</span><span class="hl-3">&#39;done&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-3">&#39;resolved | rejected -&gt; done&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;All finished&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span>
</code></pre>
<p>Let&#39;s do a little more:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">(({ </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">Emit</span><span class="hl-1"> }) </span><span class="hl-4">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;idle -&gt; pending&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> () {</span><br/><br/><span class="hl-11">// ^ This API is designed to read like this:</span><br/><span class="hl-11">//   machine, on transition &quot;idle to pending&quot;,</span><br/><span class="hl-11">//   run a callback.</span><br/><br/><span class="hl-1">    </span><span class="hl-6">getSomeData</span><span class="hl-1">().</span><span class="hl-6">then</span><span class="hl-1">(</span><br/><span class="hl-1">      (...</span><span class="hl-2">args</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-3">&#39;data-loaded&#39;</span><span class="hl-1">, ...</span><span class="hl-2">args</span><span class="hl-1">)</span><br/><span class="hl-1">    )</span><br/><br/><span class="hl-11">// ^ emit() or Emit()? Which one to use? Maybe</span><br/><span class="hl-11">//   you can infer the different meanings from</span><br/><span class="hl-11">//   the .catch() of this Promise:</span><br/><br/><span class="hl-1">    .</span><span class="hl-6">catch</span><span class="hl-1">(</span><span class="hl-6">Emit</span><span class="hl-1">(</span><span class="hl-3">&#39;data-error&#39;</span><span class="hl-1">))</span><br/><br/><span class="hl-11">// ^ Got it? Emit() is shorthand for:</span><br/><span class="hl-11">//     (...args) =&gt; emit(&#39;event&#39;, ...args)</span><br/><span class="hl-11">//</span><br/><span class="hl-11">//   So emit() fires immediately, and Emit()</span><br/><span class="hl-11">//   generates an emitter-method.</span><br/><br/><span class="hl-1">  }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-11">// In this API, the state-switching functions</span><br/><span class="hl-11">// enter() and Enter() can pass arguments to</span><br/><span class="hl-11">// these callbacks.</span><br/><br/><span class="hl-11">// See the section below on &quot;Passing data around&quot;.</span>
</code></pre>
<p>Both <code>performTransitions</code> and <code>onTransitions</code> take objects or functions that return objects in order to configure them.</p>
<p>Object:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;idle -&gt; pending&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-11">// etc...</span>
</code></pre>
<p>Function:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">(({ </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">enter</span><span class="hl-1">, </span><span class="hl-2">Emit</span><span class="hl-1">, </span><span class="hl-2">Enter</span><span class="hl-1"> }) </span><span class="hl-4">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;idle -&gt; pending&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-11">// etc...</span>
</code></pre>
<p>In the case of a function, a single argument is passed-in: An object containing helpers for <strong>emitting events</strong> and <strong>entering states</strong>. In the above example we&#39;re pulling-in the helpers <code>emit</code> and <code>enter</code>, and also their corresponding factories: <code>Emit</code> and <code>Enter</code>.</p>
<p>Of course, you don&#39;t have to use an &quot;implicit return&quot;:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">(({ </span><span class="hl-2">emit</span><span class="hl-1">, </span><span class="hl-2">Emit</span><span class="hl-1">, </span><span class="hl-2">enter</span><span class="hl-1">, </span><span class="hl-2">Enter</span><span class="hl-1"> }) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-11">// Setup, closure gubbins and so on...</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">&#39;idle -&gt; pending&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-11">// etc...</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span>
</code></pre>
<p><code>performTransitions</code> hitches onto events, and <code>onTransitions</code> hitches onto state-transitions.</p>
<p>A Statebot FSM can have as many <code>hitchers</code> as you like, or none at all.</p>
<p>In any case, once an FSM is configured we are sometimes only interested in the state we are currently <code>in</code>, about to <code>exit</code>, or about to <code>enter</code>. There are hitchers for those, too:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onExiting</span><span class="hl-1">(</span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">, </span><span class="hl-2">toState</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;we are heading to:&#39;</span><span class="hl-1">, </span><span class="hl-2">toState</span><span class="hl-1">)</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onEntered</span><span class="hl-1">(</span><span class="hl-3">&#39;done&#39;</span><span class="hl-1">, </span><span class="hl-2">fromState</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;we came from:&#39;</span><span class="hl-1">, </span><span class="hl-2">fromState</span><span class="hl-1">)</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">currentState</span><span class="hl-1">()</span><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">previousState</span><span class="hl-1">()</span>
</code></pre>
<p>You can use the following snippet to tinker with the examples above:</p>
<pre><code class="language-js"><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">getSomeData</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-13">Promise</span><span class="hl-1">(</span><br/><span class="hl-1">    (</span><span class="hl-2">resolve</span><span class="hl-1">, </span><span class="hl-2">reject</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">setTimeout</span><span class="hl-1">(</span><span class="hl-2">resolve</span><span class="hl-1">, </span><span class="hl-7">1000</span><span class="hl-1">)</span><br/><br/><span class="hl-1">      </span><span class="hl-11">// Randomly reject</span><br/><span class="hl-1">      </span><span class="hl-6">setTimeout</span><span class="hl-1">(</span><span class="hl-2">reject</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">500</span><span class="hl-1"> + </span><span class="hl-13">Math</span><span class="hl-1">.</span><span class="hl-6">round</span><span class="hl-1">(</span><span class="hl-13">Math</span><span class="hl-1">.</span><span class="hl-6">random</span><span class="hl-1">() * </span><span class="hl-7">750</span><span class="hl-1">)</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-11">// Randomly timeout</span><br/><span class="hl-6">setTimeout</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-3">&#39;timeout&#39;</span><span class="hl-1">, </span><span class="hl-4">true</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-7">750</span><span class="hl-1"> + </span><span class="hl-13">Math</span><span class="hl-1">.</span><span class="hl-6">round</span><span class="hl-1">(</span><span class="hl-13">Math</span><span class="hl-1">.</span><span class="hl-6">random</span><span class="hl-1">() * </span><span class="hl-7">750</span><span class="hl-1">)</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">enter</span><span class="hl-1">(</span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">)</span>
</code></pre>

<a href="#passing-data-around" id="passing-data-around" style="color: inherit; text-decoration: none;">
  <h1>Passing data around</h1>
</a>
<p>Events can pass data to callbacks using <code>emit</code>:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">performTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;pending -&gt; resolved&#39;</span><span class="hl-2">:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">on:</span><span class="hl-1"> [</span><span class="hl-3">&#39;data-loaded&#39;</span><span class="hl-1">], </span><span class="hl-11">// event name(s)</span><br/><span class="hl-1">    </span><span class="hl-6">then</span><span class="hl-2">:</span><span class="hl-1"> (...</span><span class="hl-2">args</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Received:&#39;</span><span class="hl-1">, </span><span class="hl-2">args</span><span class="hl-1">)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-3">&#39;data-loaded&#39;</span><span class="hl-1">, </span><span class="hl-7">1</span><span class="hl-1">, </span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-7">3</span><span class="hl-1">)</span><br/><br/><span class="hl-11">// Console output:</span><br/><span class="hl-11">// &gt; Received: [1, 2, 3]</span>
</code></pre>
<p>The state-switching method <code>enter</code> can pass data, too:</p>
<pre><code class="language-js"><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onTransitions</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;idle -&gt; pending&#39;</span><span class="hl-2">:</span><span class="hl-1"> (...</span><span class="hl-2">args</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;onTransitions:&#39;</span><span class="hl-1">, </span><span class="hl-2">args</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onEntering</span><span class="hl-1">(</span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-2">fromState</span><span class="hl-1">, ...</span><span class="hl-2">args</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;onEntering:&#39;</span><span class="hl-1">, </span><span class="hl-2">args</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">onExited</span><span class="hl-1">(</span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  (</span><span class="hl-2">toState</span><span class="hl-1">, ...</span><span class="hl-2">args</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;onExited:&#39;</span><span class="hl-1">, </span><span class="hl-2">args</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">enter</span><span class="hl-1">(</span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;b&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;c&#39;</span><span class="hl-1">)</span><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">enter</span><span class="hl-1">(</span><span class="hl-3">&#39;resolved&#39;</span><span class="hl-1">, </span><span class="hl-7">3</span><span class="hl-1">, </span><span class="hl-7">2</span><span class="hl-1">, </span><span class="hl-7">1</span><span class="hl-1">)</span><br/><br/><span class="hl-11">// Console output:</span><br/><span class="hl-11">// &gt; onEntering: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span><br/><span class="hl-11">// &gt; onTransitions: [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span><br/><span class="hl-11">// &gt; onExited: [3, 2, 1]</span>
</code></pre>

<a href="#logging" id="logging" style="color: inherit; text-decoration: none;">
  <h1>Logging</h1>
</a>
<p>A Statebot FSM is a pretty noisy thing by default.</p>
<p>You can tone-it down using the <code>logLevel</code> argument in its options:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">machine</span><span class="hl-1"> = </span><span class="hl-6">Statebot</span><span class="hl-1">(</span><span class="hl-3">&#39;example&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-11">// ...</span><br/><span class="hl-1">  </span><span class="hl-2">logLevel:</span><span class="hl-1"> </span><span class="hl-7">2</span><span class="hl-1"> </span><span class="hl-11">// Everything except console.info()</span><br/><span class="hl-1">})</span>
</code></pre>
<ul>
<li>A zero <code>0</code> here means silence</li>
<li>One <code>1</code> prints <code>console.warn()</code>&#39;s</li>
<li>Two <code>2</code> prints warnings, plus <code>console.log()</code> + <code>console.table()</code></li>
<li>Three <code>3</code> prints all the above, plus <code>console.info()</code></li>
</ul>
<p><code>3</code> is the default. Argument type-errors will always <code>throw</code>.</p>

<a href="#testing" id="testing" style="color: inherit; text-decoration: none;">
  <h1>Testing</h1>
</a>
<p><code>assertRoute</code> can be used to test if an FSM traced a particular route:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">assertRoute</span><span class="hl-1"> } = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;statebot/assert&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-6">assertRoute</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">machine</span><span class="hl-1">, </span><span class="hl-3">&#39;pending -&gt; resolved -&gt; done&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-2">description:</span><span class="hl-1"> </span><span class="hl-3">&#39;Data loaded with no issues&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">fromState:</span><span class="hl-1"> </span><span class="hl-3">&#39;idle&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">timeoutInMs:</span><span class="hl-1"> </span><span class="hl-7">1000</span><span class="hl-1"> * </span><span class="hl-7">20</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">permittedDeviations:</span><span class="hl-1"> </span><span class="hl-7">0</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">)</span><br/><span class="hl-1">.</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Assertion passed!&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">.</span><span class="hl-6">catch</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1">(</span><span class="hl-3">`Hot fudge: </span><span class="hl-4">${</span><span class="hl-2">err</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">))</span><br/><br/><span class="hl-2">machine</span><span class="hl-1">.</span><span class="hl-6">enter</span><span class="hl-1">(</span><span class="hl-3">&#39;idle&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>As you can see, it returns a <code>Promise</code> that you can use with an assertion-library.</p>
<p>The method itself produces output using <code>console.table</code>:</p>
<pre><code class="language-bash"><span class="hl-1">[example] aId&lt;1&gt;: Data loaded with no issues: [FAILED]</span><br/><span class="hl-1">┌─────────┬────────────┬────────────┬───────────────────────┬──────────────────┐</span><br/><span class="hl-1">│ (index) │   states   │  expected  │         info          │       took       │</span><br/><span class="hl-1">├─────────┼────────────┼────────────┼───────────────────────┼──────────────────┤</span><br/><span class="hl-1">│    0    │  </span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;pending&#39;</span><span class="hl-1">  │ </span><span class="hl-3">&#39;OKAY               &#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;          2 ms&#39;</span><span class="hl-1"> │</span><br/><span class="hl-1">│    1    │ </span><span class="hl-3">&#39;rejected&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;resolved&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;WRONG STATE        &#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;       0.73 s &#39;</span><span class="hl-1"> │</span><br/><span class="hl-1">│    2    │ </span><span class="hl-3">&#39;rejected&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;resolved&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;TOO MANY DEVIATIONS&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;              &#39;</span><span class="hl-1"> │</span><br/><span class="hl-1">│    3    │ </span><span class="hl-3">&#39;rejected&#39;</span><span class="hl-1"> │  </span><span class="hl-3">&#39;(done)&#39;</span><span class="hl-1">  │ </span><span class="hl-3">&#39;TOO MANY DEVIATIONS&#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;              &#39;</span><span class="hl-1"> │</span><br/><span class="hl-1">│    4    │     </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">     │     </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">     │ </span><span class="hl-3">&#39;                   &#39;</span><span class="hl-1"> │ </span><span class="hl-3">&#39;TOTAL: 0.74 s &#39;</span><span class="hl-1"> │</span><br/><span class="hl-1">└─────────┴────────────┴────────────┴───────────────────────┴──────────────────┘</span>
</code></pre>
<p><code>aId&lt;1&gt;</code> means <code>assertRoute</code> has run once so far.</p>
<p>You can also check if a certain route can be followed with <code>routeIsPossible</code>:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">routeIsPossible</span><span class="hl-1"> } = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;statebot/assert&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-6">routeIsPossible</span><span class="hl-1">(</span><span class="hl-2">machine</span><span class="hl-1">, </span><span class="hl-3">&#39;pending -&gt; resolved -&gt; pending&#39;</span><span class="hl-1">)</span><br/><span class="hl-11">// false</span>
</code></pre>

<a href="#chart-syntax" id="chart-syntax" style="color: inherit; text-decoration: none;">
  <h1>Chart Syntax</h1>
</a>
<p>Statebot charts are just strings, or arrays of strings:</p>
<pre><code class="language-js"><span class="hl-4">var</span><span class="hl-1"> </span><span class="hl-2">oneLiner</span><span class="hl-1"> = </span><span class="hl-3">&#39;-&gt; idle -&gt; done&#39;</span><br/><span class="hl-4">var</span><span class="hl-1"> </span><span class="hl-2">multiLiner</span><span class="hl-1"> = [</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;-&gt; idle&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;idle -&gt; done&#39;</span><br/><span class="hl-1">]</span>
</code></pre>
<p>We can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template Literals</a> to make more readable charts in modern JavaScript:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">chart</span><span class="hl-1"> = </span><span class="hl-3">`</span><br/><span class="hl-3">  -&gt; idle</span><br/><span class="hl-3">  idle -&gt; done</span><br/><span class="hl-3">`</span>
</code></pre>
<p>Charts list all <em>states</em> and the allowed <em>transitions</em> between them using <code>-&gt;</code>.</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fsm</span><span class="hl-1"> = </span><span class="hl-6">Statebot</span><span class="hl-1">(</span><span class="hl-3">&#39;just a name&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">chart:</span><span class="hl-1"> </span><span class="hl-3">`</span><br/><br/><span class="hl-3">    -&gt; idle</span><br/><span class="hl-3">    idle -&gt; done</span><br/><br/><span class="hl-3">  `</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">startIn:</span><span class="hl-1"> </span><span class="hl-3">&#39;idle&#39;</span><br/><span class="hl-1">})</span>
</code></pre>
<p><strong>Careful now:</strong> When <code>startIn</code> is absent the default state is inferred from the first state seen in the chart. Also, empty-strings are valid states: The first-line of this chart allows transitioning from <code>&#39;&#39;</code> to <code>&#39;idle&#39;</code>, and the empty-string would be the starting-state if <code>startIn</code> were omitted.</p>
<p>The pipe-character <code>|</code> means <em>OR</em>:</p>
<p>This...</p>
<pre><code><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt; </span><span class="hl-2">resolved</span><span class="hl-1"> | </span><span class="hl-2">rejected</span><br/><span class="hl-1">  </span><span class="hl-2">resolved</span><span class="hl-1"> | </span><span class="hl-2">rejected</span><span class="hl-1"> -&gt; </span><span class="hl-2">done</span>
</code></pre>
<p>...is shorthand for this...</p>
<pre><code><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt; </span><span class="hl-2">resolved</span><br/><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt; </span><span class="hl-2">rejected</span><br/><span class="hl-1">  </span><span class="hl-2">resolved</span><span class="hl-1"> -&gt; </span><span class="hl-2">done</span><br/><span class="hl-1">  </span><span class="hl-2">rejected</span><span class="hl-1"> -&gt; </span><span class="hl-2">done</span>
</code></pre>
<p>...which is also equivalent to:</p>
<pre><code><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt; (</span><span class="hl-2">resolved</span><span class="hl-1"> | </span><span class="hl-2">rejected</span><span class="hl-1">) -&gt; </span><span class="hl-2">done</span>
</code></pre>
<p>Notice the use of parentheses <code>()</code>. These are completely ignored by the parser and just provide syntactic sugar.</p>
<p>Any lines ending with <code>-&gt;</code> or <code>|</code> are considered to be part of the next line.</p>
<p>This...</p>
<pre><code><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">resolved</span><span class="hl-1"> |</span><br/><span class="hl-1">      </span><span class="hl-2">rejected</span>
</code></pre>
<p>...is the same as this:</p>
<pre><code><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt; </span><span class="hl-2">resolved</span><span class="hl-1"> | </span><span class="hl-2">rejected</span>
</code></pre>
<p>Comments are allowed:</p>
<pre><code><span class="hl-1">  </span><span class="hl-11">// These comments</span><br/><span class="hl-1">  </span><span class="hl-2">pending</span><span class="hl-1"> -&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">resolved</span><span class="hl-1"> |  </span><span class="hl-11">// will be</span><br/><span class="hl-1">      </span><span class="hl-2">rejected</span><span class="hl-1">  </span><span class="hl-11">// ignored</span>
</code></pre>
<p>Indentation has no meaning.</p>

<a href="#examples-of-real-charts" id="examples-of-real-charts" style="color: inherit; text-decoration: none;">
  <h2>Examples of real charts</h2>
</a>
<p>Here are some charts I&#39;ve used with Statebot:</p>

<a href="#web-server" id="web-server" style="color: inherit; text-decoration: none;">
  <h3>Web-server:</h3>
</a>
<pre><code class="language-js"><span class="hl-1">  </span><span class="hl-11">// Email config, static files</span><br/><span class="hl-1">  -&gt; </span><span class="hl-2">booting</span><span class="hl-1"> -&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">email</span><span class="hl-1">-</span><span class="hl-2">config</span><span class="hl-1"> -&gt; </span><span class="hl-2">image</span><span class="hl-1">-</span><span class="hl-2">sizes</span><span class="hl-1"> -&gt; </span><span class="hl-2">templates</span><span class="hl-1"> -&gt; </span><span class="hl-2">pages</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// If pages are ready, start webserver</span><br/><span class="hl-1">  </span><span class="hl-2">pages</span><span class="hl-1"> -&gt; </span><span class="hl-2">webserver</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Problem...?</span><br/><span class="hl-1">        </span><span class="hl-2">booting</span><span class="hl-1"> |</span><br/><span class="hl-1">   </span><span class="hl-2">email</span><span class="hl-1">-</span><span class="hl-2">config</span><span class="hl-1"> |</span><br/><span class="hl-1">    </span><span class="hl-2">image</span><span class="hl-1">-</span><span class="hl-2">sizes</span><span class="hl-1"> |</span><br/><span class="hl-1">      </span><span class="hl-2">templates</span><span class="hl-1"> |</span><br/><span class="hl-1">          </span><span class="hl-2">pages</span><span class="hl-1"> -&gt; </span><span class="hl-2">unrecoverable</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// A watchdog will restart the web-server</span><br/><span class="hl-1">  </span><span class="hl-2">unrecoverable</span><span class="hl-1"> -&gt;  </span><span class="hl-2">report</span><span class="hl-1">-</span><span class="hl-2">and</span><span class="hl-1">-</span><span class="hl-2">quit</span>
</code></pre>

<a href="#email-sender" id="email-sender" style="color: inherit; text-decoration: none;">
  <h3>Email sender:</h3>
</a>
<pre><code class="language-js"><span class="hl-1">  </span><span class="hl-2">idle</span><span class="hl-1"> -&gt; </span><span class="hl-2">send</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Let&#39;s wait a few seconds before committing...</span><br/><span class="hl-1">  (</span><span class="hl-2">send</span><span class="hl-1"> | </span><span class="hl-2">update</span><span class="hl-1">) -&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">debounce</span><span class="hl-1"> -&gt; </span><span class="hl-2">sending</span><span class="hl-1"> |</span><br/><span class="hl-1">      (</span><span class="hl-2">update</span><span class="hl-1"> | </span><span class="hl-2">cancel</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-2">sending</span><span class="hl-1"> -&gt; (</span><span class="hl-2">sent</span><span class="hl-1"> | </span><span class="hl-2">failed</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// All done!</span><br/><span class="hl-1">  (</span><span class="hl-2">sent</span><span class="hl-1"> | </span><span class="hl-2">cancel</span><span class="hl-1"> | </span><span class="hl-2">failed</span><span class="hl-1">) -&gt; </span><span class="hl-2">done</span>
</code></pre>

<a href="#drag-and-drop" id="drag-and-drop" style="color: inherit; text-decoration: none;">
  <h3>Drag-and-drop:</h3>
</a>
<pre><code class="language-js"><span class="hl-1">  </span><span class="hl-2">idle</span><span class="hl-1"> -&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">drag</span><span class="hl-1">-</span><span class="hl-2">detect</span><span class="hl-1"> -&gt;</span><br/><span class="hl-1">      (</span><span class="hl-2">dragging</span><span class="hl-1"> | </span><span class="hl-2">clicked</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Click detected!</span><br/><span class="hl-1">  </span><span class="hl-2">clicked</span><span class="hl-1"> -&gt; </span><span class="hl-2">idle</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Drag detected!</span><br/><span class="hl-1">  </span><span class="hl-2">dragging</span><span class="hl-1"> -&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">drag</span><span class="hl-1">-</span><span class="hl-2">wait</span><span class="hl-1"> -&gt; </span><span class="hl-2">dragged</span><span class="hl-1"> -&gt; </span><span class="hl-2">drag</span><span class="hl-1">-</span><span class="hl-2">wait</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Drag finished...</span><br/><span class="hl-1">  (</span><span class="hl-2">drag</span><span class="hl-1">-</span><span class="hl-2">wait</span><span class="hl-1"> | </span><span class="hl-2">dragged</span><span class="hl-1">) -&gt;</span><br/><span class="hl-1">    (</span><span class="hl-2">drag</span><span class="hl-1">-</span><span class="hl-2">done</span><span class="hl-1"> | </span><span class="hl-2">drag</span><span class="hl-1">-</span><span class="hl-2">cancel</span><span class="hl-1">) -&gt;</span><br/><span class="hl-1">      </span><span class="hl-2">idle</span>
</code></pre>
<p>The <a href="https://shuckster.github.io/statebot/">documentation</a> has a few more examples.</p>

<a href="#why" id="why" style="color: inherit; text-decoration: none;">
  <h1>Why?</h1>
</a>
<blockquote>
<p>&quot;The initial mystery that attends any journey is: How did the traveller reach his starting-point in the first place?&quot; -Louise Bogan</p>
</blockquote>
<p>I wrote Statebot to learn about FSMs, but really I ended up learning more about writing programs in general, and what I do and do not like about the process.</p>
<p>Above all, state-machines are extremely useful when it comes to <em>reading old code</em>. Their innate robustness and predictability are an added bonus.</p>
<p>Understanding the flow of a program I haven&#39;t come back to in a while is exactly what I enjoy the most about using state-machines.</p>
<p>With Statebot itself, code can be marshalled into a shape that &quot;fans-out&quot;:</p>
<ol>
<li><p>The compact <code>chart</code> at the top describes the flow.</p>
</li>
<li><p>The hitchers reveal how <code>transitions</code> happen.</p>
</li>
<li><p>Finally, the <code>callbacks</code> pull-in all the business-logic. (This might still be a huge jumbled mess of course, but at least at this point I&#39;ll have a few leads into what&#39;s supposed to be going on!)</p>
</li>
</ol>
<p>Frankly, this does add a bit of redundancy when using Statebot.</p>
<p>Transitions are repeated between charts and hitchers, and there can be a bit of to-ing and fro-ing to get them right. But for me, the pay-off of being able to jump-in to an old piece of code and grok it quickly is worth it.</p>
<p>The bottom-line with any tool is to use it sparingly and appropriately, and the same applies with Statebot.</p>

<a href="#contributing" id="contributing" style="color: inherit; text-decoration: none;">
  <h1>Contributing</h1>
</a>
<p>I consider the API stable and would not like it to change much. I don&#39;t want it to become a store or data-manager. Many APIs exist that are dedicated to such tasks. I&#39;d really like to keep Statebot lean.</p>
<p>Of course, bug-fixes, forks, and integrations are very welcome! If you feel it has saved you a little pain while trying to grok your own old projects, please consider <a href="https://www.buymeacoffee.com/shuckster">buying me a coffee</a>. :)</p>

<a href="#credits" id="credits" style="color: inherit; text-decoration: none;">
  <h2>Credits</h2>
</a>
<p>With thanks to @szabeszg for the suggestion and <a href="https://github.com/shuckster/statebot/discussions/2">discussion</a> around:</p>
<ul>
<li><code>nextState = peek(eventName)</code></li>
<li><code>canTransitionTo(state, { afterEmitting: event })</code></li>
</ul>
<p> 🙏</p>
<p>Statebot was inspired by a trawl through Wikipedia and Google, which in turn was inspired by <a href="https://github.com/davidkpiano/xstate">XState</a> by David Khourshid. You should check it out.</p>
<p>Statebot integrates <a href="https://www.npmjs.com/package/events">events</a> for the browser-build.</p>
<ul>
<li>Since Statebot 2.5.0 <a href="https://npmjs.com/mitt">mitt</a> is also compatible.</li>
<li>Since Statebot 2.6.0 mitt is used internally.</li>
</ul>
<p>The Statebot logo uses the &quot;You&#39;re Gone&quot; font from <a href="https://typodermicfonts.com/youre-gone/">Typodermic Fonts</a>. The logo was made with <a href="https://flyingmeat.com/acorn/">Acorn</a>. The documentation is written in <a href="https://jsdoc.app/">JSDoc</a> and is built with <a href="https://typedoc.org/">Typedoc</a>.</p>
<p>Statebot was written by <a href="https://github.com/shuckster/">Conan Theobald</a>.</p>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p>Statebot is <a href="./LICENSE">MIT licensed</a>.</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">statebot</a>
<ul>
<li class="tsd-kind-module"><a href="modules/assert.html">assert</a></li>
<li class="tsd-kind-module"><a href="modules/hooks_mithril.html">hooks/mithril</a></li>
<li class="tsd-kind-module"><a href="modules/hooks_react.html">hooks/react</a></li>
<li class="tsd-kind-module"><a href="modules/index.html">index</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>