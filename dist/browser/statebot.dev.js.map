{"version":3,"file":"statebot.dev.js","sources":["../../node_modules/.pnpm/mitt@3.0.0/node_modules/mitt/dist/mitt.mjs","../../src/types.js","../../src/utils.js","../../src/parsing.js","../../src/statebot.js","../../src/assertions.js"],"sourcesContent":["export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i?i.push(e):n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var i=n.get(t);i&&i.slice().map(function(n){n(e)}),(i=n.get(\"*\"))&&i.slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.mjs.map\n","//\n// RUNTIME TYPE CHECKING\n//\n\nexport {\n  isArray,\n  isArguments,\n  isBoolean,\n  isEventEmitter,\n  isFunction,\n  isPojo,\n  isString,\n  isAllStrings,\n  isTemplateLiteral,\n  isNumber,\n  isThisValue,\n  isNull,\n  isUnset,\n  isUndefined,\n  ArgTypeError,\n  ObjTypeError\n}\n\n//\n// isType\n//\n\n// isEventEmitter\n//\nfunction isEventEmitter(obj) {\n  return (\n    isObject(obj) &&\n    isFunction(obj.emit) &&\n    (isFunction(obj.addListener) || isFunction(obj.on)) &&\n    (isFunction(obj.removeListener) || isFunction(obj.off))\n  )\n}\n\nisEventEmitter.displayName = 'isEventEmitter'\n\n// isUnset\n//\nfunction isUnset(obj) {\n  return isNull(obj) || isUndefined(obj)\n}\n\nisArray.displayName = 'isUnset'\n\n// isArray\n//\nfunction isArray(obj) {\n  return Array.isArray(obj)\n}\n\nisArray.displayName = 'isArray'\n\n// isArguments\n//\nfunction isArguments(obj) {\n  return Object.prototype.toString.call(obj) === '[object Arguments]'\n}\n\nisArguments.displayName = 'isArguments'\n\n// isBoolean\n//\nfunction isBoolean(obj) {\n  return obj === true || obj === false\n}\n\nisBoolean.displayName = 'isBoolean'\n\n// isFunction\n//\nfunction isFunction(obj) {\n  return typeof obj === 'function'\n}\n\nisFunction.displayName = 'isFunction'\n\n// isString\n//\nfunction isString(obj) {\n  return typeof obj === 'string'\n}\n\nisString.displayName = 'isString'\n\n// isAllStrings\n//\nfunction isAllStrings (arr) {\n  return isArray(arr) && arr.every(isString)\n}\n\nisAllStrings.displayName = 'isAllStrings'\n\n// isUndefined\n//\nfunction isUndefined(obj) {\n  return obj === undefined\n}\n\nisUndefined.displayName = 'isUndefined'\n\n// isNull\n//\nfunction isNull(obj) {\n  return obj === null\n}\n\nisNull.displayName = 'isNull'\n\n// isNumber\n//\nfunction isNumber(obj) {\n  return typeof obj === 'number'\n}\n\nisNumber.displayName = 'isNumber'\n\n// isObject\n//\nfunction isObject(obj) {\n  return typeof obj === 'object' && !isNull(obj)\n}\n\nisObject.displayName = 'isObject'\n\n// isPojo\n//\nfunction isPojo(obj) {\n  if (isNull(obj) || !isObject(obj) || isArguments(obj)) {\n    return false\n  }\n  return Object.getPrototypeOf(obj) === Object.prototype\n}\n\nisPojo.displayName = 'isPojo'\n\n// isTemplateLiteral\n//\nfunction isTemplateLiteral(obj) {\n  if (isString(obj)) {\n    return true\n  }\n  if (!isArray(obj)) {\n    return false\n  }\n  return obj.every(isString)\n}\n\nisTemplateLiteral.displayName = 'isTemplateLiteral'\n\n// isThisValue\n//\nfunction isThisValue(value) {\n  function inObject(obj) {\n    return obj === value\n  }\n  inObject.displayName = `isThisValue(${value})`\n  return inObject\n}\n\n//\n// ArgTypeError\n//\n\nconst typeErrorStringIfFnReturnsFalse = (argName, argTypeFn, arg) => {\n  return argTypeFn(arg)\n    ? undefined\n    : (argTypeFn.displayName || argTypeFn.name) +\n        `(${argName}) did not return true`\n}\n\nconst typeErrorStringIfTypeOfFails = (argName, argType, arg) => {\n  return typeof arg === argType\n    ? undefined\n    : `Argument \"${argName}\" should be a ${argType}`\n}\n\nconst typeErrorStringFromArgument = argMap => (arg, index) => {\n  if (index >= argMap.length) {\n    return\n  }\n\n  const { argName, argType } = argMap[index]\n  if (isUndefined(arg)) {\n    return `Argument undefined: \"${argName}\"`\n  }\n\n  const permittedArgTypes = Array.isArray(argType) ? argType : [argType]\n\n  const errorDescs = permittedArgTypes\n    .map(argType =>\n      isFunction(argType)\n        ? typeErrorStringIfFnReturnsFalse(argName, argType, arg)\n        : typeErrorStringIfTypeOfFails(argName, argType, arg)\n    )\n    .filter(isString)\n\n  const multipleTypesSpecified = permittedArgTypes.length > 1\n  const shouldError = multipleTypesSpecified\n    ? errorDescs.length > 1\n    : errorDescs.length\n\n  if (shouldError) {\n    return (\n      errorDescs.join('\\n| ') +\n      `\\n> typeof ${argName} === ${typeof arg}(${JSON.stringify(arg)})`\n    )\n  }\n}\n\n/**\n * Helper for enforcing correct argument-types.\n *\n * @private\n * @param {string} namespace\n *\n * @example\n * const argTypeError = ArgTypeError('namespace#')\n *\n * function myFn (myArg1, myArg2) {\n *   const err = argTypeError({\n *     myArg1: isString,\n *     myArg2: isBoolean\n *   })('myFn')(myArg1, myArg2)\n *   if (err) {\n *     throw new TypeError(err)\n *   }\n * }\n */\n\nfunction ArgTypeError(namespace) {\n  return typeMap => {\n    const argMap = Object.entries(typeMap).map(([argName, argType]) => ({\n      argName,\n      argType\n    }))\n\n    return fnName =>\n      (...args) => {\n        const processedArgs = Array\n          .from(args, x => isArguments(x) ? Array.from(x) : x)\n          .flat(1)\n\n        const err = processedArgs\n          .map(typeErrorStringFromArgument(argMap))\n          .filter(isString)\n\n        if (!err.length) {\n          return\n        }\n\n        const signature = Object.keys(typeMap).join(', ')\n        return (\n          `\\n${namespace || ''}${fnName}(${signature}):\\n` +\n          `${err.map(err => `| ${err}`).join('\\n')}`\n        )\n      }\n  }\n}\n\nfunction ObjTypeError(namespace) {\n  return typeMap => {\n    const keys = Object.keys(typeMap)\n    const objTypeError = ArgTypeError(namespace)(typeMap)\n    return fnName => obj => {\n      const values = valuesOf(obj, { keys })\n      const err = objTypeError(fnName)(...values)\n      return err\n    }\n  }\n}\n\nfunction valuesOf(obj, options) {\n  const { keys } = options\n  if (!Array.isArray(keys)) {\n    return Object.values(obj)\n  }\n  return keys.reduce((acc, key) => {\n    return [...acc, obj[key]]\n  }, [])\n}\n","\n//\n// STATEBOT UTILS\n//\n\nexport {\n  Defer,\n  Definitions,\n  Logger,\n  Once,\n  Pausables,\n  ReferenceCounter,\n  Revokable,\n  uniq,\n  wrapEmitter,\n}\n\nimport { isString } from './types'\n\nfunction wrapEmitter (events) {\n  const emit = (eventName, ...args) =>\n    events.emit(eventName, args)\n\n  const addListener = events.addListener\n    ? (...args) => events.addListener(...args)\n    : (...args) => events.on(...args)\n\n  const removeListener = events.removeListener\n    ? (...args) => events.removeListener(...args)\n    : (...args) => events.off(...args)\n\n  const wrapMap = new Map()\n\n  function on (eventName, fn) {\n    let fnMeta = wrapMap.get(fn)\n    if (!fnMeta) {\n      fnMeta = {\n        handleEvent: (args = []) => fn(...[args].flat()),\n        refCount: 0\n      }\n      wrapMap.set(fn, fnMeta)\n    }\n\n    fnMeta.refCount += 1\n    addListener(eventName, fnMeta.handleEvent)\n  }\n\n  function off (eventName, fn) {\n    let fnMeta = wrapMap.get(fn)\n    if (!fnMeta) {\n      return\n    }\n\n    removeListener(eventName, fnMeta.handleEvent)\n    fnMeta.refCount -= 1\n    if (fnMeta.refCount === 0) {\n      wrapMap.delete(fn)\n    }\n  }\n\n  return {\n    emit,\n    on,\n    off\n  }\n}\n\n//\n// uniq\n//\n\nfunction uniq (input) {\n  return input.reduce((acc, one) =>\n    acc.indexOf(one) === -1\n      ? (acc.push(one), acc)\n      : acc\n    , []\n  )\n}\n\n//\n// defer\n//\n\nfunction defer (fn, ...args) {\n  const timer = setTimeout(fn, 0, ...args)\n  return () => { clearTimeout(timer) }\n}\n\nfunction Defer (fn) {\n  return (...args) => defer(fn, ...args)\n}\n\n//\n// Revokable\n//\n\nfunction Once (fn) {\n  const { revoke, fn: _fn } = Revokable(fn)\n  let result\n  return function (...args) {\n    result = _fn(...args)\n    revoke()\n    return result\n  }\n}\n\nfunction Revokable (fn) {\n  let revoked = false\n  let result\n  return {\n    fn: (...args) => {\n      if (!revoked) {\n        result = fn(...args)\n      }\n      return result\n    },\n    revoke: () => {\n      revoked = true\n    }\n  }\n}\n\n//\n// Pausables\n//\n\nfunction Pausables (startPaused, runFnWhenPaused) {\n  runFnWhenPaused = runFnWhenPaused || function () {}\n  let paused = !!startPaused\n\n  function Pausable (fn) {\n    return (...args) => {\n      if (paused) {\n        runFnWhenPaused()\n        return false\n      }\n      return fn(...args)\n    }\n  }\n\n  return {\n    Pausable,\n    paused: () => paused,\n    pause: () => { paused = true },\n    resume: () => { paused = false },\n  }\n}\n\n//\n// ReferenceCounter\n//\n\nfunction ReferenceCounter (name, kind, description, ...expecting) {\n  const _refs = [...expecting]\n    .flat()\n    .reduce((acc, ref) => ({ ...acc, [ref]: 0 }), {})\n\n  function increase (ref) {\n    _refs[ref] = countOf(ref) + 1\n    return () => { decrease(ref) }\n  }\n  function decrease (ref) {\n    const count = countOf(ref) - 1\n    _refs[ref] = Math.max(count, 0)\n  }\n  function countOf (ref) {\n    return _refs[ref] || 0\n  }\n  function refs () {\n    return { ..._refs }\n  }\n  function table () {\n    return Object.keys(_refs).sort()\n      .map(key => [key, _refs[key]])\n      .map(([ref, count]) => {\n        return {\n          [kind]: ref,\n          refs: count || 'None'\n        }\n      })\n  }\n  function toValue () {\n    return {\n      description: `Statebot[${name}]: ${description}:`,\n      table: table()\n    }\n  }\n  return {\n    increase,\n    decrease,\n    countOf,\n    toValue,\n    refs\n  }\n}\n\n//\n// Definitions\n//\n\nfunction Definitions() {\n  const dictionary = {}\n\n  function undefine(word, definition) {\n    dictionary[word] = (dictionary[word] || []).filter(\n      (next) => next !== definition\n    )\n    if (dictionary[word].length === 0) {\n      delete dictionary[word]\n    }\n  }\n\n  function define(word, definition) {\n    dictionary[word] = dictionary[word] || []\n    dictionary[word].push(definition)\n    return () => undefine(word, definition)\n  }\n\n  function definitionsOf(word) {\n    return dictionary[word] || []\n  }\n\n  return {\n    define,\n    undefine,\n    definitionsOf,\n  }\n}\n\n//\n// Logger\n//\n\nfunction Logger (level, _console) {\n  if (isString(level)) {\n    level = ({\n      info: 3,\n      log: 2,\n      warn: 1,\n      none: 0\n    })[level] || 3\n  }\n  function canWarn () {\n    return level >= 1\n  }\n  function canLog () {\n    return level >= 2\n  }\n  function canInfo () {\n    return level >= 3\n  }\n  const { info, table, log, warn, error } = _console || console\n  return {\n    canWarn,\n    canLog,\n    canInfo,\n\n    info: (...args) => { canInfo() && info(...args) },\n    table: (...args) => { canLog() && table(...args) },\n    log: (...args) => { canLog() && log(...args) },\n    warn: (...args) => { canWarn() && warn(...args) },\n    error: (...args) => { error(...args) }\n  }\n}\n","\n//\n// STATEBOT CHART/ROUTE PARSING\n//\n\nconst rxCRLF = /[\\r\\n]/\nconst cxPipe = '|'\nconst cxArrow = '->'\nconst rxOperators = [cxPipe, cxArrow]\n  .map(rxUnsafe => rxUnsafe.replace('|', '\\\\|'))\n  .join('|')\n\nconst rxLineContinuations = new RegExp(`(${rxOperators})$`)\nconst rxDisallowedCharacters = /[^a-z0-9!@#$%^&*:_+=<>|~.\\x2D]/gi\nconst rxComment = /(\\/\\/[^\\n\\r]*)/\n\nexport {\n  cxPipe,\n  cxArrow,\n  rxDisallowedCharacters,\n  decomposeChart,\n  decomposeRoute\n}\n\nimport { uniq } from './utils'\nimport { isTemplateLiteral, ArgTypeError } from './types'\n\nconst argTypeError = ArgTypeError('statebot.')\n\nfunction decomposeRoute (templateLiteral) {\n  const err = argTypeError(\n    { templateLiteral: isTemplateLiteral }\n  )('decomposeRoute')(templateLiteral)\n  if (err) {\n    throw TypeError(err)\n  }\n\n  const lines = condensedLines(templateLiteral)\n  const linesOfTokens = tokenisedLines(lines)\n  const route = linesOfTokens.flat(2)\n\n  return route\n}\n\n/**\n * Decompose a {@link statebotChart} into an object of `states`, `routes`,\n * and `transitions`.\n *\n * Statebot() uses this internally to parse charts. Exposed for debugging.\n *\n * @memberof statebot\n * @function\n * @param {statebotChart} chart\n * @returns {Object}\n *\n * @example\n * var { states, routes, transitions } = decomposeChart`\n *   pending ->\n *     success | failure\n * `\n * // states = ['pending', 'success', 'failure']\n * // routes = [ 'pending->success', 'pending->failure']\n * // transitions = [\n * //   ['pending', 'success'],\n * //   ['pending', 'failure']\n * // ]\n */\n\nfunction decomposeChart (chart) {\n  const err = argTypeError(\n    { chart: isTemplateLiteral }\n  )('decomposeChart')(chart)\n  if (err) {\n    throw TypeError(err)\n  }\n\n  const lines = condensedLines(chart)\n  const linesOfTokens = tokenisedLines(lines)\n  const linesOfRoutes = linesOfTokens\n    .flatMap(decomposeRouteFromTokens)\n\n  const linesOfTransitions = linesOfRoutes\n    .flatMap(decomposeTransitionsFromRoute)\n\n  let emptyStateFound = false\n  const routeKeys = linesOfTransitions.map(route => {\n    if (route.includes('')) {\n      emptyStateFound = true\n    }\n    return route.join(cxArrow)\n  })\n\n  const filteredRoutes = uniq(routeKeys)\n  const filteredStates = uniq(linesOfTokens.flat(3))\n\n  return {\n    transitions: filteredRoutes.map(route => route.split(cxArrow)),\n    routes: filteredRoutes,\n    states: !emptyStateFound\n      ? filteredStates.filter(Boolean)\n      : filteredStates\n  }\n}\n\nfunction linesFrom (strOrArr) {\n  return [strOrArr]\n    .flat()\n    .reduce((acc, line) => [...acc, ...line.split(rxCRLF)], [])\n}\n\nfunction condensedLines (strOrArr) {\n  const input = linesFrom(strOrArr)\n  const output = []\n\n  let previousLineHasContinuation = false\n\n  const condenseLine = (condensedLine, line) => {\n    const sanitisedLine = line\n      .replace(rxComment, '')\n      .replace(rxDisallowedCharacters, '')\n\n    if (!sanitisedLine) {\n      return condensedLine\n    }\n\n    previousLineHasContinuation = rxLineContinuations\n      .test(sanitisedLine)\n\n    if (previousLineHasContinuation) {\n      return condensedLine + sanitisedLine\n    }\n\n    output.push(condensedLine + sanitisedLine)\n    return ''\n  }\n\n  const finalCondensedLine = input\n    .reduce(condenseLine, '')\n\n  if (previousLineHasContinuation || finalCondensedLine) {\n    return [...output, finalCondensedLine]\n  }\n\n  return [...output]\n}\n\nfunction tokenisedLines (lines) {\n  return lines\n    .map(line => line\n      .split(cxArrow)\n      .map(str => str.split(cxPipe))\n    )\n}\n\nfunction decomposeRouteFromTokens (line) {\n  const output = []\n\n  line.reduce((previousStates, states) => {\n    if (previousStates === false) {\n      return [...states]\n    }\n\n    output.push([previousStates, [...states]])\n    return [...states]\n  }, false)\n\n  return output\n}\n\nfunction decomposeTransitionsFromRoute([fromStates, toStates]) {\n  return fromStates.reduce(\n    (acc, fromState) => (\n      acc.push(...toStates.map(toState => [fromState, toState])), acc\n    ),\n    []\n  )\n}\n","\n//\n// STATEBOT FSM\n//\n\nexport {\n  Statebot,\n  isStatebot\n}\n\n/**\n * Options for creating a Statebot.\n *\n * @typedef {Object} statebotOptions\n * @property {statebotChart} chart\n *  The state-chart.\n * @property {string} [startIn=auto]\n *  The state in which to start. If unspecified, the first state in the\n *  chart will be used.\n * @property {number} [logLevel=3]\n *  How noisy the logging is, from 1 to 3:\n *  ```\n *  1) console.warn\n *  2) console.warn/log/table\n *  3) console.warn/log/table/info\n *  ```\n *  `3` is the default. Argument type-errors will always `throw`.\n * @property {number} [historyLimit=2]\n *  Limit how much history the state-machine keeps. Accessed via\n *  {@link #statebotfsmhistory|statebotFsm#history()}.\n * @property {events} [events]\n *  If you wish to have your Statebots listen to events coming from\n *  a shared EventEmitter, you can pass it in here. The `emit()`/`onEvent()`/\n *  `performTransitions()` methods will use it.\n *\n *  It should have the same signature as {@link https://nodejs.org/api/events.html#events_class_eventemitter|EventEmitter}.\n *\n *  - Since v2.5.0 {@link https://npmjs.com/mitt|mitt} is also compatible.\n *  - Since v2.6.0 {@link https://npmjs.com/mitt|mitt} is used internally.\n */\n\n/**\n * A description of all the states in a machine, plus all of the\n * permitted transitions between them.\n *\n * This is defined using a `string` or an `array` of strings, but\n *  {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals|Template Literals}\n * are much more convenient.\n *\n * An arrow `->` configures a **permitted transition** between two states:\n *\n * ```\n * from-state -> to-state\n * ```\n *\n * It's the only operator needed to build any chart:\n *\n * ```js\n * var promiseLikeChart = `\n *   pending -> resolved\n *   pending -> rejected\n *   resolved -> done\n *   rejected -> done\n * `\n * ```\n *\n * The \"OR\" operator `|` can help us remove some redundancy from the above example:\n *\n * ```js\n * var promiseLikeChart = `\n *   pending -> resolved | rejected\n *   resolved | rejected -> done\n * `\n * ```\n *\n * In both charts, `pending` can transition to `resolved` or `rejected`, and\n * `resolved` or `rejected` can both transition to `done`.\n *\n * We can streamline this even further:\n *\n * ```js\n * var promiseLikeChart = `\n *   pending -> (resolved | rejected) -> done\n * `\n * ```\n *\n * Again, this is exactly equivalent to the previous two examples.\n *\n * Notice in this one that we have parentheses `(` `)` surrounding `resolved`\n * and `rejected`. They are actually completely ignored by the parser, and\n * you can use them as you please to help make your charts more readable.\n *\n * A chart works exactly the same without them:\n *\n * ```js\n * var promiseLikeChart = `\n *   pending -> resolved | rejected -> done\n * `\n * ```\n *\n * Charts can also be split across multiple-lines:\n *\n * ```js\n * var promiseLikeChart = `\n *   pending ->\n *   resolved |\n *   rejected ->\n *   done\n * `\n * ```\n * Notice that all white-space is ignored on either side of the `->`\n * and `|`.\n *\n * `// Comments of this kind are allowed, too:`\n *\n * ```js\n * var promiseLikeChart = `\n *   pending -> // Where do we go from here?\n *     (resolved | rejected) -> // Ah, yes\n *\n *   // And now we're all finished\n *   done\n * `\n * ```\n *\n * Finally, here's a more full example:\n *\n * ```js\n * var dragDropChart = `\n *   idle ->\n *     drag-detect ->\n *       (dragging | clicked)\n *\n *   // Just a click, bail-out!\n *   clicked -> idle\n *\n *   // Drag detected!\n *   dragging ->\n *     drag-wait -> dragged -> drag-wait\n *\n *   // Drag finished...\n *   (drag-wait | dragged) ->\n *     (drag-done | drag-cancel) ->\n *       idle\n * `\n * ```\n *\n * @typedef {string|string[]} statebotChart\n */\n\nconst ON_EXITING = 'onExiting'\nconst ON_ENTERING = 'onEntering'\nconst ON_EXITED = 'onExited'\nconst ON_ENTERED = 'onEntered'\nconst ON_SWITCHING = 'onSwitching'\nconst ON_SWITCHED = 'onSwitched'\n\nconst INTERNAL_EVENTS = {\n  [ON_SWITCHING]: '(ANY)state:changing',\n  [ON_SWITCHED]: '(ANY)state:changed'\n}\n\nimport mitt from 'mitt'\n\nimport {\n  wrapEmitter,\n  Definitions,\n  Logger,\n  ReferenceCounter,\n  Pausables,\n  Once,\n} from './utils'\n\nimport {\n  isArray,\n  isEventEmitter,\n  isFunction,\n  isPojo,\n  isString,\n  isAllStrings,\n  isUndefined,\n  ArgTypeError,\n} from './types'\n\nimport { decomposeChart, cxArrow } from './parsing'\n\n/**\n * Create a {@link #statebotfsm|statebotFsm} `object`.\n *\n * @memberof statebot\n * @function\n * @example\n * var machine = Statebot('lemming', {\n *   chart: `\n *     walking -> (digging | building | falling) ->\n *       walking\n *\n *     falling -> splatting\n *     walking -> exiting\n *   `\n * })\n *\n * @param {string} name\n *  Give your Statebot a name. Used for logging and by {@link #statebotassertroute|assertRoute()}.\n * @param {statebotOptions} options\n */\n\nfunction Statebot (name, options) {\n  if (!isString(name)) {\n    throw new TypeError('\\nStatebot: Please specify a name for this machine')\n  }\n\n  const logPrefix = `Statebot[${name}]`\n  if (!isPojo(options)) {\n    throw new TypeError(`\\n${logPrefix}: Please specify options for this machine`)\n  }\n\n  const {\n    chart = undefined,\n    logLevel = 3,\n    historyLimit = 2\n  } = options || {}\n\n  const events = isUndefined(options.events)\n    ? wrapEmitter(mitt())\n    : isEventEmitter(options.events) && wrapEmitter(options.events)\n\n  if (!events) {\n    throw new TypeError(`\\n${logPrefix}: Invalid event-emitter specified in options`)\n  }\n\n  const { states = [], routes = [] } = chart\n    ? decomposeChart(chart)\n    : options\n\n  const { startIn = states[0] } = options\n\n  if (!states.includes(startIn)) {\n    throw new Error(`${logPrefix}: Starting-state not in chart: \"${startIn}\"`)\n  }\n\n  const argTypeError = ArgTypeError(`${logPrefix}#`)\n  const _console = Logger(logLevel, console)\n  const { canWarn } = _console\n\n  const stateHistory = [startIn]\n  const stateHistoryLimit = Math.max(historyLimit, 2)\n\n  let transitionId = 0\n\n  const { pause, resume, paused, Pausable } = Pausables(false, () =>\n    _console.warn(`${logPrefix}: Ignoring callback, paused`)\n  )\n\n  const transitionsFromEvents = Definitions()\n\n  const internalEvents = wrapEmitter(mitt())\n  const emitInternalEvent = Pausable(internalEvents.emit)\n\n  function onInternalEvent (eventName, cb) {\n    internalEvents.on(eventName, cb)\n    return () => internalEvents.off(eventName, cb)\n  }\n\n  const statesHandled = ReferenceCounter(\n    name,\n    'states',\n    'Listening for the following state-changes',\n    [...states]\n  )\n  const routesHandled = ReferenceCounter(\n    name,\n    'transitions',\n    'Listening for the following transitions',\n    [...routes]\n  )\n  const eventsHandled = ReferenceCounter(\n    name,\n    'events',\n    'Listening for the following events'\n  )\n\n  // Interprets onTransitions() and performTransitions()\n  function applyHitcher (hitcher, fnName) {\n    const hitcherActions =\n      isFunction(hitcher)\n        ? hitcher({ enter, emit, Enter, Emit })\n        : isPojo(hitcher) ? hitcher : null\n\n    if (!isPojo(hitcherActions)) {\n      throw new TypeError(\n        `Statebot[${name}]#${fnName}(): Expected an object, or a function that returns an object`\n      )\n    }\n\n    const allStates = []\n    const allRoutes = []\n    const {\n      transitionsForEvents,\n      transitionsOnly\n    } = decomposeHitcherActions(hitcherActions)\n\n    // Handle performTransitions() signature\n    // (configs with an event, and maybe a then-method too)\n    const eventsMappedToTransitionConfigs = Object\n      .entries(transitionsForEvents)\n      .reduce(decomposeTransitionsForEvent, {})\n\n    // Handle onTransitions() signature\n    // (transition-only, and maybe a then-function too)\n    const transitionConfigs = expandTransitions(transitionsOnly, canWarn)\n\n    // Now install handlers for on/performTransitions:\n    const allCleanupFns =\n      Object\n        .entries(eventsMappedToTransitionConfigs)\n        .map(createEventHandlerForTransition)\n        .concat(transitionConfigs.configs.map(runThenMethodOnTransition))\n        .flat()\n\n    // Debugging\n    // (if we're at the right level)\n    if (canWarn()) {\n      allStates.push(...transitionConfigs.states)\n      allRoutes.push(...transitionConfigs.routes)\n\n      const invalidStates = allStates.filter(state => !states.includes(state))\n      const invalidRoutes = allRoutes.filter(route => !routes.includes(route))\n\n      if (invalidStates.length) {\n        _console.warn(\n          `Statebot[${name}]#${fnName}(): Invalid states specified:\\n` +\n          invalidStates.map(state => `  > \"${state}\"`).join('\\n')\n        )\n      }\n      if (invalidRoutes.length) {\n        _console.warn(\n          `Statebot[${name}]#${fnName}(): Invalid transitions specified:\\n` +\n          invalidRoutes.map(route => `  > \"${route}\"`).join('\\n')\n        )\n      }\n    }\n\n    return () => allCleanupFns.map(fn => fn())\n\n    // Helper for onTransitions()\n    function runThenMethodOnTransition (config) {\n      const { fromState, toState, action } = config\n      const route = `${fromState}->${toState}`\n      return [\n        routesHandled.increase(route),\n        onInternalEvent(route, bindActionTo(toState, action))\n      ]\n    }\n\n    // Helpers for performTransitions()\n    function decomposeTransitionsForEvent (acc, [eventName, transitionsAndAction]) {\n      const {\n        states,\n        routes,\n        configs\n      } = expandTransitions(transitionsAndAction, canWarn)\n\n      if (canWarn()) {\n        allStates.push(...states)\n        allRoutes.push(...routes)\n      }\n\n      return {\n        ...acc,\n        [eventName]: configs\n      }\n    }\n\n    function ifStateThenEnterState ({ fromState, toState, action, args }) {\n      return inState(fromState, () => {\n        enter(toState, ...args)\n        isFunction(action) && runActionFor(toState, action, ...args)\n        return true\n      })\n    }\n\n    function createEventHandlerForTransition ([eventName, configs]) {\n      return [\n        eventsHandled.increase(eventName),\n        onEvent(eventName, (...args) => {\n          const eventWasHandled = configs\n            .map(config => ({ ...config, args }))\n            .some(ifStateThenEnterState)\n\n          if (!eventWasHandled) {\n            transitionNoOp(`Event not handled: \"${eventName}\"`)\n          }\n        })\n      ].concat(\n        configs.map(({ fromState, toState }) =>\n          transitionsFromEvents.define(`${eventName}:${fromState}`, toState)\n        )\n      )\n    }\n\n    function runActionFor (state, actionFn, ...args) {\n      const onExitingState = actionFn(...args)\n      if (isFunction(onExitingState)) {\n        const uninstall = Once(enterExitMethods[ON_EXITING](state, (toState) => {\n          uninstall()\n          onExitingState(toState)\n        }))\n\n        allCleanupFns.push(uninstall)\n      }\n    }\n\n    function bindActionTo (state, actionFn) {\n      return (...args) => runActionFor(state, actionFn, ...args)\n    }\n  }\n\n  function _peek (eventName, stateObject, calledInternally = true) {\n    const err1 = argTypeError({ eventName: isString })('peek')(eventName)\n    if (err1) {\n      throw new TypeError(err1)\n    }\n\n    const eventAndState = eventName + ':' + currentState()\n    const statesFromEvent = transitionsFromEvents.definitionsOf(eventAndState)\n\n    if (statesFromEvent.length > 1) {\n      const reason =\n        `${logPrefix}: Event \"${eventName}\" causes multiple transitions.\\n` +\n        `  > From state: \"${currentState()}\"\\n` +\n        `  > To states: \"${statesFromEvent.join(', ')}\"\\n\\n` +\n        `Check your performTransitions() config.`\n\n      throw new RangeError(reason)\n    }\n\n    if (!calledInternally && statesFromEvent.length === 0) {\n      if (eventsHandled.countOf(eventName) === 0) {\n        _console.warn(`${logPrefix}: Event not handled: \"${eventName}\"`)\n      } else {\n        _console.warn(`${logPrefix}: Will not transition after emitting: \"${eventName}\"`)\n      }\n    }\n\n    const toState = statesFromEvent[0]\n\n    if (isUndefined(stateObject)) {\n      return isUndefined(toState) ? currentState() : toState\n    }\n\n    const err2 = argTypeError({ stateObject: isPojo })('peek')(stateObject)\n    if (err2) {\n      throw new TypeError(err2)\n    }\n\n    if (Object.prototype.hasOwnProperty.call(stateObject, toState)) {\n      const anyOrFn = stateObject[toState]\n      return isFunction(anyOrFn)\n        ? anyOrFn()\n        : anyOrFn\n    }\n    return null\n  }\n\n  function peek (eventName, stateObject) {\n    return _peek(eventName, stateObject, false)\n  }\n\n  function previousState () {\n    return stateHistory[stateHistory.length - 2]\n  }\n\n  function currentState () {\n    return stateHistory[stateHistory.length - 1]\n  }\n\n  function _state_canTransitionTo (...states) {\n    const err = argTypeError(\n      { states: isAllStrings }\n    )('canTransitionTo')([states])\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    if (!states.length) {\n      return false\n    }\n\n    const nextStates = statesAvailableFromHere()\n    return states.every(state => nextStates.includes(state))\n  }\n\n  function canTransitionTo (...states) {\n    const testStates = states.flat()\n    if (\n      testStates.length === 2 &&\n      isString(testStates[0]) &&\n      isPojo(testStates[1])\n    ) {\n      const thisState = testStates[0]\n      const { afterEmitting } = testStates[1]\n      const err = argTypeError(\n        { thisState: isString, '{ afterEmitting }': isString }\n      )('canTransitionTo')(thisState, afterEmitting)\n      if (err) {\n        throw new TypeError(err)\n      }\n      return (\n        thisState !== currentState() &&\n        _peek(afterEmitting) === thisState\n      )\n    }\n\n    return _state_canTransitionTo(...testStates)\n  }\n\n  function statesAvailableFromHere (state) {\n    const _state = !isUndefined(state)\n      ? state\n      : currentState()\n\n    const err = argTypeError(\n      { state: isString }\n    )('statesAvailableFromHere')(_state)\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    return routes.reduce((acc, route) => {\n      const [fromState, toState] = route\n        .split(cxArrow)\n        .map(state => state.trim())\n\n      return (fromState === _state)\n        ? [...acc, toState]\n        : acc\n    }, [])\n  }\n\n  function _inState (state, anyOrFn, ...fnArgs) {\n    const conditionMatches = currentState() === state\n\n    if (isUndefined(anyOrFn)) {\n      return conditionMatches\n    }\n    if (!conditionMatches) {\n      return null\n    }\n    if (isFunction(anyOrFn)) {\n      return anyOrFn(...fnArgs)\n    }\n\n    return anyOrFn\n  }\n\n  function _inStateObject(stateObject, ...fnArgs) {\n    const match = Object\n      .entries(stateObject)\n      .find(([state]) => _inState(state))\n\n    return match\n      ? _inState(...match.concat(fnArgs))\n      : null\n  }\n\n  function inState (...args) {\n    const err = argTypeError(\n      { state: [isString, isPojo] }\n    )('inState')(args[0])\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    return isPojo(args[0])\n      ? _inStateObject(...args)\n      : _inState(...args)\n  }\n\n  const emit = Pausable((eventName, ...args) => {\n    const err = argTypeError(\n      { eventName: isString }\n    )('emit')(eventName)\n    if (err) {\n      throw new TypeError(err)\n    }\n    _peek(eventName)\n    return events.emit(eventName, ...args)\n  })\n\n  const enter = Pausable((state, ...args) => {\n    const err = argTypeError(\n      { state: isString }\n    )('enter')(state)\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    const inState = currentState()\n    const toState = state\n\n    if (toState === inState) {\n      transitionNoOp(`Already in state: \"${toState}\"`)\n      return false\n    }\n\n    if (!states.includes(toState)) {\n      transitionNoOp(`Invalid state \"${toState}\", not switching`)\n      return false\n    }\n\n    const nextRoute = `${inState}->${toState}`\n    if (!routes.includes(nextRoute)) {\n      transitionNoOp(`Invalid transition \"${nextRoute}\", not switching`)\n      return false\n    }\n\n    // Fell-through, can enter next state\n    _console.info(`${logPrefix}: tId<${++transitionId}>: ${nextRoute}`)\n\n    stateHistory.push(toState)\n    if (stateHistory.length > stateHistoryLimit) {\n      stateHistory.shift()\n    }\n\n    emitInternalEvent(INTERNAL_EVENTS[ON_SWITCHING], toState, inState, ...args)\n    emitInternalEvent(nextRoute, ...args)\n    emitInternalEvent(INTERNAL_EVENTS[ON_SWITCHED], toState, inState, ...args)\n\n    return true\n  })\n\n  function onEvent (eventName, cb) {\n    const err = argTypeError(\n      { eventName: isString, cb: isFunction }\n    )('onEvent')(eventName, cb)\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    events.on(eventName, cb)\n    return () => events.off(eventName, cb)\n  }\n\n  const switchMethods = Object\n    .keys(INTERNAL_EVENTS)\n    .reduce((obj, methodName) => ({\n      ...obj,\n      [methodName]: cb => {\n        const err = argTypeError({ cb: isFunction })(methodName)(cb)\n        if (err) {\n          throw new TypeError(err)\n        }\n\n        const decreaseRefCount = statesHandled.increase(\n          INTERNAL_EVENTS[methodName]\n        )\n        const removeEvent = onInternalEvent(\n          INTERNAL_EVENTS[methodName], cb\n        )\n\n        return () => {\n          removeEvent()\n          decreaseRefCount()\n        }\n      }\n    }), {})\n\n  const enterExitMethods = [\n    [ON_EXITING, ON_SWITCHING],\n    [ON_ENTERING, ON_SWITCHING],\n    [ON_EXITED, ON_SWITCHED],\n    [ON_ENTERED, ON_SWITCHED]\n  ]\n    .reduce((obj, names) => {\n      const [methodName, switchMethod] = names\n      const name = methodName.slice(2)\n      const eventName = name.toLowerCase()\n\n      return {\n        ...obj,\n        [methodName]: (state, cb) => {\n          const err = argTypeError(\n            { state: isString, cb: isFunction }\n          )(methodName)(state, cb)\n          if (err) {\n            throw new TypeError(err)\n          }\n\n          const decreaseRefCounts = [\n            statesHandled.increase(state),\n            statesHandled.increase(`${state}:${eventName}`)\n          ]\n\n          const removeEvent = switchMethods[switchMethod](\n            (toState, fromState, ...args) => {\n              if (name.indexOf('Exit') === 0) {\n                state === fromState && cb(toState, ...args)\n              } else {\n                state === toState && cb(fromState, ...args)\n              }\n            }\n          )\n\n          return () => {\n            removeEvent()\n            decreaseRefCounts.map(fn => fn())\n          }\n        }\n      }\n    }, {})\n\n  function Emit (eventName, ...curriedArgs) {\n    const err = argTypeError({ eventName: isString })('Emit')(eventName)\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    return (...args) => emit(eventName, ...[...curriedArgs, ...args])\n  }\n\n  function Enter (state, ...curriedArgs) {\n    const err = argTypeError({ state: isString })('Enter')(state)\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    return (...args) => enter(state, ...[...curriedArgs, ...args])\n  }\n\n  function _InState (state, anyOrFn, ...curriedFnArgs) {\n    return (...fnArgs) =>\n      inState(state, anyOrFn, ...[...curriedFnArgs, ...fnArgs])\n  }\n\n  function _InStateObject(stateObject, ...curriedFnArgs) {\n    return (...fnArgs) =>\n      inState(stateObject, ...[...curriedFnArgs, ...fnArgs])\n  }\n\n  function InState (...args) {\n    const err = argTypeError({ state: [isString, isPojo] })('InState')(args[0])\n    if (err) {\n      throw new TypeError(err)\n    }\n\n    return isPojo(args[0])\n      ? _InStateObject(...args)\n      : _InState(...args)\n  }\n\n  function reset () {\n    _console.warn(`${logPrefix}: State-machine reset!`)\n\n    stateHistory.length = 0\n    stateHistory.push(startIn)\n  }\n\n  function transitionNoOp (message) {\n    const lastState = previousState()\n    const inState = currentState()\n    const prevRoute =\n      `${isUndefined(lastState) ? '[undefined]' : lastState}->${inState}`\n\n    const availableStates = statesAvailableFromHere()\n    if (!availableStates.length) {\n      _console.info(\n        `${logPrefix}: ${message}\\n` +\n          `  > Previous transition: \"${prevRoute}\"\\n` +\n          `  > There are no states available from \"${inState}\"`\n      )\n    } else {\n      _console.info(\n        `${logPrefix}: ${message}\\n` +\n          `  > Previous transition: \"${prevRoute}\"\\n` +\n          `  > From \"${inState}\", valid states are: [${availableStates\n            .map(state => `\"${state}\"`)\n            .join(', ')}]`\n      )\n    }\n  }\n\n  function inspect () {\n    return {\n      states: statesHandled.refs(),\n      transitions: routesHandled.refs(),\n      events: eventsHandled.refs()\n    }\n  }\n\n  function info () {\n    _console.log(`${logPrefix}: Information about this state-machine`)\n\n    logRefCounterInfo(statesHandled)\n    logRefCounterInfo(routesHandled)\n    logRefCounterInfo(eventsHandled)\n  }\n\n  function logRefCounterInfo (refCounter) {\n    const { description, table } = refCounter.toValue()\n    _console.log(description)\n    if (table.length) {\n      _console.table(table)\n    } else {\n      _console.log('  > No information')\n    }\n  }\n\n  /**\n   * A state-machine object created by\n   * {@link #statebotstatebot|Statebot()}.\n   * @typedef {Object} statebotFsm\n   */\n\n  return {\n    /**\n     * For identifying Statebot objects.\n     *\n     * @private\n     */\n    __STATEBOT__: 1,\n\n    /**\n     * Tests to see if we can transition to the specified state from\n     * the {@link #statebotfsmcurrentstate|.currentState()}.\n     *\n     * If more than one state is specified, `true` is returned only if\n     * **ALL** states are available.\n     *\n     * See also: {@link #statebotfsmpeek|.peek()}.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string|string[]} states\n     * @param {object} [options]\n     * @param {string} options.afterEmitting\n     * Since v2.9.0: Can test if a certain state will be entered after\n     * emitting an event. Use `{ afterEmitting: 'eventName' }` as the\n     * second argument. Works only after using\n     * {@link #statebotfsmperformtransitions|.performTransitions()}.\n     * See the updated example below.\n     * @returns {boolean}\n     * @example\n     * var machine = Statebot('game-menus', {\n     *   chart: `\n     *     loading ->\n     *       menu ->\n     *            play |\n     *         options |\n     *           sound |\n     *            quit\n     *\n     *     // Go back to menu\n     *     play | options | sound -> menu\n     *\n     *     // Can quit from main game, too\n     *     play -> quit\n     *   `\n     * })\n     *\n     * machine.canTransitionTo('play')\n     * // false\n     *\n     * machine.enter('menu')\n     * machine.canTransitionTo(['play', 'options'])\n     * // true\n     *\n     * // Since v2.9.0:\n     * machine.canTransitionTo('play', {\n     *   afterEmitting: 'startGame'\n     * })\n     * // false\n     */\n    canTransitionTo,\n\n    /**\n     * Returns the current state.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @returns {string}\n     *\n     * @example\n     * var machine = Statebot('coroutine', {\n     *   chart: `\n     *     suspended -> running -> (suspended | dead)\n     *   `\n     * })\n     *\n     * machine.currentState()\n     * // \"suspended\"\n     */\n    currentState,\n\n    /**\n     * Immediately emits an event, firing any listeners added using\n     * {@link #statebotfsmperformtransitions|.performTransitions()} or {@link #statebotfsmonevent|.onEvent()}.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} eventName\n     * @param {...*} [args]\n     *  Optional arguments to pass to listeners.\n     * @returns {boolean}\n     *  Whether or not the event had listeners.\n     *\n     *  See: {@link https://nodejs.org/api/events.html#events_emitter_emit_eventname_args|Node Events}\n     *  for more information.\n     *\n     * Statebot imports `EventEmitter` from the\n     *  {@link https://www.npmjs.com/package/events|events}\n     * package for dealing with events in the browser.\n     *\n     * Since v2.6.0 {@link https://npmjs.com/mitt|mitt} is\n     * used for both the browser and non-browser builds.\n     *\n     * @example\n     * var machine = Statebot('basic-form', {\n     *   chart: `\n     *     idle -> sending -> redirect\n     *   `\n     * })\n     *\n     * machine.performTransitions({\n     *   'idle -> sending': {\n     *     on: 'post-data',\n     *     then: (...args) => {\n     *       console.log('Event args: ', args)\n     *       // setTimeout(machine.Enter('redirect'), 5000)\n     *     }\n     *   }\n     * })\n     *\n     * machine.emit('post-data', 'Hello, world!')\n     * // Event args: [\"Hello, world!\"]\n     *\n     * machine.currentState()\n     * // \"sending\"\n     */\n    emit,\n\n    /**\n     * Creates a function that emits the specified event.\n     *\n     * (This is essentially a convenience wrapper around {@link #statebotfsmemit|.emit()}.)\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} eventName\n     *  The desired event to {@link #statebotfsmemit|.emit()}.\n     * @param {...*} [curriedArgs]\n     *  Arguments that will curry into the returned `emit()` function\n     *  whenever it is called.\n     * @returns {function} A function that emits that event.\n     *\n     * @example\n     * var machine = Statebot('traffic-lights', {\n     *   chart: `\n     *     go ->\n     *       prepare-to-stop ->\n     *       stop\n     *\n     *     // ...gotta keep that traffic flowing\n     *     stop ->\n     *       prepare-to-go ->\n     *       go\n     *   `,\n     *   startIn: 'stop'\n     * })\n     *\n     * machine.performTransitions({\n     *   'stop -> prepare-to-go':   { on: 'timer' },\n     *   'prepare-to-go -> go':     { on: 'timer' },\n     *   'go -> prepare-to-stop':   { on: 'timer' },\n     *   'prepare-to-stop -> stop': { on: 'timer' }\n     * })\n     *\n     * var nextTrafficLight = machine.Emit('timer')\n     * machine.currentState()\n     * // \"stop\"\n     *\n     * nextTrafficLight()\n     * nextTrafficLight()\n     * nextTrafficLight()\n     *\n     * machine.currentState()\n     * // \"prepare-to-stop\"\n     */\n    Emit,\n\n    /**\n     * Immediately changes to the specified state, so long as it is\n     * accessible from the {@link #statebotfsmcurrentstate|.currentState()}.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The desired state to switch-to.\n     * @param {...*} [args]\n     *  Optional arguments to pass to transition callbacks.\n     * @returns {boolean} Whether or not the state changed.\n     *\n     * @example\n     * var machine = Statebot('dialog', {\n     *   chart: `\n     *     idle -> showing-modal -> (saving | idle)\n     *       saving -> idle\n     *   `\n     * })\n     *\n     * machine.currentState()\n     * // \"idle\"\n     *\n     * machine.enter('saving')\n     * // false\n     *\n     * // Statebot[dialog]: Invalid transition \"idle->saving\", not switching\n     * // > Previous transition: \"[undefined]->idle\"\n     * // > From \"idle\", valid states are: [\"showing-modal\"]\n     *\n     * machine.enter('showing-modal')\n     * // true\n     */\n    enter,\n\n    /**\n     * Creates a function that changes to the specified state, so long\n     * as it is accessible from the {@link #statebotfsmcurrentstate|.currentState()}.\n     *\n     * (This is essentially a convenience wrapper around {@link #statebotfsmenter|.enter()}.)\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The desired state to switch-to.\n     * @param {...*} [curriedArgs]\n     *  Arguments that will curry into the returned `enter()` function\n     *  whenever it is called.\n     * @returns {function}\n     *  A function that can change the state when called.\n     *\n     * @example\n     * var machine = Statebot('popup-menu', {\n     *   chart: `\n     *     idle -> menu-opened ->\n     *       (item-clicked | idle)\n     *\n     *     item-clicked -> idle\n     *   `,\n     *   startIn: 'menu-opened'\n     * })\n     *\n     * button.onclick = machine.Enter('item-clicked')\n     * machine.currentState()\n     * // \"menu-opened\"\n     *\n     * button.onclick()\n     * machine.currentState()\n     * // \"item-clicked\"\n     */\n    Enter,\n\n    /**\n     * Returns all states the machine has been in so far, up to a limit set\n     * by `historyLimit` in {@link statebotOptions}.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @returns {string[]} A copy of the state-history.\n     *\n     * @example\n     * var machine = Statebot('downloader', {\n     *   chart: `\n     *     loading -> (failure | success)\n     *       failure -> loading\n     *       success -> done\n     *   `,\n     *   historyLimit: 4\n     * })\n     *\n     * machine.enter('failure')\n     * machine.enter('loading')\n     * machine.enter('success')\n     * machine.enter('done')\n     * machine.history()\n     * // [\"failure\", \"loading\", \"success\", \"done\"]\n     */\n    history: () => [...stateHistory],\n\n    /**\n     * Print information about the current machine to the console.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.info()\n     * // [half-duplex]: Information about this state-machine.\n     * // [half-duplex]: Listening for the following state-changes:\n     * // ┌─────────┬─────────────┬────────┐\n     * // │ (index) │   states    │   #    │\n     * // ├─────────┼─────────────┼────────┤\n     * // │    0    │   'done'    │ 'None' │\n     * // │    1    │   'idle'    │ 'None' │\n     * // │    2    │ 'receiving' │ 'None' │\n     * // │    3    │  'sending'  │ 'None' │\n     * // └─────────┴─────────────┴────────┘\n     * // [half-duplex] Listening for the following transitions:\n     * // ┌─────────┬───────────────────┬────────┐\n     * // │ (index) │    transitions    │   #    │\n     * // ├─────────┼───────────────────┼────────┤\n     * // │    0    │ 'idle->receiving' │ 'None' │\n     * // │    1    │  'idle->sending'  │ 'None' │\n     * // │    2    │ 'receiving->done' │ 'None' │\n     * // │    3    │  'sending->done'  │ 'None' │\n     * // └─────────┴───────────────────┴────────┘\n     * // [half-duplex]: Listening for the following events:\n     * // (No information)\n     */\n    info: () => info(),\n\n    /**\n     * Get information about the current machine.\n     *\n     * Same details as {@link #statebotfsminfo|.info()} in object-form.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @returns {object}\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.inspect()\n     * // Will return an object with the following signature:\n     * //  { states, transitions, events }\n     *\n     * // These will each have key-values, the key being the name\n     * // and the value being the number of listeners attached.\n     */\n    inspect: () => inspect(),\n\n    /**\n     * Checks if the {@link #statebotfsmcurrentstate|.currentState()}\n     * matches the specified `state`, immediately returning either\n     * `true` or `false`.\n     *\n     * If `outputWhenTrue` is specified, then it will be returned\n     * instead of `true`, and `null` will be returned instead of\n     *  `false`.\n     *\n     * If a function is specified, then its return-value will be used\n     * as the `true`-value.\n     *\n     * Since v2.7.0:\n     * - An object can be used instead of a string, with the keys\n     *   being the states, and the values corresponding to their\n     *   `outputWhenTrue` value. See the updated example below.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string|object} state\n     *  The state to test against. This can be a string if you have a\n     *  single condition, or an object for multiple. (See example.)\n     * @param {any|function} [outputWhenTrue]\n     *  When a string is specified as the first argment, this becomes\n     *  an optional `true`-value that is returned if the state matches.\n     *  If a function is specified, it will be called and its return\n     *  value will be used.\n     * @param {...*} [fnArgs]\n     *  Arguments that will pass into `outputWhenTrue()` if it has\n     *  been defined as a function.\n     * @returns {boolean|null|*}\n     *\n     * @example\n     * var machine = Statebot('little-revver', {\n     *   chart: `\n     *     idle ->\n     *       (gear-1 | gear-2 | reverse) ->\n     *     idle\n     *   `\n     * })\n     *\n     * machine.inState('idle')\n     * // true\n     *\n     * machine.inState('idle', 'Purrrr...')\n     * // \"Purrrr...\"\n     *\n     * machine.enter('gear-1')\n     *\n     * // Since v2.7.0:\n     * machine.inState({\n     *   'idle': 'Purrrr...',\n     *   'gear-1': () => 'Chugga-chugga-chugga...',\n     *   'gear-2': () => 'Brumma-brumma-brum-brum...',\n     *   'reverse': false,\n     * })\n     * // \"Chugga-chugga-chugga...\"\n     *\n     * machine.inState('idle', () => {\n     *   console.log('Idling!')\n     *   return 'Purrrr...'\n     * })\n     * // null\n     * // ^ the function is not called at all in the `false` case,\n     * //   so no console.log either.\n     */\n    inState,\n\n    /**\n     * Returns a function which, when run, tests that\n     * {@link #statebotfsmcurrentstate|.currentState()} matches the\n     * specified state, returning either `true` or `false`.\n     *\n     * If `outputWhenTrue` is specified, then it will be returned\n     * instead of `true`, and `null` will be returned instead of\n     *  `false`.\n     *\n     * (This is essentially a convenience wrapper around {@link #statebotfsminstate|.inState()}.)\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The state to test against.\n     * @param {any|function} [outputWhenTrue]\n     *  Optional `true`-value. If a function is specified, it will be\n     *  called and its return value will be used.\n     * @param {...*} [curriedFnArgs]\n     *  Arguments that will curry into `outputWhenTrue()` if it has\n     *  been defined as a function.\n     * @returns {function}\n     *  A function that calls {@link #statebotfsminstate|.inState()}.\n     *\n     * @example\n     * var machine = Statebot('little-revver', {\n     *   chart: `\n     *     idle ->\n     *       (gear-1 | gear-2 | reverse) ->\n     *     idle\n     *   `\n     * })\n     *\n     * var idling = machine.InState('idle')\n     * var purring = machine.InState('idle', () => {\n     *   console.log('Idling!')\n     *   return 'Purrrr...'\n     * })\n     *\n     * idling()\n     * // true\n     *\n     * purring()\n     * // Idling!\n     * // \"Purrrr...\"\n     *\n     * machine.enter('gear-1')\n     * purring()\n     * // null\n     * // ^ the function is not called at all in the `false` case,\n     * //   so no console.log either.\n     */\n    InState,\n\n    /**\n     * Returns the name of the state-machine.\n     *\n     * Used for logging and also by {@link #statebotassertroute|assertRoute()}\n     * for the same.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @returns {string} The name of the state-machine.\n     *\n     * @example\n     * var machine = Statebot('Ay, there’s the rub.', {\n     *   chart: `\n     *     the-question -> (to-be | not-to-be)\n     *       not-to-be -> perchance-to-dream\n     *   `\n     * })\n     *\n     * machine.name()\n     * // \"Ay, there’s the rub.\"\n     */\n    name: () => name,\n\n    /**\n     * Adds a listener that runs a callback immediately **AFTER** the\n     * specified-state becomes the current one.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The state.\n     * @param {enterCallback} cb\n     *  A callback function with the signature:\n     *\n     *  `(fromState, ...args?)`\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onEntered('done', fromState => {\n     *   console.log('Entered from:', fromState)\n     * })\n     *\n     * machine.enter('receiving')\n     * machine.enter('done')\n     * // Entered from: receiving\n     */\n    onEntered: enterExitMethods[ON_ENTERED],\n\n    /**\n     * Adds a listener that runs a callback immediately **BEFORE** the\n     * specified-state becomes the current one.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The state.\n     * @param {enterCallback} cb\n     *  A callback function with the signature:\n     *\n     *  `(fromState, ...args?)`\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onEntered('done', () => {\n     *   console.log('We made it!')\n     * })\n     *\n     * machine.onEntering('done', fromState => {\n     *   console.log('Entering from:', fromState)\n     * })\n     *\n     * machine.enter('sending')\n     * machine.enter('done')\n     * // Entering from: sending\n     * // We made it!\n     */\n    onEntering: enterExitMethods[ON_ENTERING],\n\n    /**\n     * {@link #statebotfsmonentering .onEntering()} /\n     * {@link #statebotfsmonentered .onEntered()} callback signature.\n     *\n     * @callback enterCallback\n     * @param {string} fromState\n     * @param {...any} [args]\n     *  Arguments passed-down from {@link #statebotfsmenter .enter()} or\n     *  {@link #statebotfsmemit .emit()}\n     */\n\n    /**\n     * Adds a listener that runs a callback immediately after the specified\n     * event is called.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} name The event name.\n     * @param {function} cb The callback.\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('traffic-lights', {\n     *   chart: `\n     *     go ->\n     *       prepare-to-stop ->\n     *       stop\n     *\n     *     // ...gotta keep that traffic flowing\n     *     stop ->\n     *       prepare-to-go ->\n     *       go\n     *   `\n     * })\n     *\n     * machine.performTransitions({\n     *   'stop -> prepare-to-go -> go':   { on: 'timer' },\n     *   'go -> prepare-to-stop -> stop': { on: 'timer' },\n     * })\n     *\n     * machine.onEvent('timer', () => {\n     *   redrawTrafficLights()\n     * })\n     *\n     * setInterval(machine.Emit('timer'), 2000)\n     */\n    onEvent,\n\n    /**\n     * Adds a listener that runs a callback immediately **AFTER** the\n     * specified-state is no longer the current one.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The state.\n     * @param {exitCallback} cb\n     *  A callback function with the signature:\n     *\n     *  `(toState, ...args?)`\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onExited('idle', toState => {\n     *   console.log('We are heading to:', toState)\n     * })\n     *\n     * machine.enter('sending')\n     * // We are heading to: sending\n     */\n    onExited: enterExitMethods[ON_EXITED],\n\n    /**\n     * Adds a listener that runs a callback immediately **BEFORE** the\n     * specified-state is no longer the current one.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} state The state.\n     * @param {exitCallback} cb\n     *  A callback function with the signature:\n     *\n     *  `(toState, ...args?)`\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onExited('idle', () => {\n     *   console.log('Peace out!')\n     * })\n     *\n     * machine.onExiting('idle', toState => {\n     *   console.log('Heading to:', toState)\n     * })\n     *\n     * machine.enter('receiving')\n     * machine.enter('done')\n     * // Heading to: receiving\n     * // Peace out!\n     */\n    onExiting: enterExitMethods[ON_EXITING],\n\n    /**\n     * {@link #statebotfsmonexiting .onExiting()} /\n     * {@link #statebotfsmonexited .onExited()} callback signature.\n     *\n     * @callback exitCallback\n     * @param {string} toState\n     * @param {...any} [args]\n     *  Arguments passed-down from {@link #statebotfsmenter .enter()} or\n     *  {@link #statebotfsmemit .emit()}\n     */\n\n    /**\n     * Adds a listener that runs a callback immediately after **ANY**\n     * state-change.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {switchCallback} cb\n     *  A callback function with the signature:\n     *\n     *  `(toState, fromState, ...args?)`\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onSwitched((toState, fromState) => {\n     *   console.log(`We went from \"${fromState}\" to \"${toState}\"`)\n     * })\n     *\n     * machine.enter('receiving')\n     * // We went from \"idle\" to \"receiving\"\n     */\n    onSwitched: switchMethods[ON_SWITCHED],\n\n    /**\n     * Adds a listener that runs a callback immediately before **ANY**\n     * state-change.\n     *\n     * A function is returned that will remove the listener.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {switchCallback} cb\n     *  A callback function with the signature:\n     *\n     *  `(toState, fromState, ...args?)`\n     * @returns {function} A function that removes the listener.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onSwitching((toState, fromState) => {\n     *   console.log(`Going from \"${fromState}\" to \"${toState}\"`)\n     * })\n     *\n     * machine.enter('receiving')\n     * // Going from \"idle\" to \"receiving\"\n     */\n    onSwitching: switchMethods[ON_SWITCHING],\n\n    /**\n     * {@link #statebotfsmonswitching .onSwitching()} /\n     * {@link #statebotfsmonswitched .onSwitched()} callback signature.\n     *\n     * @callback switchCallback\n     * @param {string} toState\n     * @param {string} fromState\n     * @param {...any} [args]\n     *  Arguments passed-down from {@link #statebotfsmenter .enter()} or\n     *  {@link #statebotfsmemit .emit()}\n     */\n\n    /**\n     * Run callbacks when transitions happen.\n     *\n     * Since v2.8.0:\n     * - If a callback returns a function, it will be invoked when\n     *   the state is exited in the same manner as if an {@link #statebotfsmonexiting .onExiting()}\n     *   handler was created using it.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {object|function} transitions\n     *  Configuration in the form of an object, or a function that\n     *  returns an object. If a function is used, there will be a single\n     *  argument passed-in: an object with the following methods\n     *  attached as a convenience:\n     *\n     *  - {{@link #statebotfsmenter|.enter()}, {@link #statebotfsmemit|.emit()}, {@link #enter-state-1 .Enter()}, {@link #emit-name .Emit()}}\n     *\n     * @returns {function} A function that removes all listeners added\n     *  by this method.\n     *\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.onTransitions({\n     *   'idle -> sending': () => {\n     *     sendData()\n     *       .then(machine.Enter('done', 'sent'))\n     *       .catch(machine.Enter('done', 'failed'))\n     *   },\n     *   'idle -> receiving': () => {\n     *     receiveData()\n     *       .then(machine.Enter('done', 'received'))\n     *       .catch(machine.Enter('done', 'failed'))\n     *   },\n     *   'sending | receiving -> done': whatHappened => {\n     *     console.log('All finished: ', whatHappened)\n     *   }\n     * })\n     *\n     * machine.enter('sending')\n     *\n     * function sendData() {\n     *   return new Promise((resolve, reject) => {\n     *     setTimeout(resolve, 1000)\n     *     setTimeout(reject, 750 + Math.round(Math.random() * 750))\n     *   })\n     * }\n     *\n     * function receiveData() {\n     *   return new Promise((resolve, reject) => {\n     *     setTimeout(resolve, 1000)\n     *     setTimeout(reject, 750 + Math.round(Math.random() * 750))\n     *   })\n     * }\n     *\n     * @example\n     * // The above example using a function for config\n     * machine.onTransitions(({ Enter }) => ({\n     *   'idle -> sending': () => {\n     *     sendData()\n     *       .then(Enter('done', 'sent'))\n     *       .catch(Enter('done', 'failed'))\n     *   },\n     *   'idle -> receiving': () => {\n     *     receiveData()\n     *       .then(Enter('done', 'received'))\n     *       .catch(Enter('done', 'failed'))\n     *   },\n     *   'sending | receiving -> done': whatHappened => {\n     *     console.log('All finished: ', whatHappened)\n     *   }\n     * }))\n     *\n     * // etc...\n     */\n    onTransitions: transitions => applyHitcher(transitions, 'onTransitions'),\n\n    /**\n     * Pause the machine. {@link #statebotfsmemit|.emit()} and {@link #statebotfsmenter|.enter()} will be no-ops until\n     * the machine is {@link #statebotfsmresume|.resume()}'d.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     */\n    pause,\n\n    /**\n     * Returns `true` if the machine is {@link #statebotfsmpause|.pause()}'d\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @returns {boolean}\n     */\n    paused,\n\n    /**\n     * Since v2.9.0: Return the state the machine will be in after\n     * {@link #statebotfsmemit|.emit()}'ing the specified event.\n     *\n     * Works only after using\n     *  {@link #statebotfsmperformtransitions|.performTransitions()}.\n     *\n     * See also: {@link #statebotfsmcantransitionto|.canTransitionTo(state, .afterEmitting )}.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} eventName\n     * @param {object} [stateObject]\n     * If `stateObject` is undefined, `.peek()` defaults to returning\n     * {@link #statebotfsmcurrentstate|.currentState()}\n     * if the event will *NOT* trigger a transition. Otherwise,\n     * `stateObject` will be used as a key/value lookup, with `key`\n     * being the predicted state, and `value` being the corresponding\n     * literal or function to be run and its value returned.\n     * @returns {string|null|any}\n     * @example\n     *\n     * var machine = Statebot('peek-a-boo', {\n     *   chart: `\n     *     idle -> running\n     *   `\n     * })\n     *\n     * machine.performTransitions({\n     *   'idle -> running': {\n     *     on: 'start'\n     *   }\n     * })\n     *\n     * machine.peek('start')\n     * // \"running\"\n     *\n     * machine.peek('start', {\n     *   'running': () => 'will be in the running state'\n     * })\n     * // \"will be in the running state\"\n     *\n     * machine.peek('unknown')\n     * // \"idle\"\n     * // Logs: Statebot[peek-a-boo]: Event not handled: \"unknown\"\n     *\n     * machine.peek('unknown', {\n     *   'running': () => 'will be in the running state'\n     * })\n     * // null\n     * // Logs: Statebot[peek-a-boo]: Event not handled: \"unknown\"\n     *\n     * machine.emit('start')\n     * machine.peek('start')\n     * // \"running\"\n     * // Logs: Statebot[peek-a-boo]: Will not transition after emitting: \"start\"\n     */\n     peek,\n\n    /**\n     * Perform transitions when events happen.\n     *\n     * Use `then` to optionally add callbacks to those transitions.\n     *\n     * Since v2.8.0:\n     * - If a `then` method returns a function, it will be invoked when\n     *   the state is exited in the same manner as if an {@link #statebotfsmonexiting .onExiting()}\n     *   handler was created using it.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {object|function} transitions\n     *  Configuration in the form of an object, or a function that\n     *  returns an object. If a function is used, there will be a single\n     *  argument passed-in: an object with the following methods\n     *  attached as a convenience:\n     *\n     *  - {{@link #statebotfsmenter|.enter()}, {@link #statebotfsmemit|.emit()}, {@link #enter-state-1 .Enter()}, {@link #emit-name .Emit()}}\n     *\n     * @returns {function} A function that removes all listeners added\n     *  by this method.\n     *\n     * @example\n     * var machine = Statebot('complex-form', {\n     *   chart: `\n     *     idle ->\n     *       update\n     *\n     *     // Maybe things take a long time...\n     *     update ->\n     *       waiting -> waiting-a-while\n     *\n     *     // Which path will we take?\n     *     waiting | waiting-a-while ->\n     *       success | failed | timeout\n     *\n     *     // All done!\n     *     success | failed | timeout ->\n     *       done\n     *   `\n     * })\n     *\n     * machine.performTransitions(({ Enter, emit }) => ({\n     *   'idle -> update': {\n     *     on: 'user-saved',\n     *     then: (data) => {\n     *       console.log('Sending data: ', data)\n     *\n     *       sendData(data)\n     *         .then(Enter('success'))\n     *         .catch(Enter('failed'))\n     *\n     *       emit('data-sent')\n     *     }\n     *   },\n     *   'update -> waiting': {\n     *     on: 'data-sent',\n     *     then: () => {\n     *       setTimeout(Enter('waiting-a-while'), 750)\n     *       setTimeout(Enter('timeout'), 5000)\n     *     }\n     *   }\n     * }))\n     *\n     * // Just to illustrate that you can mix n' match with onTransitions:\n     * machine.onTransitions({\n     *   'waiting | waiting-a-while -> success': () => {\n     *     console.log('Lovely!')\n     *   },\n     *   'waiting | waiting-a-while -> timeout': () => {\n     *     console.log('Well, at least you have your shoes')\n     *   }\n     * })\n     *\n     * machine.emit('user-saved', ['some', 'data'])\n     * // Sending data: [\"some\", \"data\"]\n     *\n     * function sendData() {\n     *   return new Promise((resolve, reject) => {\n     *     setTimeout(resolve, 1000)\n     *     setTimeout(reject, 750 + Math.round(Math.random() * 750))\n     *   })\n     * }\n     */\n    performTransitions: transitions => applyHitcher(transitions, 'performTransitions'),\n\n    /**\n     * Returns the previous state.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @returns {string|undefined}\n     *  The previous state, or `undefined` if there isn't one (ie; you\n     *  have just called {@link #statebotfsmreset|.reset()}, or the\n     *  machine has just started.)\n     *\n     * @example\n     * var machine = Statebot('simple-sender', {\n     *   chart: `\n     *     idle -> sending -> done\n     *   `\n     * })\n     *\n     * machine.enter('sending')\n     * machine.previousState()\n     * // \"idle\"\n     */\n    previousState,\n\n    /**\n     * Returns the state-machine to its starting-state and clears the\n     * state-history.\n     *\n     * All listeners will still be attached, but no events or\n     * transitions will be fired. The pause-state will be maintained.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     *\n     * @example\n     * var machine = Statebot('carousel', {\n     *   chart: `\n     *     page-1 ->\n     *     page-2 ->\n     *     page-3 ->\n     *     page-4 -> page-1\n     *   `\n     * })\n     *\n     * machine.enter('page-2')\n     * machine.reset()\n     * machine.currentState()\n     * // \"page-1\"\n     */\n    reset,\n\n    /**\n     * Resume a {@link #statebotfsmpause|.pause()}'d machine.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     */\n    resume,\n\n    /**\n     * Return an `array` of states accessible from the state specified.\n     * If no state is passed-in, the {@link #statebotfsmcurrentstate|.currentState()} is used.\n     *\n     * @memberof statebotFsm\n     * @instance\n     * @function\n     * @param {string} [state] The state to check. {@link #statebotfsmcurrentstate|.currentState()}\n     *  if unspecified.\n     * @returns {String[]}\n     * @example\n     * var machine = Statebot('half-duplex', {\n     *   chart: `\n     *     idle -> sending | receiving -> done\n     *   `\n     * })\n     *\n     * machine.statesAvailableFromHere()\n     * // [\"sending\", \"receiving\"]\n     *\n     * machine.statesAvailableFromHere('receiving')\n     * // [\"done\"]\n     */\n    statesAvailableFromHere\n  }\n}\n\nfunction decomposeHitcherActions (hitcherActions) {\n  // For: performTransitions()\n  const transitionsForEvents = {}\n\n  // For: onTransitions()\n  const transitionsOnly = []\n\n  Object\n    .entries(hitcherActions)\n    .map(([routeChart, actionFnOrConfigObj]) => {\n      if (isFunction(actionFnOrConfigObj)) {\n        transitionsOnly.push({ routeChart, action: actionFnOrConfigObj })\n        return\n      }\n      if (!isPojo(actionFnOrConfigObj)) {\n        return\n      }\n\n      const { on: _on, then: _then } = actionFnOrConfigObj\n      const hasValidEventNames = isString(_on) || isArray(_on)\n      if (hasValidEventNames) {\n        const eventNames = [_on].flat()\n        eventNames.map(name => {\n          transitionsForEvents[name] = transitionsForEvents[name] || []\n          transitionsForEvents[name].push({ routeChart, action: _then })\n        })\n        return\n      }\n\n      // Behave like onTransitions() if a \"then\" is specified but\n      // there is no \"on\" event that triggers it\n      if (isFunction(_then)) {\n        transitionsOnly.push({ routeChart, action: actionFnOrConfigObj })\n      }\n    })\n\n  return { transitionsForEvents, transitionsOnly }\n}\n\nfunction expandTransitions (configs, canWarn) {\n  const allStates = []\n  const allRoutes = []\n\n  const _configs = configs.reduce((acc, config) => {\n    const { routeChart, action } = config\n    const { states, routes, transitions } = decomposeChart(routeChart)\n    if (canWarn()) {\n      allStates.push(...states)\n      allRoutes.push(...routes)\n    }\n    return [\n      ...acc,\n      ...transitions.map(([fromState, toState]) =>\n        ({ fromState, toState, action })\n      )\n    ]\n  }, [])\n\n  return {\n    configs: _configs,\n    states: allStates,\n    routes: allRoutes\n  }\n}\n\n/**\n * Tests that an object is a {@link #statebotfsm|statebotFsm}.\n *\n * @memberof statebot\n * @function\n * @example\n * var machine = Statebot(...)\n *\n * isStatebot(machine)\n * // true\n *\n * @param {any} object The object to test.\n * @returns {boolean}\n */\n\nfunction isStatebot (object) {\n  return (\n    isPojo(object) &&\n    typeof object.__STATEBOT__ === 'number'\n  )\n}\n","\n//\n// STATEBOT ASSERTION HELPERS\n//\n\nexport {\n  routeIsPossible,\n  assertRoute\n}\n\nimport { isStatebot } from './statebot'\nimport { decomposeRoute } from './parsing'\nimport { isTemplateLiteral, ArgTypeError } from './types'\nimport {\n  Defer,\n  Once,\n  Revokable,\n  Logger,\n} from './utils'\n\nconst argTypeError = ArgTypeError('statebot.')\n\n/**\n * Assert that a certain route can be followed by a\n * {@link #statebotfsm|statebotFsm}.\n *\n * This merely tests that a certain path can be taken through a\n * state-machine. It doesn't assert that the states are moved-through\n * while the machine is working, as with\n * {@link #statebotassertroute|assertRoute()}.\n *\n * @memberof statebot\n * @function\n * @param {statebotFsm} machine\n *  The machine to test the route on.\n * @param {string|string[]} route\n *  The route to test as an arrow-delimited string:\n *\n *  `\n *  \"idle -> pending -> success -> done\"\n *  `\n * @returns {boolean}\n *\n * @example\n * var machine = Statebot(...)\n *\n * routeIsPossible(machine,\n *   'walking -> falling -> splatting -> walking'\n * )\n * // false\n */\n\nfunction routeIsPossible (machine, route) {\n  const err = argTypeError(\n    { machine: isStatebot, route: isTemplateLiteral }\n  )('routeIsPossible')(machine, route)\n  if (err) {\n    throw TypeError(err)\n  }\n\n  const _route = decomposeRoute(route)\n  return _route.every((state, index) => {\n    if (index === _route.length - 1) {\n      return true\n    } else {\n      const nextState = _route[index + 1]\n      const availableStates = machine.statesAvailableFromHere(state)\n      const passes = availableStates.includes(nextState)\n      return passes\n    }\n  })\n}\n\nlet assertionId = 0\n\n/**\n * {@link #statebotassertroute|assertRoute()} options.\n * @typedef {Object} assertRouteOptions\n * @property {string} [description]\n *  Describe the success-condition for this assertion.\n * @property {string} [fromState=\"\"]\n *  Wait for the machine to be in this state before assertion begins.\n * @property {function} [run]\n *  Run this function just before starting the assertion.\n * @property {number} [permittedDeviations=0]\n *  If we hit an unexpected state during assertion, this is a \"deviation\".\n *  It might be that the FSM will come back to the expected state again\n *  after a certain number of these. For example, if your FSM has a\n *  \"retry\" route configured, this number can account for it.\n * @property {number} [timeoutInMs=1000]\n *  Permitted length of time for the entire assertion, in milliseconds.\n * @property {number} [logLevel=3]\n *  Normally we want logs for assertions, right? Well, you can tune\n *  them just like you can with {@link #statebotoptions|statebotOptions}.\n */\n\n/**\n * Assert that a {@link #statebotfsm|statebotFsm} traced the route specified.\n *\n * Whereas {@link #statebotrouteispossible|routeIsPossible()} only checks\n * that a particular route can be followed, `assertRoute` will hook-into\n * a machine and wait for it to trace the specified path within a\n * timeout period.\n *\n * @memberof statebot\n * @function\n * @async\n * @param {statebotFsm} machine\n *  The machine to run the assertion on.\n * @param {string|string[]} expectedRoute\n *  The expected route as an arrow-delimited string:\n *\n *  `\n *  \"idle -> pending -> success -> done\"\n *  `\n * @param {assertRouteOptions} [options]\n * @returns {Promise}\n *\n * @example\n * var machine = Statebot(...)\n *\n * assertRoute(\n *   machine, 'prepare -> debounce -> sending -> done -> idle',\n *   {\n *     description: 'Email sent with no issues',\n *     fromState: 'idle',\n *     timeoutInMs: 1000 * 20,\n *     permittedDeviations: 0,\n *     logLevel: 3\n *   }\n * )\n * .then(() => console.log('Assertion passed!'))\n * .catch(err => console.error(`Whoops: ${err}`))\n *\n * machine.enter('idle')\n */\n\nfunction assertRoute (machine, expectedRoute, options) {\n  const err = argTypeError(\n    { machine: isStatebot, expectedRoute: isTemplateLiteral }\n  )('assertRoute')(machine, expectedRoute)\n  if (err) {\n    throw TypeError(err)\n  }\n\n  assertionId += 1\n\n  const {\n    description = 'Assertion complete',\n    fromState = '',\n    run = () => {},\n    permittedDeviations = 0,\n    timeoutInMs = 1000,\n    logLevel = 3\n  } = options || {}\n\n  const console = Logger(logLevel)\n\n  const prefix = `Statebot[${machine.name()}]: aId<${assertionId}>`\n  const route = decomposeRoute(expectedRoute)\n\n  console.log(`\\n${prefix}: Asserting route: [${route.join(' > ')}]`)\n  console.log(`${prefix}: > Assertion will start from state: \"${fromState}\"`)\n\n  const fromStateActionFn = Defer(run)\n  let removeFromStateActionFn = () => { }\n\n  const totalTimeTaken = TimeTaken()\n  let stateTimeTaken = TimeTaken()\n  let assertionTimeoutTimer\n  let deviations = 0\n  let pending = true\n  let unexpected = false\n\n  const consumeRoute = [...route]\n  const report = Table(\n    ['state', 'expected', 'info', 'took'],\n    ['center', 'center', 'left', 'right']\n  )\n\n  const finaliseReport = Once(err => {\n    addRow('', '', '', 'TOTAL: ' + totalTimeTaken())\n    report.lock()\n    console.log(`\\n${prefix}: ${description}: [${err ? 'FAILED' : 'SUCCESS'}]`)\n    console.table(report.content())\n    return err\n  })\n\n  const { addRow } = report\n  function enteredState (state) {\n    if (pending) {\n      addRow(state, '-', 'PENDING')\n    } else {\n      const expectedState = consumeRoute[0]\n      if (expectedState === state) {\n        addRow(state, expectedState, unexpected ? 'REALIGNED' : 'OKAY', stateTimeTaken())\n        unexpected = false\n        consumeRoute.shift()\n      } else {\n        addRow(state, expectedState, 'WRONG STATE', stateTimeTaken())\n        unexpected = true\n        deviations += 1\n      }\n      stateTimeTaken = TimeTaken()\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    if (consumeRoute.length === 0) {\n      reject(finaliseReport(new Error('NO ROUTE TO TEST')))\n      return\n    }\n\n    const clearTimeoutAndResolve = (...args) => {\n      clearTimeout(assertionTimeoutTimer)\n      removeFromStateActionFn()\n      removeOnSwitchingListener()\n      resolve(...args)\n    }\n\n    const clearTimeoutAndReject = err => {\n      clearTimeout(assertionTimeoutTimer)\n      removeFromStateActionFn()\n      removeOnSwitchingListener()\n      reject(err)\n    }\n\n    const bailout = message => {\n      while (consumeRoute.length) {\n        const expectedState = consumeRoute.shift()\n        addRow(machine.currentState(), `(${expectedState})`, message)\n        unexpected = false\n      }\n      clearTimeoutAndReject(finaliseReport(new Error(message)))\n    }\n\n    if (machine.inState(fromState)) {\n      pending = false\n      removeFromStateActionFn = fromStateActionFn()\n    }\n\n    const { revoke, fn } = Revokable(state => {\n      assertionTimeoutTimer = setTimeout(() => {\n        revoke()\n        bailout('TIMEOUT')\n      }, timeoutInMs)\n\n      enteredState(state)\n      if (pending && state === fromState) {\n        pending = false\n        removeFromStateActionFn = fromStateActionFn()\n      }\n      if (deviations > permittedDeviations) {\n        revoke()\n        bailout('TOO MANY DEVIATIONS')\n      }\n      if (consumeRoute.length <= 0) {\n        revoke()\n        clearTimeoutAndResolve(finaliseReport())\n      }\n    })\n\n    const removeOnSwitchingListener = machine.onSwitching(fn)\n  })\n}\n\nfunction Table (columns, alignments) {\n  columns = columns || []\n  alignments = alignments || []\n\n  const table = []\n  const alignment = columns.map((_, index) => alignments[index] || 'center')\n\n  let locked = false\n  function lock () {\n    locked = true\n  }\n\n  function addRow (...args) {\n    if (locked) {\n      return\n    }\n    const obj = columns.reduce((acc, col, index) => {\n      const row = args[index] || ''\n      return {\n        ...acc,\n        [col]: row\n      }\n    }, {})\n    table.push(obj)\n  }\n\n  function colSizes () {\n    return table.reduce(\n      (acc, row) => columns.map(\n        (col, index) => Math.max(row[col].length, acc[index])\n      ), columns.map(() => 0)\n    )\n  }\n\n  function content () {\n    const sizes = colSizes()\n    function formatField (value, index) {\n      const size = sizes[index]\n      const align = alignment[index]\n      if (align === 'left') {\n        return value.padEnd(size)\n      }\n      if (align === 'right') {\n        return value.padStart(size)\n      }\n      return value\n    }\n    const output = table.reduce((acc, row) => {\n      const formattedRow = columns.reduce((acc, col, index) => ({\n        ...acc,\n        [col]: formatField(row[col], index)\n      }), {})\n      return [...acc, formattedRow]\n    }, [])\n    return output\n  }\n\n  return {\n    lock: lock,\n    addRow: addRow,\n    content: content\n  }\n}\n\nfunction TimeTaken () {\n  const startTime = Date.now()\n\n  function fmt (num, digits) {\n    return num.toFixed(digits).replace(/\\.0+$/, '')\n  }\n\n  return function () {\n    const duration = Date.now() - startTime\n\n    if (duration < 500) {\n      return `${fmt(duration)} ms`\n    } else if (duration < 5000) {\n      return `${fmt(duration / 1000, 2)} s `\n    } else if (duration < 60000) {\n      return `${fmt(duration / 1000, 1)} s `\n    } else {\n      return `${fmt(duration / 1000 / 60, 1)} m `\n    }\n  }\n}\n"],"names":["n","all","Map","on","t","e","i","get","push","set","off","splice","indexOf","emit","slice","map","isEventEmitter","obj","isObject","isFunction","addListener","removeListener","displayName","isArray","Array","isArguments","Object","prototype","toString","call","isString","isAllStrings","arr","every","isUndefined","undefined","isNull","isPojo","getPrototypeOf","isTemplateLiteral","typeErrorStringIfFnReturnsFalse","argName","argTypeFn","arg","name","typeErrorStringIfTypeOfFails","argType","typeErrorStringFromArgument","argMap","index","length","permittedArgTypes","errorDescs","filter","multipleTypesSpecified","shouldError","join","JSON","stringify","ArgTypeError","namespace","typeMap","entries","fnName","args","processedArgs","from","x","flat","err","signature","keys","wrapEmitter","events","eventName","wrapMap","fn","fnMeta","handleEvent","refCount","delete","uniq","input","reduce","acc","one","defer","timer","setTimeout","clearTimeout","Defer","Once","Revokable","revoke","_fn","result","revoked","Pausables","startPaused","runFnWhenPaused","paused","Pausable","pause","resume","ReferenceCounter","kind","description","expecting","_refs","ref","increase","countOf","decrease","count","Math","max","refs","table","sort","key","toValue","Definitions","dictionary","undefine","word","definition","next","define","definitionsOf","Logger","level","_console","info","log","warn","none","canWarn","canLog","canInfo","console","error","rxCRLF","cxPipe","cxArrow","rxOperators","rxUnsafe","replace","rxLineContinuations","RegExp","rxDisallowedCharacters","rxComment","argTypeError","decomposeRoute","templateLiteral","TypeError","lines","condensedLines","linesOfTokens","tokenisedLines","route","decomposeChart","chart","linesOfRoutes","flatMap","decomposeRouteFromTokens","linesOfTransitions","decomposeTransitionsFromRoute","emptyStateFound","routeKeys","includes","filteredRoutes","filteredStates","transitions","split","routes","states","Boolean","linesFrom","strOrArr","line","output","previousLineHasContinuation","condenseLine","condensedLine","sanitisedLine","test","finalCondensedLine","str","previousStates","fromStates","toStates","fromState","toState","ON_EXITING","ON_ENTERING","ON_EXITED","ON_ENTERED","ON_SWITCHING","ON_SWITCHED","INTERNAL_EVENTS","Statebot","options","logPrefix","logLevel","historyLimit","mitt","startIn","Error","stateHistory","stateHistoryLimit","transitionId","transitionsFromEvents","internalEvents","emitInternalEvent","onInternalEvent","cb","statesHandled","routesHandled","eventsHandled","applyHitcher","hitcher","hitcherActions","enter","Enter","Emit","allStates","allRoutes","decomposeHitcherActions","transitionsForEvents","transitionsOnly","eventsMappedToTransitionConfigs","decomposeTransitionsForEvent","transitionConfigs","expandTransitions","allCleanupFns","createEventHandlerForTransition","concat","configs","runThenMethodOnTransition","invalidStates","state","invalidRoutes","config","action","bindActionTo","transitionsAndAction","ifStateThenEnterState","inState","runActionFor","onEvent","eventWasHandled","some","transitionNoOp","actionFn","onExitingState","uninstall","enterExitMethods","_peek","stateObject","calledInternally","err1","eventAndState","currentState","statesFromEvent","reason","RangeError","err2","hasOwnProperty","anyOrFn","peek","previousState","_state_canTransitionTo","nextStates","statesAvailableFromHere","canTransitionTo","testStates","thisState","afterEmitting","_state","trim","_inState","conditionMatches","fnArgs","_inStateObject","match","find","nextRoute","shift","switchMethods","methodName","decreaseRefCount","removeEvent","names","switchMethod","toLowerCase","decreaseRefCounts","curriedArgs","_InState","curriedFnArgs","_InStateObject","InState","reset","message","lastState","prevRoute","availableStates","inspect","logRefCounterInfo","refCounter","__STATEBOT__","history","onEntered","onEntering","onExited","onExiting","onSwitched","onSwitching","onTransitions","performTransitions","routeChart","actionFnOrConfigObj","_on","_then","then","hasValidEventNames","eventNames","_configs","isStatebot","object","routeIsPossible","machine","_route","nextState","passes","assertionId","assertRoute","expectedRoute","run","permittedDeviations","timeoutInMs","prefix","fromStateActionFn","removeFromStateActionFn","totalTimeTaken","TimeTaken","stateTimeTaken","assertionTimeoutTimer","deviations","pending","unexpected","consumeRoute","report","Table","finaliseReport","addRow","lock","content","enteredState","expectedState","Promise","resolve","reject","clearTimeoutAndResolve","removeOnSwitchingListener","clearTimeoutAndReject","bailout","columns","alignments","alignment","_","locked","col","row","colSizes","sizes","formatField","value","size","align","padEnd","padStart","formattedRow","startTime","Date","now","fmt","num","digits","toFixed","duration"],"mappings":"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CA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,IAAM6G,UAAU,GAAG,WAAnB;EACA,IAAMC,WAAW,GAAG,YAApB;EACA,IAAMC,SAAS,GAAG,UAAlB;EACA,IAAMC,UAAU,GAAG,WAAnB;EACA,IAAMC,YAAY,GAAG,aAArB;EACA,IAAMC,WAAW,GAAG,YAApB;EAEA,IAAMC,eAAe,6DAClBF,YADkB,EACH,qBADG,qCAElBC,WAFkB,EAEJ,oBAFI,oBAArB;EA6BA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,SAASE,QAAT,CAAmB5J,KAAnB,EAAyB6J,OAAzB,EAAkC;EAChC,MAAI,CAAC3K,QAAQ,CAACc,KAAD,CAAb,EAAqB;EACnB,UAAM,IAAI8G,SAAJ,CAAc,oDAAd,CAAN;EACD;;EAED,MAAMgD,SAAS,sBAAe9J,KAAf,MAAf;;EACA,MAAI,CAACP,MAAM,CAACoK,OAAD,CAAX,EAAsB;EACpB,UAAM,IAAI/C,SAAJ,aAAmBgD,SAAnB,+CAAN;EACD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,IAAd,EAFR;EAGL3C,MAAAA,MAAM,EAAEiJ,aAAa,CAACtG,IAAd;EAHH,KAAP;EAKD;;EAED,WAASgB,KAAT,GAAiB;EACfD,IAAAA,QAAQ,CAACE,GAAT,WAAgBqE,SAAhB;;EAEAyG,IAAAA,iBAAiB,CAAC3F,aAAD,CAAjB;EACA2F,IAAAA,iBAAiB,CAAC1F,aAAD,CAAjB;EACA0F,IAAAA,iBAAiB,CAACzF,aAAD,CAAjB;EACD;;EAED,WAASyF,iBAAT,CAA4BC,UAA5B,EAAwC;EACtC,8BAA+BA,UAAU,CAAC5L,OAAX,EAA/B;EAAA,QAAQd,WAAR,uBAAQA,WAAR;EAAA,QAAqBW,KAArB,uBAAqBA,KAArB;;EACAc,IAAAA,QAAQ,CAACE,GAAT,CAAa3B,WAAb;;EACA,QAAIW,KAAK,CAACnE,MAAV,EAAkB;EAChBiF,MAAAA,QAAQ,CAACd,KAAT,CAAeA,KAAf;EACD,KAFD,MAEO;EACLc,MAAAA,QAAQ,CAACE,GAAT,CAAa,oBAAb;EACD;EACF;EAED;EACF;EACA;EACA;EACA;;;EAEE,SAAO;EACL;EACJ;EACA;EACA;EACA;EACIgL,IAAAA,YAAY,EAAE,CANT;;EAQL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACInC,IAAAA,eAAe,EAAfA,eA5DK;;EA8DL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIZ,IAAAA,YAAY,EAAZA,YAhFK;;EAkFL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIzP,IAAAA,IAAI,EAAJA,IAhIK;;EAkIL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACImN,IAAAA,IAAI,EAAJA,IAlLK;;EAoLL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIF,IAAAA,KAAK,EAALA,KArNK;;EAuNL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIC,IAAAA,KAAK,EAALA,KA1PK;;EA4PL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIuF,IAAAA,OAAO,EAAE;EAAA,uBAAUtG,YAAV;EAAA,KAtRJ;;EAwRL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI5E,IAAAA,IAAI,EAAE;EAAA,aAAMA,KAAI,EAAV;EAAA,KA3TD;;EA6TL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI8K,IAAAA,OAAO,EAAE;EAAA,aAAMA,QAAO,EAAb;EAAA,KAnVJ;;EAqVL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI3D,IAAAA,OAAO,EAAPA,OAxZK;;EA0ZL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIqD,IAAAA,OAAO,EAAPA,OA9cK;;EAgdL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIhQ,IAAAA,IAAI,EAAE;EAAA,aAAMA,KAAN;EAAA,KAteD;;EAweL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI2Q,IAAAA,SAAS,EAAEvD,gBAAgB,CAAC5D,UAAD,CAvgBtB;;EAygBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIoH,IAAAA,UAAU,EAAExD,gBAAgB,CAAC9D,WAAD,CA7iBvB;;EA+iBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEI;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIuD,IAAAA,OAAO,EAAPA,OAhmBK;;EAkmBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIgE,IAAAA,QAAQ,EAAEzD,gBAAgB,CAAC7D,SAAD,CAhoBrB;;EAkoBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIuH,IAAAA,SAAS,EAAE1D,gBAAgB,CAAC/D,UAAD,CAtqBtB;;EAwqBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEI;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI0H,IAAAA,UAAU,EAAE3B,aAAa,CAAC1F,WAAD,CAhtBpB;;EAktBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIsH,IAAAA,WAAW,EAAE5B,aAAa,CAAC3F,YAAD,CA/uBrB;;EAivBL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEI;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIwH,IAAAA,aAAa,EAAE,uBAAAjJ,WAAW;EAAA,aAAI+C,YAAY,CAAC/C,WAAD,EAAc,eAAd,CAAhB;EAAA,KA90BrB;;EAg1BL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACItE,IAAAA,KAAK,EAALA,KAx1BK;;EA01BL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACIF,IAAAA,MAAM,EAANA,MAl2BK;;EAo2BL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACKyK,IAAAA,IAAI,EAAJA,IA95BI;;EAg6BL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIiD,IAAAA,kBAAkB,EAAE,4BAAAlJ,WAAW;EAAA,aAAI+C,YAAY,CAAC/C,WAAD,EAAc,oBAAd,CAAhB;EAAA,KAt/B1B;;EAw/BL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACIkG,IAAAA,aAAa,EAAbA,aA9gCK;;EAghCL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI+B,IAAAA,KAAK,EAALA,KA1iCK;;EA4iCL;EACJ;EACA;EACA;EACA;EACA;EACA;EACItM,IAAAA,MAAM,EAANA,MAnjCK;;EAqjCL;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACI0K,IAAAA,uBAAuB,EAAvBA;EA5kCK,GAAP;EA8kCD;;EAED,SAAS9C,uBAAT,CAAkCN,cAAlC,EAAkD;EAEhD,MAAMO,oBAAoB,GAAG,EAA7B;EAGA,MAAMC,eAA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"}